<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book City - Your Online Book Community</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	
    <style>
        :root {
            --primary-color: #1a73e8;
            --primary-light: #4a9eff;
            --primary-dark: #0d47a1;
            --secondary-color: #ff9800;
            --secondary-light: #ffb74d;
            --secondary-dark: #f57c00;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            
            --font-primary: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --font-secondary: 'Georgia', serif;
            
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --box-shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            line-height: 1.6;
            color: var(--gray-800);
            background-color: var(--gray-100);
        }

        a {
            text-decoration: none;
            color: var(--primary-color);
        }

        a:hover {
            color: var(--primary-dark);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .btn {
            display: inline-block;
            padding: 8px 16px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            font-weight: 500;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            background-color: var(--primary-dark);
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
        }

        .btn-secondary:hover {
            background-color: var(--secondary-dark);
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #3d8b40;
        }

        .btn-danger {
            background-color: var(--danger-color);
        }

        .btn-danger:hover {
            background-color: #d32f2f;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        .btn-lg {
            padding: 12px 24px;
            font-size: 1.1rem;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        .btn-outline:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .text-center {
            text-align: center;
        }

        .mb-1 {
            margin-bottom: 0.5rem;
        }

        .mb-2 {
            margin-bottom: 1rem;
        }

        .mb-3 {
            margin-bottom: 1.5rem;
        }

        .mb-4 {
            margin-bottom: 2rem;
        }

        .mt-1 {
            margin-top: 0.5rem;
        }

        .mt-2 {
            margin-top: 1rem;
        }

        .mt-3 {
            margin-top: 1.5rem;
        }

        .mt-4 {
            margin-top: 2rem;
        }

        .ml-2 {
            margin-left: 1rem;
        }

        .mr-2 {
            margin-right: 1rem;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Animated Elements */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        .slide-up {
            animation: slideUp 0.5s ease-out;
        }

        /* Header Styles */
        header {
            background-color: white;
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        header.scrolled {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo img {
            width: 40px;
            height: 40px;
            margin-right: 10px;
            transition: transform 0.3s ease;
        }

        .logo:hover img {
            transform: rotate(10deg);
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            transition: color 0.3s ease;
        }

        .logo:hover h1 {
            color: var(--primary-dark);
        }

        .nav-links {
            display: flex;
            list-style: none;
        }

        .nav-links li {
            margin-left: 20px;
            position: relative;
        }

        .nav-links a {
            color: var(--gray-700);
            transition: var(--transition);
            font-weight: 500;
            padding: 5px 0;
            position: relative;
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 0;
            left: 0;
            background-color: var(--primary-color);
            transition: width 0.3s ease;
        }

        .nav-links a:hover {
            color: var(--primary-color);
        }

        .nav-links a:hover::after,
        .nav-links a.active::after {
            width: 100%;
        }

        .nav-links a.active {
            color: var(--primary-color);
            font-weight: 600;
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-700);
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .mobile-menu-btn:hover {
            color: var(--primary-color);
        }

        .user-dropdown {
            position: relative;
        }

        .user-dropdown:hover .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: white;
            box-shadow: var(--box-shadow);
            border-radius: var(--border-radius);
            width: 200px;
            padding: 10px 0;
            margin-top: 10px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .dropdown-menu a {
            display: block;
            padding: 10px 20px;
            color: var(--gray-700);
            transition: all 0.3s ease;
        }

        .dropdown-menu a:hover {
            background-color: var(--gray-100);
            color: var(--primary-color);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 100px 0 80px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="rgba(255, 255, 255, 0.1)" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,208C1248,224,1344,192,1392,176L1440,160L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
            background-size: cover;
            background-position: center;
            z-index: 1;
            opacity: 0.8;
        }

        .hero-content {
            position: relative;
            z-index: 2;
        }

        .hero h2 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            font-family: var(--font-secondary);
            animation: fadeIn 1s ease-out;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 30px;
            opacity: 0.9;
            animation: fadeIn 1.5s ease-out;
        }

        .search-bar {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
            animation: slideUp 1s ease-out;
        }

        .search-bar input {
            width: 100%;
            padding: 15px 20px;
            padding-left: 50px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease, transform 0.3s ease;
        }

        .search-bar input:focus {
            outline: none;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .search-bar i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-500);
            font-size: 1.2rem;
            transition: color 0.3s ease;
        }

        .search-bar input:focus + i {
            color: var(--primary-color);
        }

        /* Stats Bar */
        .stats-bar {
            background-color: white;
            padding: 20px 0;
            box-shadow: var(--box-shadow);
            margin-bottom: 40px;
        }

        .stats-container {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--gray-600);
            font-size: 0.9rem;
        }

        /* Book Grid */
        .book-grid {
            padding: 60px 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .section-title h2 {
            font-size: 2.2rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            font-family: var(--font-secondary);
            display: inline-block;
            position: relative;
        }

        .section-title h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background-color: var(--primary-light);
            border-radius: 3px;
        }

        .section-title p {
            color: var(--gray-600);
            max-width: 700px;
            margin: 0 auto;
        }

        .filters {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filter-btn {
            padding: 8px 16px;
            background-color: var(--gray-100);
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .filter-btn:hover {
            background-color: var(--gray-200);
            transform: translateY(-2px);
        }

        .filter-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .sort-options {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sort-options label {
            font-size: 0.9rem;
            color: var(--gray-600);
            font-weight: 500;
        }

        .sort-options select {
            padding: 8px 16px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            background-color: white;
            cursor: pointer;
            transition: var(--transition);
        }

        .sort-options select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }

        .books-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); /* Smaller card size */
            gap: 20px; /* Reduced gap */
        }

        .book-card {
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            transform: translateZ(0);
            backface-visibility: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .book-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--box-shadow-lg);
        }

        .book-cover {
            height: 260px; /* Reduced height */
            overflow: hidden;
            position: relative;
        }

        .book-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .book-card:hover .book-cover img {
            transform: scale(1.05);
        }

        .book-genre {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--primary-color);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            text-transform: uppercase;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .book-card:hover .book-genre {
            background-color: var(--secondary-color);
        }

        .book-info {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .book-title {
            font-size: 1.1rem; /* Smaller title */
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--gray-800);
            transition: color 0.3s ease;
            line-height: 1.3;
        }

        .book-card:hover .book-title {
            color: var(--primary-color);
        }

        .book-author {
            color: var(--gray-600);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .book-series {
            color: var(--primary-color);
            font-size: 0.85rem;
            font-style: italic;
            margin-bottom: 10px;
        }

        .book-rating {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .rating-stars {
            color: var(--warning-color);
            margin-right: 5px;
            font-size: 0.9rem; /* Smaller icons */
        }

        .rating-count {
            font-size: 0.8rem;
            color: var(--gray-600);
        }

        .book-votes {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .vote-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            background: none;
            border: 1px solid var(--gray-300);
            padding: 4px 8px; /* Smaller padding */
            border-radius: 20px;
            font-size: 0.75rem; /* Smaller font */
            color: var(--gray-600);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .vote-btn:hover {
            background-color: var(--gray-100);
            transform: translateY(-2px);
        }

        .vote-btn.upvoted {
            color: var(--success-color);
            border-color: var(--success-color);
            background-color: rgba(76, 175, 80, 0.1);
        }

        .vote-btn.downvoted {
            color: var(--danger-color);
            border-color: var(--danger-color);
            background-color: rgba(244, 67, 54, 0.1);
        }

        .book-actions {
            display: flex;
            justify-content: space-between;
            margin-top: auto; /* Push to bottom */
        }

        .book-card .view-book-btn {
            transition: all 0.3s ease;
            width: 100%;
        }

        .book-card:hover .view-book-btn {
            background-color: var(--primary-dark);
        }

        /* Empty states */
        .empty-books {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 40px;
            text-align: center;
            box-shadow: var(--box-shadow);
        }

        .empty-books i {
            font-size: 3rem;
            color: var(--gray-400);
            margin-bottom: 15px;
        }

        .empty-books h3 {
            color: var(--gray-700);
            margin-bottom: 10px;
        }

        .empty-books p {
            color: var(--gray-600);
            margin-bottom: 20px;
        }

        /* Genres Page */
        .genres-section {
            padding: 60px 0;
            display: none;
        }

        .genres-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 30px;
        }

        .genre-card {
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            position: relative;
            height: 200px;
        }

        .genre-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow-lg);
        }

        .genre-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        .genre-card:hover img {
            opacity: 0.6;
        }

        .genre-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.2) 100%);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 20px;
            color: white;
        }

        .genre-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .genre-count {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Authors Page */
        .authors-section {
            padding: 60px 0;
            display: none;
        }

        .authors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 30px;
        }

        .author-card {
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            text-align: center;
            padding: 20px;
            cursor: pointer; /* Make entire card clickable */
        }

        .author-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow-lg);
        }

        .author-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            overflow: hidden;
            border: 5px solid var(--gray-100);
            transition: border-color 0.3s ease;
        }

        .author-card:hover .author-avatar {
            border-color: var(--primary-light);
        }

        .author-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .author-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--gray-800);
        }

        .author-stats {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .author-stat {
            text-align: center;
        }

        .author-stat-value {
            font-weight: 600;
            color: var(--primary-color);
        }

        .author-stat-label {
            font-size: 0.8rem;
            color: var(--gray-600);
        }

        .author-votes {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .author-achievement {
            display: inline-block;
            padding: 5px 10px;
            background-color: var(--primary-light);
            color: white;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: 10px;
        }

        /* Author Detail Page */
        .author-detail-section {
            padding: 60px 0;
            display: none;
        }

        .author-detail-header {
            display: flex;
            gap: 40px;
            margin-bottom: 40px;
            align-items: center;
            flex-wrap: wrap;
        }

        .author-detail-avatar {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            overflow: hidden;
            border: 8px solid var(--gray-100);
            box-shadow: var(--box-shadow);
            transition: transform 0.3s ease;
            flex-shrink: 0;
        }

        .author-detail-avatar:hover {
            transform: scale(1.05);
        }

        .author-detail-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .author-detail-info {
            flex: 1;
            min-width: 300px;
        }

        .author-detail-name {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--gray-900);
        }

        .author-detail-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .author-detail-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 20px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            min-width: 100px;
        }

        .author-detail-stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .author-detail-stat-label {
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        .author-detail-bio {
            background-color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            position: relative;
        }

        .author-detail-bio-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .author-detail-bio-content {
            line-height: 1.7;
            color: var(--gray-700);
        }

        .edit-author-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            font-size: 1.2rem;
            transition: color 0.3s ease;
        }

        .edit-author-btn:hover {
            color: var(--primary-color);
        }

        .author-detail-books {
            margin-top: 40px;
        }

        .author-detail-books-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--gray-800);
            text-align: center;
            position: relative;
        }

        .author-detail-books-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background-color: var(--primary-light);
            border-radius: 3px;
        }

        .author-detail-footer {
            text-align: center;
            margin-top: 40px;
        }

                .author-achievements {
            margin-top: 20px;
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .author-achievements-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .achievement-item {
            background-color: var(--gray-100);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .achievement-icon {
            width: 40px;
            height: 40px;
            background-color: var(--primary-light);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .achievement-info h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .achievement-info p {
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        /* About Page */
        .about-section {
            padding: 60px 0;
            display: none;
        }

        .about-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 40px;
        }

        .about-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .about-title {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .about-subtitle {
            color: var(--gray-600);
            font-size: 1.2rem;
        }

        .about-content {
            line-height: 1.8;
            color: var(--gray-700);
        }

        .about-content p {
            margin-bottom: 20px;
        }

        /* Book Detail Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: var(--box-shadow-lg);
            transform: translateY(20px);
            transition: all 0.3s ease;
            scrollbar-width: thin;
            scrollbar-color: var(--gray-400) var(--gray-200);
        }

        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: var(--gray-200);
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background-color: var(--gray-400);
            border-radius: 4px;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background-color: white;
            z-index: 10;
            border-top-left-radius: var(--border-radius);
            border-top-right-radius: var(--border-radius);
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-500);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 50%;
        }

        .modal-close:hover {
            color: var(--danger-color);
            background-color: var(--gray-100);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            background-color: var(--gray-50);
            border-bottom-left-radius: var(--border-radius);
            border-bottom-right-radius: var(--border-radius);
        }

        /* Book Detail Page */
        .book-detail {
            padding: 60px 0;
            display: none;
        }

        .book-detail-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-lg);
            overflow: hidden;
            position: relative;
        }

        .book-detail-header {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            padding: 30px;
            background: linear-gradient(to bottom, var(--primary-light), white);
        }

        .book-detail-cover {
            width: 300px;
            height: 450px;
            overflow: hidden;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .book-detail-cover:hover {
            transform: translateY(-5px) rotate(1deg);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .book-detail-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .book-detail-cover:hover img {
            transform: scale(1.05);
        }

        .book-detail-info {
            flex: 1;
            min-width: 300px;
        }

        .book-detail-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--gray-900);
            font-family: var(--font-secondary);
            line-height: 1.2;
        }

        .book-detail-author {
            font-size: 1.3rem;
            color: var(--gray-700);
            margin-bottom: 15px;
            font-style: italic;
            cursor: pointer;
        }

        .book-detail-series {
            font-size: 1.1rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            padding: 5px 15px;
            background-color: rgba(26, 115, 232, 0.1);
            border-radius: 20px;
            display: inline-block;
        }

        .book-detail-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 25px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray-700);
            font-size: 0.95rem;
        }

        .meta-item i {
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .book-detail-rating {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .detail-rating-stars {
            font-size: 1.5rem;
            color: var(--warning-color);
        }

        .detail-rating-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        .detail-rating-count {
            font-size: 0.95rem;
            color: var(--gray-600);
        }

        .book-detail-votes {
            display: flex;
            margin-bottom: 25px;
            gap: 15px;
        }

        .book-detail-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .book-detail-actions .btn {
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .book-detail-actions .btn i {
            font-size: 1.1rem;
        }

        .book-detail-description {
            padding: 30px;
            border-bottom: 1px solid var(--gray-200);
            background-color: white;
        }

        .detail-section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary-color);
            position: relative;
            padding-left: 15px;
        }

        .detail-section-title::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background-color: var(--primary-color);
            border-radius: 2px;
        }

        .book-description {
            line-height: 1.8;
            color: var(--gray-700);
            font-size: 1.05rem;
        }

        /* Table of Contents */
        .book-toc {
            padding: 30px;
            border-bottom: 1px solid var(--gray-200);
            background-color: white;
        }

        .toc-container {
            background-color: var(--gray-100);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .toc-list {
            list-style: none;
        }

        .toc-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-200);
            transition: transform 0.3s ease;
        }

        .toc-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .toc-item:hover {
            transform: translateX(5px);
        }

        .toc-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 12px 15px;
            border-radius: var(--border-radius);
            transition: var(--transition);
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .toc-item-header:hover {
            background-color: var(--gray-200);
        }

        .toc-item-title {
            font-weight: 600;
            color: var(--gray-800);
            font-size: 1.05rem;
        }

        .toc-item-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toc-item-number {
            font-size: 0.85rem;
            color: var(--gray-600);
            background-color: var(--gray-200);
            padding: 3px 10px;
            border-radius: 20px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .toc-item.active .toc-item-number {
            background-color: var(--primary-color);
            color: white;
        }

        .toc-item-comments {
            font-size: 0.8rem;
            color: var(--gray-600);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .toc-item-toggle {
            color: var(--gray-600);
            transition: transform 0.3s ease;
        }

        .toc-item.active .toc-item-toggle {
            transform: rotate(180deg);
            color: var(--primary-color);
        }

        .toc-item-content {
            padding: 20px;
            display: none;
            background-color: white;
            margin-top: 10px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            animation: fadeIn 0.3s ease-out;
        }

        .toc-item.active .toc-item-content {
            display: block;
        }

        .chapter-comments-container {
            margin-top: 20px;
            border-top: 1px dashed var(--gray-300);
            padding-top: 20px;
        }

        .chapter-comment {
            background-color: var(--gray-100);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 15px;
        }

        .chapter-comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .chapter-comment-user {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chapter-comment-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            overflow: hidden;
        }

        .chapter-comment-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .chapter-comment-name {
            font-weight: 600;
            color: var(--gray-700);
            cursor: pointer;
        }

        .chapter-comment-date {
            font-size: 0.8rem;
            color: var(--gray-600);
        }

        .chapter-comment-content {
            color: var(--gray-700);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .chapter-comment-deleted {
            color: var(--gray-500);
            font-style: italic;
            padding: 10px;
            background-color: var(--gray-100);
            border-radius: var(--border-radius);
            margin-bottom: 15px;
        }

        .chapter-comment-form {
            margin-top: 15px;
        }

        .chapter-comment-form textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            resize: vertical;
            min-height: 80px;
            margin-bottom: 10px;
            font-family: var(--font-primary);
        }

        .chapter-comment-form textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }

        #toc-actions {
            margin-top: 15px;
            text-align: right;
        }

        #edit-toc-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        /* Edit TOC */
        .edit-toc {
            margin-top: 20px;
        }

        .edit-toc-form {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
        }

        .toc-form-group {
            margin-bottom: 20px;
        }

        .toc-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray-700);
        }

        .toc-form-group input, 
        .toc-form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .toc-form-group input:focus,
        .toc-form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }

        .toc-form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .toc-chapters {
            margin-top: 25px;
        }

        .toc-chapter {
            background-color: var(--gray-100);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .toc-chapter:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .toc-chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray-300);
        }

        .toc-chapter-title {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .toc-chapter-actions {
            display: flex;
            gap: 10px;
        }

        .remove-chapter-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--danger-color);
            color: white;
            cursor: pointer;
            border: none;
            transition: var(--transition);
        }

        .remove-chapter-btn:hover {
            background-color: #d32f2f;
            transform: rotate(90deg);
        }

        .toc-chapter-content {
            font-size: 0.95rem;
            color: var(--gray-700);
        }

        #add-chapter-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 25px;
        }

        /* Comments Section */
        .book-comments {
            padding: 30px;
            background-color: white;
        }

        .comments-list {
            margin-top: 25px;
        }

        .comment {
            background-color: var(--gray-100);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .comment:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .comment-user {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .comment-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .comment-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .comment-info {
            display: flex;
            flex-direction: column;
        }

        .comment-username {
            font-weight: 600;
            color: var(--gray-800);
            line-height: 1.2;
        }

        .comment-date {
            font-size: 0.85rem;
            color: var(--gray-600);
        }

        .comment-rating {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .comment-stars {
            color: var(--warning-color);
            font-size: 1rem;
        }

        .comment-content {
            color: var(--gray-700);
            line-height: 1.7;
            margin-top: 10px;
            font-size: 1rem;
        }

        .comment-deleted {
            color: var(--gray-500);
            font-style: italic;
            padding: 10px;
            background-color: var(--gray-100);
            border-radius: var(--border-radius);
            margin-top: 10px;
        }

        .comment-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
        }

        .comment-actions button {
            background: none;
            border: none;
            font-size: 0.9rem;
            color: var(--gray-600);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .comment-actions button:hover {
            color: var(--primary-color);
        }

        .comment-actions button.delete-comment-btn:hover {
            color: var(--danger-color);
        }

        .comment-form {
            margin-top: 35px;
            background-color: var(--gray-100);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .comment-form h4 {
            color: var(--gray-800);
            font-size: 1.2rem;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }

        .comment-form h4::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 50px;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 3px;
        }

        .rating-input {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .rating-label {
            font-weight: 500;
            color: var(--gray-700);
            min-width: 90px;
        }

        .star-rating {
            display: flex;
            gap: 5px;
            direction: rtl;
        }

        .star-rating input {
            display: none;
        }

        .star-rating label {
            color: var(--gray-300);
            cursor: pointer;
            font-size: 1.8rem;
            transition: color 0.3s ease, transform 0.3s ease;
        }

        .star-rating label:hover,
        .star-rating label:hover ~ label,
        .star-rating input:checked ~ label {
            color: var(--warning-color);
            transform: scale(1.1);
        }

        .comment-textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            resize: vertical;
            min-height: 120px;
            margin-bottom: 20px;
            font-family: var(--font-primary);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .comment-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }

        /* User Profile Page */
        .user-profile-section {
            padding: 60px 0;
            display: none;
        }

        .user-profile-header {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
            align-items: center;
            flex-wrap: wrap;
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
        }

        .user-profile-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            overflow: hidden;
            border: 5px solid var(--gray-100);
            box-shadow: var(--box-shadow);
        }

        .user-profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-profile-info {
            flex: 1;
            min-width: 300px;
        }

        .user-profile-name {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--gray-900);
        }

        .user-profile-joined {
            font-size: 0.9rem;
            color: var(--gray-600);
            margin-bottom: 15px;
        }

        .user-profile-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .user-profile-stat {
            padding: 10px 15px;
            background-color: var(--gray-100);
            border-radius: var(--border-radius);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .user-profile-stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .user-profile-stat-label {
            font-size: 0.85rem;
            color: var(--gray-600);
        }

        .user-profile-bio {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }

        .user-profile-bio h3 {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            position: relative;
            padding-bottom: 10px;
        }

        .user-profile-bio h3::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 40px;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 3px;
        }

        .user-content-section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }

        .user-content-section h3 {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }

        .user-content-section h3::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 40px;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 3px;
        }

        /* Newsletter Management Section */
        .newsletter-section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }

        .newsletter-section h3 {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }

        .newsletter-section h3::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 40px;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 3px;
        }

        .newsletter-form {
            background-color: var(--gray-100);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 30px;
        }

                .subscriber-list {
            margin-top: 20px;
        }

        .subscriber-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background-color: var(--gray-100);
            border-radius: var(--border-radius);
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .subscriber-item:hover {
            transform: translateX(5px);
            background-color: var(--gray-200);
        }

        .subscriber-email {
            font-weight: 500;
        }

        .subscriber-date {
            font-size: 0.85rem;
            color: var(--gray-600);
        }

        .subscriber-actions button {
            background: none;
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .subscriber-actions button:hover {
            transform: scale(1.1);
        }

        .compose-newsletter {
            margin-top: 30px;
        }

        .compose-newsletter textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            min-height: 200px;
            margin-bottom: 15px;
            font-family: var(--font-primary);
        }

        .compose-newsletter textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }

        .send-newsletter-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .newsletter-history {
            margin-top: 30px;
        }

        .newsletter-item {
            background-color: var(--gray-100);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 15px;
            transition: var(--transition);
        }

        .newsletter-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow);
        }

        .newsletter-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray-300);
        }

        .newsletter-item-title {
            font-weight: 600;
            color: var(--gray-800);
        }

        .newsletter-item-date {
            font-size: 0.85rem;
            color: var(--gray-600);
        }

        .newsletter-item-stats {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        .signup-newsletter-section {
            background-color: var(--primary-dark);
            color: white;
            padding: 60px 0;
            margin-top: 60px;
            text-align: center;
        }

        .signup-newsletter-content {
            max-width: 600px;
            margin: 0 auto;
        }

        .signup-newsletter-title {
            font-size: 2rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .signup-newsletter-description {
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .signup-newsletter-form {
            display: flex;
            max-width: 500px;
            margin: 0 auto;
            position: relative;
        }

        .signup-newsletter-input {
            flex: 1;
            padding: 15px;
            padding-right: 50px;
            border: none;
            border-radius: var(--border-radius) 0 0 var(--border-radius);
            font-size: 1rem;
        }

        .signup-newsletter-input:focus {
            outline: none;
        }

        .signup-newsletter-btn {
            padding: 0 25px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            cursor: pointer;
            transition: var(--transition);
        }

        .signup-newsletter-btn:hover {
            background-color: var(--secondary-dark);
        }

        .user-profile-books {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }

        .user-profile-books h3 {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }

        .user-profile-books h3::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 40px;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 3px;
        }

        .user-rated-book {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: var(--gray-100);
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            transition: transform 0.3s ease;
        }

        .user-rated-book:hover {
            transform: translateX(5px);
        }

        .user-rated-book-cover {
            width: 60px;
            height: 90px;
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-right: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .user-rated-book-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-rated-book-info {
            flex: 1;
        }

        .user-rated-book-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--gray-800);
        }

        .user-rated-book-author {
            font-size: 0.9rem;
            color: var(--gray-600);
            margin-bottom: 5px;
        }

        .user-rated-book-rating {
            color: var(--warning-color);
            font-size: 0.9rem;
        }

        /* Analytics Section */
        .analytics-section {
            padding: 60px 0;
            display: none;
        }

        .analytics-container {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
        }

        .analytics-header {
            margin-bottom: 30px;
        }

        .analytics-title {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .analytics-subtitle {
            color: var(--gray-600);
        }

        .analytics-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            padding: 15px;
            background-color: var(--gray-100);
            border-radius: var(--border-radius);
        }

        .analytics-time-filter {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .analytics-time-filter label {
            font-weight: 500;
            color: var(--gray-700);
        }

        .analytics-time-filter select {
            padding: 8px 15px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
        }

        .analytics-tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-300);
            margin-bottom: 20px;
        }

        .analytics-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: var(--gray-600);
            transition: all 0.3s ease;
        }

        .analytics-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .analytics-tab:hover {
            color: var(--primary-color);
        }

        .analytics-content {
            margin-bottom: 30px;
        }

        .analytics-card {
            background-color: var(--gray-100);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .analytics-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray-300);
        }

        .analytics-card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .analytics-card-body {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .analytics-metric {
            flex: 1;
            min-width: 150px;
            background-color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .analytics-metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .analytics-metric-label {
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        .analytics-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .analytics-table th,
        .analytics-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--gray-300);
        }

        .analytics-table th {
            background-color: var(--gray-100);
            font-weight: 600;
            color: var(--gray-700);
        }

        .analytics-table tr:hover {
            background-color: var(--gray-100);
        }

        /* Banned Users Section */
        .banned-users {
            margin-top: 30px;
        }

        .banned-user-item {
            background-color: var(--gray-100);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }

        .banned-user-info {
            flex: 1;
        }

        .banned-user-email {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--gray-800);
        }

        .banned-user-date {
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        .banned-user-actions {
            display: flex;
            gap: 10px;
        }

        /* Ban Message */
        .ban-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .ban-message {
            max-width: 500px;
            background-color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-lg);
            text-align: center;
            border-top: 5px solid var(--danger-color);
        }

        .ban-icon {
            font-size: 4rem;
            color: var(--danger-color);
            margin-bottom: 20px;
        }

        .ban-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--danger-color);
            margin-bottom: 15px;
        }

        .ban-text {
            font-size: 1.1rem;
            color: var(--gray-700);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .ban-duration {
            font-weight: 600;
            color: var(--gray-900);
        }

        /* Edit Author Modal */
        .edit-author-form {
            margin-top: 20px;
        }

        .edit-author-form .form-group {
            margin-bottom: 20px;
        }

        .edit-author-avatar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .edit-author-avatar-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            overflow: hidden;
            margin-bottom: 15px;
            border: 5px solid var(--gray-100);
            box-shadow: var(--box-shadow);
        }

        .edit-author-avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .achievement-toggle {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--gray-100);
            border-radius: var(--border-radius);
        }

        .achievement-toggle-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--gray-800);
        }

        .achievement-toggle-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
            color: var(--gray-700);
        }

        /* Forms */
        .form-section {
            padding: 60px 0;
        }

        .form-container {
            max-width: 500px;
            margin: 0 auto;
            background-color: white;
            border-radius: var(--border-radius);
            padding: 40px;
            box-shadow: var(--box-shadow-lg);
        }

        .form-title {
            text-align: center;
            margin-bottom: 35px;
        }

        .form-title h2 {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 10px;
            position: relative;
            display: inline-block;
        }

        .form-title h2::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: -10px;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 3px;
        }

        .form-title p {
            color: var(--gray-600);
            margin-top: 15px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--gray-700);
        }

        .form-control {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            font-family: var(--font-primary);
        }

        .form-control:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }

        .form-error {
            color: var(--danger-color);
            font-size: 0.85rem;
            margin-top: 8px;
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .form-error.active {
            display: block;
        }

        .form-control.invalid {
            border-color: var(--danger-color);
        }

        .form-switch {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .form-switch input {
            width: auto;
            cursor: pointer;
        }

        .form-switch label {
            margin-bottom: 0;
            cursor: pointer;
        }

        .form-footer {
            text-align: center;
            margin-top: 25px;
            font-size: 0.95rem;
            color: var(--gray-600);
        }

        .form-footer a {
            font-weight: 500;
        }

        .social-login {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 25px;
        }

        .social-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            background-color: white;
            color: var(--gray-700);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .social-btn:hover {
            background-color: var(--gray-100);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .google-btn i {
            color: #DB4437;
        }

        .facebook-btn i {
            color: #4267B2;
        }

        .or-divider {
            display: flex;
            align-items: center;
            margin: 25px 0;
            color: var(--gray-500);
        }

        .or-divider:before,
        .or-divider:after {
            content: "";
            flex: 1;
            height: 1px;
            background-color: var(--gray-300);
        }

        .or-divider span {
            padding: 0 15px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Footer */
        footer {
            background-color: var(--dark-color);
            color: white;
            padding: 80px 0 20px;
            margin-top: 80px;
            position: relative;
        }

        footer::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 0;
            width: 100%;
            height: 20px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 20"><path fill="%23343a40" d="M0,0 C400,15 800,20 1440,0 L1440,20 L0,20 Z"></path></svg>');
            background-size: cover;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 40px;
            margin-bottom: 30px;
        }

        .footer-column h3 {
            font-size: 1.3rem;
            margin-bottom: 25px;
            color: var(--secondary-color);
            font-weight: 600;
            position: relative;
            padding-bottom: 10px;
        }

        .footer-column h3::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 40px;
            height: 3px;
            background-color: var(--secondary-color);
            border-radius: 3px;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 12px;
        }

        .footer-links a {
            color: var(--gray-400);
            transition: var(--transition);
            display: inline-block;
            position: relative;
        }

        .footer-links a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 1px;
            bottom: -2px;
            left: 0;
            background-color: white;
            transition: width 0.3s ease;
        }

        .footer-links a:hover {
            color: white;
            transform: translateX(5px);
        }

        .footer-links a:hover::after {
            width: 100%;
        }

        .footer-social {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .social-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: var(--transition);
        }

        .social-icon:hover {
            background-color: var(--secondary-color);
            transform: translateY(-5px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--gray-500);
            font-size: 0.9rem;
        }

        /* Alerts */
        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            background-color: white;
            color: var(--gray-800);
            box-shadow: var(--box-shadow-lg);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1100;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            max-width: 350px;
        }

        .alert.active {
            transform: translateX(0);
        }

        .alert-success {
            border-left: 4px solid var(--success-color);
        }

        .alert-success i {
            color: var(--success-color);
            font-size: 1.2rem;
        }

        .alert-warning {
            border-left: 4px solid var(--warning-color);
        }

        .alert-warning i {
            color: var(--warning-color);
            font-size: 1.2rem;
        }

        .alert-danger {
            border-left: 4px solid var(--danger-color);
        }

        .alert-danger i {
            color: var(--danger-color);
            font-size: 1.2rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--gray-800);
        }

        .alert-message {
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        .alert-close {
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .alert-close:hover {
            color: var(--gray-800);
            background-color: var(--gray-200);
        }

        /* Loading Spinner */
        .loading-container {
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .loading-container.active {
            opacity: 1;
            visibility: visible;
        }

        .loading {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 4px solid rgba(26, 115, 232, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Mobile Menu */
        .mobile-menu {
            position: fixed;
            top: 0;
            left: -280px;
            width: 280px;
            height: 100%;
            background-color: white;
            box-shadow: var(--box-shadow);
            z-index: 1000;
            transition: left 0.3s ease-in-out;
            overflow-y: auto;
            display: block;
        }

        .mobile-menu.active {
            left: 0;
        }

        .mobile-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
        }

        .mobile-menu-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-700);
            cursor: pointer;
            transition: color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
        }

        .mobile-menu-close:hover {
            color: var(--danger-color);
            background-color: var(--gray-100);
        }

        .mobile-nav-links {
            list-style: none;
            padding: 20px;
        }

        .mobile-nav-links li {
            margin-bottom: 15px;
        }

        .mobile-nav-links a {
            color: var(--gray-700);
            font-size: 1.1rem;
            transition: var(--transition);
            display: block;
            padding: 10px 15px;
            border-radius: var(--border-radius);
        }

        .mobile-nav-links a:hover, 
        .mobile-nav-links a.active {
            color: var(--primary-color);
            background-color: var(--gray-100);
        }

        .mobile-auth-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 20px;
            border-top: 1px solid var(--gray-200);
        }

        /* Backdrop for mobile menu */
        .menu-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .menu-backdrop.active {
            display: block;
        }

        /* Copy Link Input */
        .copy-link-container {
            display: flex;
            margin-top: 15px;
            margin-bottom: 15px;
        }

        .copy-link-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius) 0 0 var(--border-radius);
            font-size: 0.9rem;
            background-color: var(--gray-100);
            color: var(--gray-700);
        }

        .copy-link-input:focus {
            outline: none;
        }

        .copy-link-btn {
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            cursor: pointer;
            transition: var(--transition);
        }

        .copy-link-btn:hover {
            background-color: var(--primary-dark);
        }

        /* Responsive Styles */
        @media (max-width: 991px) {
            .featured-container {
                grid-template-columns: 1fr;
            }

            .featured-image {
                height: 400px;
                order: -1;
            }

            .book-detail-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .book-detail-cover {
                width: 250px;
                height: 375px;
            }

            .book-detail-meta,
            .book-detail-votes {
                justify-content: center;
            }

            .book-detail-actions {
                justify-content: center;
            }

            .author-detail-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .author-detail-meta {
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .nav-links, 
            .auth-buttons {
                display: none;
            }

            .mobile-menu-btn {
                display: block;
            }

                        .hero h2 {
                font-size: 2.2rem;
            }

            .hero p {
                font-size: 1.1rem;
            }

            .stats-container {
                flex-wrap: wrap;
                gap: 20px;
            }

            .stat-item {
                width: 45%;
            }

            .section-title h2 {
                font-size: 1.8rem;
            }

            .filters {
                flex-direction: column;
                align-items: flex-start;
            }

            .sort-options {
                width: 100%;
                justify-content: space-between;
                margin-top: 10px;
            }

            .modal-content {
                width: 95%;
            }
        }

        @media (max-width: 576px) {
            .hero {
                padding: 80px 0 60px;
            }

            .hero h2 {
                font-size: 2rem;
            }

            .hero p {
                font-size: 1rem;
            }

            .book-card {
                max-width: 280px;
                margin: 0 auto;
            }

            .books-container {
                grid-template-columns: 1fr;
            }

            .social-login {
                flex-direction: column;
            }

            .footer-content {
                grid-template-columns: 1fr;
            }

            .book-detail-title {
                font-size: 2rem;
            }

            .book-detail-rating {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<script type="module">
// Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
  import { getFirestore } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
  import { getDatabase } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyALlF0_9E5dvsg0sz7PYtu1TnNKKv879pw",
    authDomain: "bookcity-26fdc.firebaseapp.com",
    projectId: "bookcity-26fdc",
    storageBucket: "bookcity-26fdc.firebasestorage.app",
    messagingSenderId: "263159980302",
    appId: "1:263159980302:web:632f6ad36279029e46775f",
    measurementId: "G-B9BF9P3YG7"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const rtdb = getDatabase(app);
</script>
<body>
    <!-- Header -->
    <header id="header">
        <div class="container">
            <div class="navbar">
                <div class="logo">
                    <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBkPSJNMTY4LjggMzJDMTE2LjQgMzIgNzIuOTEgNzMuMSAgNzIuOTEgMTI1LjVDNzIuOTEgMTUzLjEgNzguMTEgMTc3LjggOTAuNSAxOTUuNkwgOTIuNDEgMTk5LjJDMTAzLjUgMjE3LjIgMTIwLjMgMjI5LjQgMTQwLjMgMjM0LjhWMzY4QzE0MC4zIDM5NS41IDEyMC4zIDQxOS41IDkzIDE0MjYuNEMxMjAuMSA0MzYuMiAxNDIuMiA0NTcuNSAxNTIgNDg0LjZDMTU5LjEgNTAzLjYgMTc2LjQgNTEyIDE5NS4xIDUxMkgyOTUuOUMzMTQuNiA1MTIgMzMxLjkgNTAzLjYgMzM5IDQ4NC42QzM0OC44IDQ1Ny41IDM3MC45IDQzNi4yIDM5OCA0MjYuNEMzNzAuOCA0MTkuNSAzNTAuOCAzOTUuNSAzNTAuOCAzNjhWMjM0LjhDMzcwLjcgMjI5LjQgMzg3LjUgMjE3LjIgMzk4LjcgMTk5LjJMNDAwLjYgMTk1LjZDNDEzIDEgMTc3LjggNDE4LjIgMTUzLjEgNDE4LjIgMTI1LjVDNDE4LjIgNzMuMSAzNzQuNyAzMiAzMjIuMyAzMkgxNjguOFoiIGZpbGw9IiMxYTczZTgiLz48L3N2Zz4=" alt="Book City Logo">
                    <h1>Book City</h1>
                </div>
                <nav>
                    <ul class="nav-links">
                        <li><a href="#" class="active" data-page="home">Home</a></li>
                        <li><a href="#books" data-page="books">Books</a></li>
                        <li><a href="#genres" data-page="genres">Genres</a></li>
                        <li><a href="#authors" data-page="authors">Authors</a></li>
                        <li><a href="#about" data-page="about">About</a></li>
                    </ul>
                </nav>
                <div class="auth-buttons">
                    <button class="btn btn-secondary" id="login-btn">Login</button>
                    <button class="btn" id="signup-btn">Sign Up</button>
                </div>
                <button class="mobile-menu-btn" id="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div class="menu-backdrop" id="menu-backdrop"></div>
    <div class="mobile-menu" id="mobile-menu">
        <div class="mobile-menu-header">
            <div class="logo">
                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBkPSJNMTY4LjggMzJDMTE2LjQgMzIgNzIuOTEgNzMuMSAgNzIuOTEgMTI1LjVDNzIuOTEgMTUzLjEgNzguMTEgMTc3LjggOTAuNSAxOTUuNkwgOTIuNDEgMTk5LjJDMTAzLjUgMjE3LjIgMTIwLjMgMjI5LjQgMTQwLjMgMjM0LjhWMzY4QzE0MC4zIDM5NS41IDEyMC4zIDQxOS41IDkzIDE0MjYuNEMxMjAuMSA0MzYuMiAxNDIuMiA0NTcuNSAxNTIgNDg0LjZDMTU5LjEgNTAzLjYgMTc2LjQgNTEyIDE5NS4xIDUxMkgyOTUuOUMzMTQuNiA1MTIgMzMxLjkgNTAzLjYgMzM5IDQ4NC42QzM0OC44IDQ1Ny41IDM3MC45IDQzNi4yIDM5OCA0MjYuNEMzNzAuOCA0MTkuNSAzNTAuOCAzOTUuNSAzNTAuOCAzNjhWMjM0LjhDMzcwLjcgMjI5LjQgMzg3LjUgMjE3LjIgMzk4LjcgMTk5LjJMNDAwLjYgMTk1LjZDNDEzIDEgMTc3LjggNDE4LjIgMTUzLjEgNDE4LjIgMTI1LjVDNDE4LjIgNzMuMSAzNzQuNyAzMiAzMjIuMyAzMkgxNjguOFoiIGZpbGw9IiMxYTczZTgiLz48L3N2Zz4=" alt="Book City Logo">
                <h1>Book City</h1>
            </div>
            <button class="mobile-menu-close" id="mobile-menu-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <ul class="mobile-nav-links">
            <li><a href="#" class="active" data-page="home">Home</a></li>
            <li><a href="#books" data-page="books">Books</a></li>
            <li><a href="#genres" data-page="genres">Genres</a></li>
            <li><a href="#authors" data-page="authors">Authors</a></li>
            <li><a href="#about" data-page="about">About</a></li>
        </ul>
        <div class="mobile-auth-buttons" id="mobile-auth-buttons">
            <button class="btn btn-secondary" id="mobile-login-btn">Login</button>
            <button class="btn" id="mobile-signup-btn">Sign Up</button>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero" id="hero">
        <div class="container hero-content">
            <h2>Discover Your Next Favorite Book</h2>
            <p>Join our community of book lovers to discover, review, and discuss amazing books.</p>
            <div class="search-bar">
                <input type="text" placeholder="Search for books, authors, or genres..." id="hero-search">
                <i class="fas fa-search"></i>
            </div>
        </div>
    </section>

    <!-- Stats Bar -->
    <section class="stats-bar">
        <div class="container">
            <div class="stats-container">
                <div class="stat-item">
                    <div class="stat-value" id="books-count">0</div>
                    <div class="stat-label">Books</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="authors-count">0</div>
                    <div class="stat-label">Authors</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="reviews-count">0</div>
                    <div class="stat-label">Reviews</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="members-count">0</div>
                    <div class="stat-label">Members</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Books Grid Section -->
    <section class="book-grid" id="books">
        <div class="container">
            <div class="section-title">
                <h2>Featured Books</h2>
                <p>Explore our collection of amazing books added by our community</p>
            </div>
            <div class="filters">
                <div class="filter-options">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="fiction">Fiction</button>
                    <button class="filter-btn" data-filter="non-fiction">Non-Fiction</button>
                    <button class="filter-btn" data-filter="fantasy">Fantasy</button>
                    <button class="filter-btn" data-filter="sci-fi">Science Fiction</button>
                    <button class="filter-btn" data-filter="mystery">Mystery</button>
                </div>
                <div class="sort-options">
                    <label for="sort-select">Sort by:</label>
                    <select id="sort-select">
                        <option value="newest">Newest</option>
                        <option value="rating">Highest Rated</option>
                        <option value="upvotes">Most Upvoted</option>
                        <option value="title">Title (A-Z)</option>
                        <option value="author">Author (A-Z)</option>
                    </select>
                </div>
            </div>
            <div class="books-container" id="books-container">
                <!-- Books will be loaded here by JavaScript -->
                <div class="empty-books text-center" id="empty-books">
                    <i class="fas fa-book-open fa-3x mb-3" style="color: var(--gray-400);"></i>
                    <h3 class="mb-2">No Books Yet</h3>
                    <p class="mb-3">Be the first to add a book to our collection!</p>
                    <button class="btn" id="add-first-book-btn">Add a Book</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Newsletter Sign-up Section -->
    <section class="signup-newsletter-section">
        <div class="container">
            <div class="signup-newsletter-content">
                <h2 class="signup-newsletter-title">Join Our Book Community Newsletter</h2>
                <p class="signup-newsletter-description">Get weekly updates on new releases, author interviews, and special offers delivered to your inbox.</p>
                <form class="signup-newsletter-form" id="signup-newsletter-form">
                    <input type="email" class="signup-newsletter-input" placeholder="Your email address" required>
                    <button type="submit" class="signup-newsletter-btn">Subscribe</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Genres Section -->
    <section class="genres-section" id="genres-section">
        <div class="container">
            <div class="section-title">
                <h2>Explore Genres</h2>
                <p>Discover books across different genres and expand your reading horizons</p>
            </div>
            <div class="genres-grid" id="genres-grid">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Authors Section -->
    <section class="authors-section" id="authors-section">
        <div class="container">
            <div class="section-title">
                <h2>Popular Authors</h2>
                <p>Explore works from some of our community's favorite authors</p>
            </div>
            <div class="authors-grid" id="authors-grid">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Author Detail Page -->
    <section class="author-detail-section" id="author-detail-section">
        <div class="container">
            <div class="author-detail-container">
                <div class="author-detail-header">
                    <div class="author-detail-avatar">
                        <img id="author-detail-image" src="" alt="Author Profile">
                    </div>
                    <div class="author-detail-info">
                        <h1 class="author-detail-name" id="author-detail-name"></h1>
                        <div class="author-detail-meta">
                            <div class="author-detail-stat">
                                <div class="author-detail-stat-value" id="author-books-count">0</div>
                                <div class="author-detail-stat-label">Books</div>
                            </div>
                            <div class="author-detail-stat">
                                <div class="author-detail-stat-value" id="author-rating">0.0</div>
                                <div class="author-detail-stat-label">Avg Rating</div>
                            </div>
                            <div class="author-detail-stat">
                                <div class="author-detail-stat-value" id="author-votes">0</div>
                                <div class="author-detail-stat-label">Votes</div>
                            </div>
                            <div class="author-detail-stat">
                                <div class="author-detail-stat-value" id="author-votes-left">3</div>
                                <div class="author-detail-stat-label">Votes Left</div>
                            </div>
                        </div>
                        
                        <div class="book-detail-votes">
                            <button class="vote-btn" id="author-upvote-btn">
                                <i class="fas fa-thumbs-up"></i> <span id="author-upvotes">0</span>
                            </button>
                            <button class="vote-btn" id="author-downvote-btn">
                                <i class="fas fa-thumbs-down"></i> <span id="author-downvotes">0</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="author-detail-bio">
                    <h3 class="author-detail-bio-title">About the Author</h3>
                    <p class="author-detail-bio-content" id="author-detail-bio"></p>
                    <button class="edit-author-btn" id="edit-author-btn" style="display: none;">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
                
                <!-- Author Achievements Section -->
                <div class="author-achievements" id="author-achievements">
                    <h3 class="author-achievements-title">Monthly Awards</h3>
                    <div id="achievements-list">
                        <!-- Achievements will be loaded here -->
                    </div>
                </div>
                
                <div class="author-detail-books">
                    <h3 class="author-detail-books-title">Books by this Author</h3>
                    <div class="books-container" id="author-books-container">
                        <!-- Author's books will be loaded here -->
                    </div>
                </div>
                
                <div class="author-detail-footer">
                    <button class="btn" id="back-to-authors">
                        <i class="fas fa-arrow-left"></i> Back to Authors
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Book Detail Page -->
    <section class="book-detail" id="book-detail-section">
        <div class="container">
            <div class="book-detail-container">
                <div class="book-detail-header">
                    <div class="book-detail-cover">
                        <img id="book-detail-cover" src="" alt="Book Cover">
                    </div>
                    <div class="book-detail-info">
                        <h1 class="book-detail-title" id="book-detail-title"></h1>
                        <p class="book-detail-author" id="book-detail-author"></p>
                        <div class="book-detail-series" id="book-detail-series" style="display: none;"></div>
                        <div class="book-detail-meta">
                            <div class="meta-item">
                                <i class="fas fa-bookmark"></i>
                                <span id="book-detail-genre"></span>
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-calendar-alt"></i>
                                <span id="book-detail-date"></span>
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-eye"></i>
                                <span id="book-detail-views">0 views</span>
                            </div>
                        </div>
                        <div class="book-detail-rating">
                            <div class="detail-rating-stars" id="book-detail-stars"></div>
                            <span class="detail-rating-value" id="book-detail-rating">0.0</span>
                            <span class="detail-rating-count" id="book-detail-rating-count">(0 ratings)</span>
                        </div>
                        <div class="book-detail-votes">
                            <button class="vote-btn" id="book-upvote-btn">
                                <i class="fas fa-thumbs-up"></i> <span id="book-upvotes">0</span>
                            </button>
                            <button class="vote-btn" id="book-downvote-btn">
                                <i class="fas fa-thumbs-down"></i> <span id="book-downvotes">0</span>
                            </button>
                        </div>
                        <div class="book-detail-actions" id="book-detail-actions">
                            <!-- Actions will be added dynamically -->
                        </div>
                    </div>
                </div>
                <div class="book-detail-description">
                    <h3 class="detail-section-title">Description</h3>
                    <p class="book-description" id="book-detail-description"></p>
                </div>
                <div class="book-toc">
                    <h3 class="detail-section-title">Table of Contents</h3>
                    <div id="toc-container" class="toc-container">
                        <div id="empty-toc" style="text-align: center; padding: 20px; color: var(--gray-600);">
                            <i class="fas fa-list fa-2x mb-2"></i>
                            <p>No table of contents available yet.</p>
                        </div>
                        <ul class="toc-list" id="toc-list" style="display: none;"></ul>
                    </div>
                    <div id="toc-actions" class="mt-3" style="display: none;">
                        <button class="btn btn-sm" id="edit-toc-btn">
                            <i class="fas fa-edit"></i> Edit Table of Contents
                        </button>
                    </div>
                </div>
                <div class="book-comments">
                    <h3 class="detail-section-title">Reviews & Comments</h3>
                    <div class="comments-list" id="book-comments-list">
                        <div id="empty-comments" style="text-align: center; padding: 20px; color: var(--gray-600);">
                            <i class="fas fa-comments fa-2x mb-2"></i>
                            <p>No comments yet. Be the first to leave a review!</p>
                        </div>
                    </div>
                    <div class="comment-form" id="comment-form">
                        <h4 class="mb-2">Leave a Review</h4>
                        <form id="add-comment-form">
                            <div class="rating-input">
                                <span class="rating-label">Your Rating:</span>
                                <div class="star-rating">
                                    <input type="radio" name="rating" id="star5" value="5">
                                    <label for="star5"><i class="fas fa-star"></i></label>
                                    <input type="radio" name="rating" id="star4" value="4">
                                    <label for="star4"><i class="fas fa-star"></i></label>
                                    <input type="radio" name="rating" id="star3" value="3">
                                    <label for="star3"><i class="fas fa-star"></i></label>
                                    <input type="radio" name="rating" id="star2" value="2">
                                    <label for="star2"><i class="fas fa-star"></i></label>
                                    <input type="radio" name="rating" id="star1" value="1">
                                    <label for="star1"><i class="fas fa-star"></i></label>
                                </div>
                            </div>
                            <textarea class="comment-textarea" id="comment-text" placeholder="Write your review here..."></textarea>
                            <button type="submit" class="btn">Submit Review</button>
                        </form>
                    </div>
                </div>
                <div class="author-detail-footer">
                    <button class="btn" id="back-to-books">
                        <i class="fas fa-arrow-left"></i> Back to Books
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- About Page -->
    <section class="about-section" id="about-section">
        <div class="container">
            <div class="about-container">
                <div class="about-header">
                    <h2 class="about-title">About Book City</h2>
                    <p class="about-subtitle">Your online community for book lovers</p>
                </div>
                <div class="about-content">
                    <p>Book City is a vibrant online community dedicated to book lovers around the world. Our platform enables readers to discover new books, share recommendations, and engage in meaningful discussions about literature.</p>
                    <p>Founded in 2023, our mission is to foster a love for reading and create connections between readers across different genres and interests. Whether you're a fan of classic literature, contemporary fiction, or non-fiction, Book City is your home for literary exploration.</p>
                    <p>Our platform allows you to:</p>
                    <ul>
                        <li>Discover new books tailored to your interests</li>
                        <li>Create and share your own reading lists</li>
                        <li>Connect with fellow book enthusiasts</li>
                        <li>Write and read reviews from our community</li>
                        <li>Track your reading progress</li>
                        <li>Vote for your favorite books and authors</li>
                        <li>Comment on individual chapters</li>
                        <li>Participate in monthly author recognition</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- User Profile Page -->
    <section class="user-profile-section" id="user-profile-section">
        <div class="container">
            <div class="user-profile-header">
                <div class="user-profile-avatar">
                    <img id="user-profile-image" src="" alt="User Profile">
                </div>
                <div class="user-profile-info">
                    <h1 class="user-profile-name" id="user-profile-name"></h1>
                    <p class="user-profile-joined" id="user-profile-joined"></p>
                    <div class="user-profile-stats">
                        <div class="user-profile-stat">
                            <div class="user-profile-stat-value" id="user-books-liked">0</div>
                            <div class="user-profile-stat-label">Books Liked</div>
                        </div>
                        <div class="user-profile-stat">
                            <div class="user-profile-stat-value" id="user-reviews-count">0</div>
                            <div class="user-profile-stat-label">Reviews</div>
                        </div>
                        <div class="user-profile-stat">
                            <div class="user-profile-stat-value" id="user-votes-count">0</div>
                            <div class="user-profile-stat-label">Votes</div>
                        </div>
                    </div>
                </div>
                <button class="btn" id="edit-profile-btn" style="display: none;">
                    <i class="fas fa-edit"></i> Edit Profile
                </button>
            </div>

            <div class="user-profile-bio">
                <h3>About Me</h3>
                <p id="user-profile-bio">This user hasn't added a bio yet.</p>
            </div>

            <!-- Newsletter Management (Dusk only) -->
            <div class="newsletter-section" id="newsletter-section" style="display: none;">
                <h3>Newsletter Management</h3>
                <p>Manage your newsletter subscribers and send updates to your community.</p>
                
                <div class="subscriber-list">
                    <h4>Subscribers</h4>
                    <div id="subscribers-container">
                        <!-- Subscribers will be loaded here -->
                        <div id="empty-subscribers" style="text-align: center; padding: 20px; color: var(--gray-600);">
                            <i class="fas fa-users fa-2x mb-2"></i>
                            <p>No subscribers yet. Promote your newsletter to gain subscribers!</p>
                        </div>
                    </div>
                </div>
                
                <div class="compose-newsletter">
                    <h4>Compose Newsletter</h4>
                    <form id="send-newsletter-form">
                        <div class="form-group">
                            <label for="newsletter-subject">Subject Line</label>
                            <input type="text" id="newsletter-subject" class="form-control" placeholder="Enter newsletter subject" required>
                        </div>
                        <textarea id="newsletter-content" placeholder="Write your newsletter content here..."></textarea>
                        <button type="submit" class="btn send-newsletter-btn">
                            <i class="fas fa-paper-plane"></i> Send to All Subscribers
                        </button>
                    </form>
                </div>
                
                <div class="newsletter-history">
                    <h4>Sent Newsletters</h4>
                    <div id="newsletter-history-container">
                        <!-- Newsletter history will be loaded here -->
                        <div id="empty-newsletter-history" style="text-align: center; padding: 20px; color: var(--gray-600);">
                            <i class="fas fa-history fa-2x mb-2"></i>
                            <p>No newsletters have been sent yet.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="user-profile-books">
                <h3>Books Rated</h3>
                <div id="user-rated-books">
                    <!-- User's rated books will be loaded here -->
                    <div id="empty-rated-books" style="text-align: center; padding: 20px; color: var(--gray-600);">
                        <i class="fas fa-book fa-2x mb-2"></i>
                        <p>This user hasn't rated any books yet.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Analytics Section (Dusk only) -->
    <section class="analytics-section" id="analytics-section">
        <div class="container">
            <div class="analytics-container">
                <div class="analytics-header">
                    <h2 class="analytics-title">Analytics Dashboard</h2>
                    <p class="analytics-subtitle">Track performance metrics for your platform</p>
                </div>

                <div class="analytics-filters">
                    <div class="analytics-time-filter">
                        <label for="time-filter">Time Period:</label>
                        <select id="time-filter">
                            <option value="1h">Last Hour</option>
                            <option value="2h">Last 2 Hours</option>
                            <option value="4h">Last 4 Hours</option>
                            <option value="8h">Last 8 Hours</option>
                            <option value="16h">Last 16 Hours</option>
                            <option value="1d" selected>Last 24 Hours</option>
                            <option value="7d">Last 7 Days</option>
                            <option value="30d">Last 30 Days</option>
                            <option value="1y">Last Year</option>
                            <option value="all">All Time</option>
                        </select>
                    </div>
                </div>

                <div class="analytics-tabs">
                    <div class="analytics-tab active" data-tab="overview">Overview</div>
                                        <div class="analytics-tab" data-tab="books">Books</div>
                    <div class="analytics-tab" data-tab="authors">Authors</div>
                    <div class="analytics-tab" data-tab="users">Users</div>
                    <div class="analytics-tab" data-tab="banned">Banned Users</div>
                </div>

                <div class="analytics-content" id="analytics-content">
                    <!-- Overview Tab (default) -->
                    <div class="analytics-tab-content" id="overview-content">
                        <div class="analytics-card">
                            <div class="analytics-card-header">
                                <h3 class="analytics-card-title">Platform Summary</h3>
                            </div>
                            <div class="analytics-card-body">
                                <div class="analytics-metric">
                                    <div class="analytics-metric-value" id="analytics-total-views">0</div>
                                    <div class="analytics-metric-label">Total Views</div>
                                </div>
                                <div class="analytics-metric">
                                    <div class="analytics-metric-value" id="analytics-total-likes">0</div>
                                    <div class="analytics-metric-label">Total Likes</div>
                                </div>
                                <div class="analytics-metric">
                                    <div class="analytics-metric-value" id="analytics-total-comments">0</div>
                                    <div class="analytics-metric-label">Total Comments</div>
                                </div>
                                <div class="analytics-metric">
                                    <div class="analytics-metric-value" id="analytics-active-users">0</div>
                                    <div class="analytics-metric-label">Active Users</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Books Tab -->
                    <div class="analytics-tab-content" id="books-content" style="display: none;">
                        <div class="analytics-card">
                            <div class="analytics-card-header">
                                <h3 class="analytics-card-title">Top Books</h3>
                            </div>
                            <table class="analytics-table" id="top-books-table">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Author</th>
                                        <th>Views</th>
                                        <th>Likes</th>
                                        <th>Comments</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Authors Tab -->
                    <div class="analytics-tab-content" id="authors-content" style="display: none;">
                        <div class="analytics-card">
                            <div class="analytics-card-header">
                                <h3 class="analytics-card-title">Top Authors</h3>
                            </div>
                            <table class="analytics-table" id="top-authors-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Books</th>
                                        <th>Votes</th>
                                        <th>Avg Rating</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Users Tab -->
                    <div class="analytics-tab-content" id="users-content" style="display: none;">
                        <div class="analytics-card">
                            <div class="analytics-card-header">
                                <h3 class="analytics-card-title">Active Users</h3>
                            </div>
                            <table class="analytics-table" id="active-users-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Joined</th>
                                        <th>Activity</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Banned Users Tab -->
                    <div class="analytics-tab-content" id="banned-content" style="display: none;">
                        <div class="analytics-card">
                            <div class="analytics-card-header">
                                <h3 class="analytics-card-title">Banned Users</h3>
                                <button class="btn btn-sm" id="add-ban-btn">
                                    <i class="fas fa-ban"></i> Add Ban
                                </button>
                            </div>
                            <div class="banned-users" id="banned-users-list">
                                <!-- Will be populated by JavaScript -->
                                <div id="empty-bans" style="text-align: center; padding: 20px; color: var(--gray-600);">
                                    <i class="fas fa-check-circle fa-2x mb-2"></i>
                                    <p>No banned users at this time.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Login Modal -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Login to Book City</h2>
                <button class="modal-close" id="close-login-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="social-login">
                    <button class="social-btn google-btn">
                        <i class="fab fa-google"></i> Google
                    </button>
                    <button class="social-btn facebook-btn">
                        <i class="fab fa-facebook-f"></i> Facebook
                    </button>
                </div>
                <div class="or-divider">
                    <span>or</span>
                </div>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" class="form-control" placeholder="Enter your email">
                        <div class="form-error" id="login-email-error">Please enter a valid email address</div>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" class="form-control" placeholder="Enter your password">
                        <div class="form-error" id="login-password-error">Password is required</div>
                    </div>
                    <div class="form-switch">
                        <input type="checkbox" id="remember-me">
                        <label for="remember-me">Remember me</label>
                    </div>
                    <button type="submit" class="btn" style="width: 100%;">Login</button>
                </form>
                <div class="form-footer">
                    <p>Don't have an account? <a href="#" id="switch-to-signup">Sign up</a></p>
                    <p><a href="#">Forgot password?</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Signup Modal -->
    <div class="modal" id="signup-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create an Account</h2>
                <button class="modal-close" id="close-signup-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="social-login">
                    <button class="social-btn google-btn">
                        <i class="fab fa-google"></i> Google
                    </button>
                    <button class="social-btn facebook-btn">
                        <i class="fab fa-facebook-f"></i> Facebook
                    </button>
                </div>
                <div class="or-divider">
                    <span>or</span>
                </div>
                <form id="signup-form">
                    <div class="form-group">
                        <label for="signup-name">Username</label>
                        <input type="text" id="signup-name" class="form-control" placeholder="Enter your username">
                        <div class="form-error" id="signup-name-error">Please enter a username</div>
                    </div>
                    <div class="form-group">
                        <label for="signup-email">Email</label>
                        <input type="email" id="signup-email" class="form-control" placeholder="Enter your email">
                        <div class="form-error" id="signup-email-error">Please enter a valid email address</div>
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Password</label>
                        <input type="password" id="signup-password" class="form-control" placeholder="Create a password">
                        <div class="form-error" id="signup-password-error">Password must be at least 6 characters</div>
                    </div>
                    <div class="form-group">
                        <label for="signup-confirm">Confirm Password</label>
                        <input type="password" id="signup-confirm" class="form-control" placeholder="Confirm your password">
                        <div class="form-error" id="signup-confirm-error">Passwords do not match</div>
                    </div>
                    <div class="form-switch">
                        <input type="checkbox" id="terms">
                        <label for="terms">I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></label>
                    </div>
                    <button type="submit" class="btn" style="width: 100%;">Create Account</button>
                </form>
                <div class="form-footer">
                    <p>Already have an account? <a href="#" id="switch-to-login">Login</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Book Modal -->
    <div class="modal" id="add-book-modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title">Add a New Book</h2>
                <button class="modal-close" id="close-add-book-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="add-book-form">
                    <div class="form-group">
                        <label for="book-title">Book Title</label>
                        <input type="text" id="book-title" class="form-control" placeholder="Enter book title">
                        <div class="form-error" id="book-title-error">Please enter a title</div>
                    </div>
                    <div class="form-group">
                        <label for="book-author">Author</label>
                        <input type="text" id="book-author" class="form-control" placeholder="Enter author name">
                        <div class="form-error" id="book-author-error">Please enter an author</div>
                    </div>
                    <div class="form-group">
                        <label for="book-genre">Genre</label>
                        <select id="book-genre" class="form-control">
                            <option value="">Select a genre</option>
                            <option value="fiction">Fiction</option>
                            <option value="non-fiction">Non-Fiction</option>
                            <option value="fantasy">Fantasy</option>
                            <option value="sci-fi">Science Fiction</option>
                            <option value="mystery">Mystery</option>
                            <option value="thriller">Thriller</option>
                            <option value="romance">Romance</option>
                            <option value="horror">Horror</option>
                            <option value="biography">Biography</option>
                            <option value="history">History</option>
                            <option value="self-help">Self-Help</option>
                        </select>
                        <div class="form-error" id="book-genre-error">Please select a genre</div>
                    </div>
                    
                    <!-- Series section -->
                    <div class="series-section">
                        <div class="series-header">
                            <div class="series-title">Series Information</div>
                            <button type="button" class="series-toggle" id="toggle-series">
                                <i class="fas fa-plus"></i> Add to a series
                            </button>
                        </div>
                        <div class="series-content" id="series-content">
                            <div class="form-group">
                                <label for="book-series">Series Name</label>
                                <input type="text" id="book-series" class="form-control" placeholder="Enter series name">
                            </div>
                            <div class="form-group">
                                <label for="book-series-number">Book Number in Series</label>
                                <input type="number" id="book-series-number" class="form-control" placeholder="e.g. 1, 2, 3...">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="book-description">Description</label>
                        <textarea id="book-description" class="form-control" placeholder="Enter book description"></textarea>
                        <div class="form-error" id="book-description-error">Please enter a description</div>
                    </div>
                    <div class="form-group">
                        <label for="book-cover-url">Cover Image URL</label>
                        <input type="url" id="book-cover-url" class="form-control cover-url-input" placeholder="Enter URL to the book cover">
                        <button type="button" class="btn btn-sm" id="preview-cover-btn">Preview Cover</button>
                        <div class="form-error" id="book-cover-error">Please enter a valid image URL</div>
                        <img id="cover-preview" class="cover-preview">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="cancel-add-book">Cancel</button>
                        <button type="submit" class="btn">Add Book</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Book Modal -->
    <div class="modal" id="edit-book-modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title">Edit Book</h2>
                <button class="modal-close" id="close-edit-book-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="edit-book-form">
                    <input type="hidden" id="edit-book-id">
                    <div class="form-group">
                        <label for="edit-book-title">Book Title</label>
                        <input type="text" id="edit-book-title" class="form-control" placeholder="Enter book title">
                        <div class="form-error" id="edit-book-title-error">Please enter a title</div>
                    </div>
                    <div class="form-group">
                        <label for="edit-book-author">Author</label>
                        <input type="text" id="edit-book-author" class="form-control" placeholder="Enter author name">
                        <div class="form-error" id="edit-book-author-error">Please enter an author</div>
                    </div>
                    <div class="form-group">
                        <label for="edit-book-genre">Genre</label>
                        <select id="edit-book-genre" class="form-control">
                            <option value="">Select a genre</option>
                            <option value="fiction">Fiction</option>
                            <option value="non-fiction">Non-Fiction</option>
                            <option value="fantasy">Fantasy</option>
                            <option value="sci-fi">Science Fiction</option>
                            <option value="mystery">Mystery</option>
                            <option value="thriller">Thriller</option>
                            <option value="romance">Romance</option>
                            <option value="horror">Horror</option>
                            <option value="biography">Biography</option>
                            <option value="history">History</option>
                            <option value="self-help">Self-Help</option>
                        </select>
                        <div class="form-error" id="edit-book-genre-error">Please select a genre</div>
                    </div>
                    
                    <!-- Series section -->
                    <div class="series-section">
                        <div class="series-header">
                            <div class="series-title">Series Information</div>
                            <button type="button" class="series-toggle" id="toggle-edit-series">
                                <i class="fas fa-plus"></i> Add to a series
                            </button>
                        </div>
                        <div class="series-content" id="edit-series-content">
                            <div class="form-group">
                                <label for="edit-book-series">Series Name</label>
                                <input type="text" id="edit-book-series" class="form-control" placeholder="Enter series name">
                            </div>
                            <div class="form-group">
                                <label for="edit-book-series-number">Book Number in Series</label>
                                <input type="number" id="edit-book-series-number" class="form-control" placeholder="e.g. 1, 2, 3...">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-book-description">Description</label>
                        <textarea id="edit-book-description" class="form-control" placeholder="Enter book description"></textarea>
                        <div class="form-error" id="edit-book-description-error">Please enter a description</div>
                    </div>
                    <div class="form-group">
                        <label for="edit-book-cover-url">Cover Image URL</label>
                        <input type="url" id="edit-book-cover-url" class="form-control cover-url-input" placeholder="Enter URL to the book cover">
                        <button type="button" class="btn btn-sm" id="edit-preview-cover-btn">Preview Cover</button>
                        <div class="form-error" id="edit-book-cover-error">Please enter a valid image URL</div>
                        <img id="edit-cover-preview" class="cover-preview">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" id="delete-book">Delete Book</button>
                        <button type="button" class="btn btn-secondary" id="cancel-edit-book">Cancel</button>
                        <button type="submit" class="btn">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Author Modal -->
    <div class="modal" id="edit-author-modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 class="modal-title">Edit Author</h2>
                <button class="modal-close" id="close-edit-author-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="edit-author-form">
                    <input type="hidden" id="edit-author-id">
                    
                    <div class="edit-author-avatar-container">
                        <div class="edit-author-avatar-preview">
                            <img id="edit-author-image-preview" src="" alt="Author Profile">
                        </div>
                        <div class="form-group">
                            <label for="edit-author-image-url">Profile Image URL</label>
                            <input type="url" id="edit-author-image-url" class="form-control" placeholder="Enter URL to author's image">
                            <button type="button" class="btn btn-sm mt-2" id="preview-author-image-btn">Preview Image</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-author-name">Author Name</label>
                        <input type="text" id="edit-author-name" class="form-control" placeholder="Enter author name">
                        <div class="form-error" id="edit-author-name-error">Please enter an author name</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-author-bio">Author Bio</label>
                        <textarea id="edit-author-bio" class="form-control" rows="6" placeholder="Enter author bio"></textarea>
                        <div class="form-error" id="edit-author-bio-error">Please enter an author bio</div>
                    </div>
                    
                    <div class="achievement-toggle">
                        <h4 class="achievement-toggle-title">Author Achievement Settings</h4>
                        <div class="form-switch">
                            <input type="checkbox" id="achievements-enabled" checked>
                            <label for="achievements-enabled" class="achievement-toggle-label">
                                Enable monthly author achievements
                            </label>
                        </div>
                        <p style="color: var(--gray-600); font-size: 0.9rem; margin-top: 10px;">
                            When enabled, authors can receive awards based on monthly votes from users.
                        </p>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="cancel-edit-author">Cancel</button>
                        <button type="submit" class="btn">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal" id="edit-profile-modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 class="modal-title">Edit Your Profile</h2>
                <button class="modal-close" id="close-edit-profile-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="edit-profile-form">
                    <div class="edit-author-avatar-container">
                        <div class="edit-author-avatar-preview">
                            <img id="edit-profile-image-preview" src="" alt="Profile Picture">
                        </div>
                        <div class="form-group">
                            <label for="edit-profile-image-url">Profile Picture URL</label>
                            <input type="url" id="edit-profile-image-url" class="form-control" placeholder="Enter URL to your profile picture">
                            <button type="button" class="btn btn-sm mt-2" id="preview-profile-image-btn">Preview Image</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-profile-name">Display Name</label>
                        <input type="text" id="edit-profile-name" class="form-control" placeholder="Enter your display name">
                        <div class="form-error" id="edit-profile-name-error">Please enter a display name</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-profile-bio">Bio</label>
                        <textarea id="edit-profile-bio" class="form-control" rows="4" placeholder="Tell us about yourself"></textarea>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="cancel-edit-profile">Cancel</button>
                        <button type="submit" class="btn">Update Profile</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Table of Contents Edit Modal -->
    <div class="modal" id="edit-toc-modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title">Edit Table of Contents</h2>
                <button class="modal-close" id="close-edit-toc-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="edit-toc-form">
                    <input type="hidden" id="toc-book-id">
                    <div class="toc-chapters" id="toc-chapters">
                        <!-- Chapter entries will be added dynamically -->
                    </div>
                    <button type="button" class="btn btn-secondary" id="add-chapter-btn">
                        <i class="fas fa-plus"></i> Add Chapter
                    </button>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="cancel-edit-toc">Cancel</button>
                        <button type="submit" class="btn">Save Table of Contents</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Chapter Comment Modal -->
    <div class="modal" id="chapter-comment-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="chapter-comment-title">Chapter Comments</h2>
                <button class="modal-close" id="close-chapter-comment-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="comments-list" id="chapter-comments-list">
                    <div id="empty-chapter-comments" style="text-align: center; padding: 20px; color: var(--gray-600);">
                        <i class="fas fa-comments fa-2x mb-2"></i>
                        <p>No comments yet for this chapter.</p>
                    </div>
                </div>
                
                <form id="add-chapter-comment-form" class="chapter-comment-form mt-3">
                    <input type="hidden" id="comment-chapter-id">
                    <input type="hidden" id="comment-book-id">
                    <textarea class="form-control mb-2" id="chapter-comment-text" placeholder="Write your comment on this chapter..." rows="3"></textarea>
                    <button type="submit" class="btn btn-sm">Add Comment</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Ban Modal -->
    <div class="modal" id="add-ban-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Ban User</h2>
                <button class="modal-close" id="close-add-ban-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="add-ban-form">
                    <div class="form-group">
                        <label for="ban-email">User Email</label>
                        <input type="email" id="ban-email" class="form-control" placeholder="Enter user email">
                        <div class="form-error" id="ban-email-error">Please enter a valid email</div>
                    </div>
                    <div class="form-group">
                        <label for="ban-duration">Ban Duration</label>
                        <select id="ban-duration" class="form-control">
                            <option value="1">1 day</option>
                            <option value="3">3 days</option>
                            <option value="7" selected>7 days</option>
                            <option value="14">14 days</option>
                            <option value="30">30 days</option>
                            <option value="90">90 days</option>
                            <option value="permanent">Permanent</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ban-reason">Reason</label>
                        <textarea id="ban-reason" class="form-control" rows="3" placeholder="Reason for ban"></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="cancel-add-ban">Cancel</button>
                        <button type="submit" class="btn btn-danger">Ban User</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ban Message Overlay -->
    <div class="ban-overlay" id="ban-overlay" style="display: none;">
        <div class="ban-message">
            <div class="ban-icon">
                <i class="fas fa-ban"></i>
            </div>
            <h2 class="ban-title">Account Suspended</h2>
            <p class="ban-text">
                Unfortunately, your account has been temporarily suspended for 
                <span class="ban-duration" id="ban-duration-display">7 days</span>.
            </p>
            <p class="ban-text">
                Please check back after your suspension period has ended. If you believe this was done in error, 
                please contact our support team.
            </p>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-container" id="loading-container">
        <div class="loading"></div>
    </div>

    <!-- Alert Template -->
    <div class="alert" id="alert-template">
        <i class="fas fa-check-circle"></i>
        <div class="alert-content">
            <div class="alert-title">Success!</div>
            <div class="alert-message">Action completed successfully.</div>
        </div>
        <button class="alert-close">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                                        <div class="logo">
                        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBkPSJNMTY4LjggMzJDMTE2LjQgMzIgNzIuOTEgNzMuMSAgNzIuOTEgMTI1LjVDNzIuOTEgMTUzLjEgNzguMTEgMTc3LjggOTAuNSAxOTUuNkwgOTIuNDEgMTk5LjJDMTAzLjUgMjE3LjIgMTIwLjMgMjI5LjQgMTQwLjMgMjM0LjhWMzY4QzE0MC4zIDM5NS41IDEyMC4zIDQxOS41IDkzIDE0MjYuNEMxMjAuMSA0MzYuMiAxNDIuMiA0NTcuNSAxNTIgNDg0LjZDMTU5LjEgNTAzLjYgMTc2LjQgNTEyIDE5NS4xIDUxMkgyOTUuOUMzMTQuNiA1MTIgMzMxLjkgNTAzLjYgMzM5IDQ4NC42QzM0OC44IDQ1Ny41IDM3MC45IDQzNi4yIDM5OCA0MjYuNEMzNzAuOCA0MTkuNSAzNTAuOCAzOTUuNSAzNTAuOCAzNjhWMjM0LjhDMzcwLjcgMjI5LjQgMzg3LjUgMjE3LjIgMzk4LjcgMTk5LjJMNDAwLjYgMTk1LjZDNDEzIDEgMTc3LjggNDE4LjIgMTUzLjEgNDE4LjIgMTI1LjVDNDE4LjIgNzMuMSAzNzQuNyAzMiAzMjIuMyAzMkgxNjguOFoiIGZpbGw9IiNmZjk4MDAiLz48L3N2Zz4=" alt="Book City Logo" style="width: 40px; height: 40px; margin-right: 10px;">
                        <h1>Book City</h1>
                    </div>
                    <p class="mt-3" style="color: #ccc;">Your online community for book lovers to discover, review, and discuss amazing books.</p>
                    <div class="footer-social">
                        <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-pinterest"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="#" data-page="home">Home</a></li>
                        <li><a href="#books" data-page="books">Books</a></li>
                        <li><a href="#genres" data-page="genres">Genres</a></li>
                        <li><a href="#authors" data-page="authors">Authors</a></li>
                        <li><a href="#about" data-page="about">About</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Support</h3>
                    <ul class="footer-links">
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Community Guidelines</a></li>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>Book City - Where readers connect</p>
            </div>
        </div>
    </footer>

    <script>
        
        const emptyToc = document.getElementById('empty-toc');
        const tocList = document.getElementById('toc-list');
        const tocActions = document.getElementById('toc-actions');
        const editTocBtn = document.getElementById('edit-toc-btn');
        
        const toggleSeriesBtn = document.getElementById('toggle-series');
        const seriesContent = document.getElementById('series-content');
        const toggleEditSeriesBtn = document.getElementById('toggle-edit-series');
        const editSeriesContent = document.getElementById('edit-series-content');
        
        const editTocModal = document.getElementById('edit-toc-modal');
        const closeEditTocModal = document.getElementById('close-edit-toc-modal');
        const editTocForm = document.getElementById('edit-toc-form');
        const tocBookId = document.getElementById('toc-book-id');
        const tocChapters = document.getElementById('toc-chapters');
        const addChapterBtn = document.getElementById('add-chapter-btn');
        const cancelEditToc = document.getElementById('cancel-edit-toc');
        
        const chapterCommentModal = document.getElementById('chapter-comment-modal');
        const closeChapterCommentModal = document.getElementById('close-chapter-comment-modal');
        // DOM Elements
        const loginBtn = document.getElementById('login-btn');
        const signupBtn = document.getElementById('signup-btn');
        const mobileLoginBtn = document.getElementById('mobile-login-btn');
        const mobileSignupBtn = document.getElementById('mobile-signup-btn');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenuCloseBtn = document.getElementById('mobile-menu-close');
        const mobileMenu = document.getElementById('mobile-menu');
        const menuBackdrop = document.getElementById('menu-backdrop');
        const mobileAuthButtons = document.getElementById('mobile-auth-buttons');
        
        const loginModal = document.getElementById('login-modal');
        const signupModal = document.getElementById('signup-modal');
        const closeLoginModal = document.getElementById('close-login-modal');
        const closeSignupModal = document.getElementById('close-signup-modal');
        const switchToSignup = document.getElementById('switch-to-signup');
        const switchToLogin = document.getElementById('switch-to-login');
        
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const signupNewsletterForm = document.getElementById('signup-newsletter-form');
        
        const addBookModal = document.getElementById('add-book-modal');
        const closeAddBookModal = document.getElementById('close-add-book-modal');
        const addBookForm = document.getElementById('add-book-form');
        const cancelAddBook = document.getElementById('cancel-add-book');
        const addFirstBookBtn = document.getElementById('add-first-book-btn');
        
        const editBookModal = document.getElementById('edit-book-modal');
        const closeEditBookModal = document.getElementById('close-edit-book-modal');
        const editBookForm = document.getElementById('edit-book-form');
        const cancelEditBook = document.getElementById('cancel-edit-book');
        const deleteBookBtn = document.getElementById('delete-book');
        
        const editAuthorModal = document.getElementById('edit-author-modal');
        const closeEditAuthorModal = document.getElementById('close-edit-author-modal');
        const editAuthorForm = document.getElementById('edit-author-form');
        const cancelEditAuthor = document.getElementById('cancel-edit-author');
        const editAuthorBtn = document.getElementById('edit-author-btn');
        
        const editProfileModal = document.getElementById('edit-profile-modal');
        const closeEditProfileModal = document.getElementById('close-edit-profile-modal');
        const editProfileForm = document.getElementById('edit-profile-form');
        const cancelEditProfile = document.getElementById('cancel-edit-profile');
        const editProfileBtn = document.getElementById('edit-profile-btn');
        
        const previewCoverBtn = document.getElementById('preview-cover-btn');
        const bookCoverUrl = document.getElementById('book-cover-url');
        const coverPreview = document.getElementById('cover-preview');
        
        const editPreviewCoverBtn = document.getElementById('edit-preview-cover-btn');
        const editBookCoverUrl = document.getElementById('edit-book-cover-url');
        const editCoverPreview = document.getElementById('edit-cover-preview');
        
        const previewAuthorImageBtn = document.getElementById('preview-author-image-btn');
        const authorImageUrl = document.getElementById('edit-author-image-url');
        const authorImagePreview = document.getElementById('edit-author-image-preview');
        
        const previewProfileImageBtn = document.getElementById('preview-profile-image-btn');
        const profileImageUrl = document.getElementById('edit-profile-image-url');
        const profileImagePreview = document.getElementById('edit-profile-image-preview');
        
        const booksContainer = document.getElementById('books-container');
        const emptyBooks = document.getElementById('empty-books');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const sortSelect = document.getElementById('sort-select');
        
        const bookDetailSection = document.getElementById('book-detail-section');
        const bookDetailCover = document.getElementById('book-detail-cover');
        const bookDetailTitle = document.getElementById('book-detail-title');
        const bookDetailAuthor = document.getElementById('book-detail-author');
        const bookDetailSeries = document.getElementById('book-detail-series');
        const bookDetailGenre = document.getElementById('book-detail-genre');
        const bookDetailDate = document.getElementById('book-detail-date');
        const bookDetailCreator = document.getElementById('book-detail-creator');
        const bookDetailViews = document.getElementById('book-detail-views');
        const bookDetailStars = document.getElementById('book-detail-stars');
        const bookDetailRating = document.getElementById('book-detail-rating');
        const bookDetailRatingCount = document.getElementById('book-detail-rating-count');
        const bookDetailUpvotes = document.getElementById('book-upvotes');
        const bookDetailDownvotes = document.getElementById('book-downvotes');
        const bookDetailDescription = document.getElementById('book-detail-description');
        const bookDetailActions = document.getElementById('book-detail-actions');
        const bookUpvoteBtn = document.getElementById('book-upvote-btn');
        const bookDownvoteBtn = document.getElementById('book-downvote-btn');
        const backToBooksBtn = document.getElementById('back-to-books');
        
        const authorDetailSection = document.getElementById('author-detail-section');
        const authorDetailImage = document.getElementById('author-detail-image');
        const authorDetailName = document.getElementById('author-detail-name');
        const authorDetailBio = document.getElementById('author-detail-bio');
        const authorBooksCount = document.getElementById('author-books-count');
        const authorRating = document.getElementById('author-rating');
        const authorVotes = document.getElementById('author-votes');
        const authorVotesLeft = document.getElementById('author-votes-left');
        const authorUpvotes = document.getElementById('author-upvotes');
        const authorDownvotes = document.getElementById('author-downvotes');
        const authorUpvoteBtn = document.getElementById('author-upvote-btn');
        const authorDownvoteBtn = document.getElementById('author-downvote-btn');
        const authorBooksContainer = document.getElementById('author-books-container');
        const backToAuthorsBtn = document.getElementById('back-to-authors');
        const authorAchievements = document.getElementById('author-achievements');
        const achievementsList = document.getElementById('achievements-list');
        
        const userProfileSection = document.getElementById('user-profile-section');
        const userProfileImage = document.getElementById('user-profile-image');
        const userProfileName = document.getElementById('user-profile-name');
        const userProfileJoined = document.getElementById('user-profile-joined');
        const userProfileBio = document.getElementById('user-profile-bio');
        const userBooksLiked = document.getElementById('user-books-liked');
        const userReviewsCount = document.getElementById('user-reviews-count');
        const userVotesCount = document.getElementById('user-votes-count');
        const userRatedBooks = document.getElementById('user-rated-books');
        const emptyRatedBooks = document.getElementById('empty-rated-books');
        
        const newsletterSection = document.getElementById('newsletter-section');
        const subscribersContainer = document.getElementById('subscribers-container');
        const emptySubscribers = document.getElementById('empty-subscribers');
        const sendNewsletterForm = document.getElementById('send-newsletter-form');
        const newsletterHistoryContainer = document.getElementById('newsletter-history-container');
        const emptyNewsletterHistory = document.getElementById('empty-newsletter-history');
        
        const analyticsSection = document.getElementById('analytics-section');
        const analyticsTabs = document.querySelectorAll('.analytics-tab');
        const analyticsTabContents = document.querySelectorAll('.analytics-tab-content');
        const timeFilter = document.getElementById('time-filter');
        const topBooksTable = document.getElementById('top-books-table').querySelector('tbody');
        const topAuthorsTable = document.getElementById('top-authors-table').querySelector('tbody');
        const activeUsersTable = document.getElementById('active-users-table').querySelector('tbody');
        const bannedUsersList = document.getElementById('banned-users-list');
        const emptyBans = document.getElementById('empty-bans');
        const addBanBtn = document.getElementById('add-ban-btn');
        
        const addBanModal = document.getElementById('add-ban-modal');
        const closeAddBanModal = document.getElementById('close-add-ban-modal');
        const addBanForm = document.getElementById('add-ban-form');
        const cancelAddBan = document.getElementById('cancel-add-ban');
        const banOverlay = document.getElementById('ban-overlay');
        const banDurationDisplay = document.getElementById('ban-duration-display');
        const chapterCommentsTitle = document.getElementById('chapter-comment-title');
        const chapterCommentsList = document.getElementById('chapter-comments-list');
        const emptyChapterComments = document.getElementById('empty-chapter-comments');
        const addChapterCommentForm = document.getElementById('add-chapter-comment-form');
        const commentChapterId = document.getElementById('comment-chapter-id');
        const commentBookId = document.getElementById('comment-book-id');
        
        const bookCommentsList = document.getElementById('book-comments-list');
        const emptyComments = document.getElementById('empty-comments');
        const addCommentForm = document.getElementById('add-comment-form');
        
        const alertTemplate = document.getElementById('alert-template');
        const loadingContainer = document.getElementById('loading-container');
        
        const navLinks = document.querySelectorAll('.nav-links a, .mobile-nav-links a, .footer-links a[data-page]');
        const genresSection = document.getElementById('genres-section');
        const authorsSection = document.getElementById('authors-section');
        const aboutSection = document.getElementById('about-section');
        const genresGrid = document.getElementById('genres-grid');
        const authorsGrid = document.getElementById('authors-grid');
        
        const booksCount = document.getElementById('books-count');
        const authorsCount = document.getElementById('authors-count');
        const reviewsCount = document.getElementById('reviews-count');
        const membersCount = document.getElementById('members-count');

        // State variables
        let currentUser = null;
        let books = [];
        let series = {};
        let bookComments = {};
        let chapterComments = {};
        let currentBookId = null;
        let currentAuthorId = null;
        let currentChapterId = null;
        let userBookVotes = {};
        let userAuthorVotes = {};
        let userRatings = {};
        let authors = [];
        let currentPage = 'home';
        let searchTimeout = null;
        let baseUrl = window.location.href.split('#')[0];
        let authorVotesPerDay = 3;
        let authorVotesResetDate = null;
        let bookViews = {};
        let userProfiles = {};
        let deletedComments = {};
        let deletedChapterComments = {};
        let bannedUsers = {};
        let authorAchievementsEnabled = true;
        let authorMonthlyAwards = {};
        let newsletterSubscribers = {};
        let sentNewsletters = [];

        // Initialize the app
        document.addEventListener('DOMContentLoaded', initializeApp);

        // Event listeners
        loginBtn.addEventListener('click', () => showModal(loginModal));
        signupBtn.addEventListener('click', () => showModal(signupModal));
        mobileLoginBtn.addEventListener('click', () => {
            hideModal(mobileMenu);
            hideModal(menuBackdrop);
            showModal(loginModal);
        });
        mobileSignupBtn.addEventListener('click', () => {
            hideModal(mobileMenu);
            hideModal(menuBackdrop);
            showModal(signupModal);
        });
        
        closeLoginModal.addEventListener('click', () => hideModal(loginModal));
        closeSignupModal.addEventListener('click', () => hideModal(signupModal));
        
        switchToSignup.addEventListener('click', (e) => {
            e.preventDefault();
            hideModal(loginModal);
            showModal(signupModal);
        });
        
        switchToLogin.addEventListener('click', (e) => {
            e.preventDefault();
            hideModal(signupModal);
            showModal(loginModal);
        });
        
        mobileMenuBtn.addEventListener('click', () => {
            showModal(mobileMenu);
            showModal(menuBackdrop);
        });
        mobileMenuCloseBtn.addEventListener('click', () => {
            hideModal(mobileMenu);
            hideModal(menuBackdrop);
        });
        menuBackdrop.addEventListener('click', () => {
            hideModal(mobileMenu);
            hideModal(menuBackdrop);
        });
        
        // Newsletter subscription
        if (signupNewsletterForm) {
            signupNewsletterForm.addEventListener('submit', handleNewsletterSignup);
        }
        
        // Send newsletter form
        if (sendNewsletterForm) {
            sendNewsletterForm.addEventListener('submit', handleSendNewsletter);
        }
        
        // Page navigation
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const page = link.getAttribute('data-page');
                navigateToPage(page);
                hideModal(mobileMenu);
                hideModal(menuBackdrop);
            });
        });
        
        backToBooksBtn.addEventListener('click', () => {
            navigateToPage('books');
        });
        
        backToAuthorsBtn.addEventListener('click', () => {
            navigateToPage('authors');
        });
        
        addFirstBookBtn.addEventListener('click', () => showModal(addBookModal));
        closeAddBookModal.addEventListener('click', () => hideModal(addBookModal));
        cancelAddBook.addEventListener('click', () => hideModal(addBookModal));
        
        closeEditBookModal.addEventListener('click', () => hideModal(editBookModal));
        cancelEditBook.addEventListener('click', () => hideModal(editBookModal));
        
        closeEditAuthorModal.addEventListener('click', () => hideModal(editAuthorModal));
        cancelEditAuthor.addEventListener('click', () => hideModal(editAuthorModal));
        
        closeEditProfileModal.addEventListener('click', () => hideModal(editProfileModal));
        cancelEditProfile.addEventListener('click', () => hideModal(editProfileModal));
        
        closeEditTocModal.addEventListener('click', () => hideModal(editTocModal));
        cancelEditToc.addEventListener('click', () => hideModal(editTocModal));
        
        closeChapterCommentModal.addEventListener('click', () => hideModal(chapterCommentModal));
        
        closeAddBanModal.addEventListener('click', () => hideModal(addBanModal));
        cancelAddBan.addEventListener('click', () => hideModal(addBanModal));
        addBanBtn.addEventListener('click', () => showModal(addBanModal));
        
        editTocBtn.addEventListener('click', () => {
            tocBookId.value = currentBookId;
            populateTocEditor();
            showModal(editTocModal);
        });
        
        // Edit profile button
        if (editProfileBtn) {
            editProfileBtn.addEventListener('click', () => {
                setupEditProfileForm();
                showModal(editProfileModal);
            });
        }
        
        // Series toggle buttons
        toggleSeriesBtn.addEventListener('click', () => {
            seriesContent.classList.toggle('active');
            const icon = toggleSeriesBtn.querySelector('i');
            if (seriesContent.classList.contains('active')) {
                icon.className = 'fas fa-minus';
                toggleSeriesBtn.innerHTML = '<i class="fas fa-minus"></i> Remove from series';
            } else {
                icon.className = 'fas fa-plus';
                toggleSeriesBtn.innerHTML = '<i class="fas fa-plus"></i> Add to a series';
                document.getElementById('book-series').value = '';
                document.getElementById('book-series-number').value = '';
            }
        });
        
        toggleEditSeriesBtn.addEventListener('click', () => {
            editSeriesContent.classList.toggle('active');
            const icon = toggleEditSeriesBtn.querySelector('i');
            if (editSeriesContent.classList.contains('active')) {
                icon.className = 'fas fa-minus';
                toggleEditSeriesBtn.innerHTML = '<i class="fas fa-minus"></i> Remove from series';
            } else {
                icon.className = 'fas fa-plus';
                toggleEditSeriesBtn.innerHTML = '<i class="fas fa-plus"></i> Add to a series';
                document.getElementById('edit-book-series').value = '';
                document.getElementById('edit-book-series-number').value = '';
            }
        });
        
        // Cover URL preview buttons
        previewCoverBtn.addEventListener('click', () => {
            const url = bookCoverUrl.value.trim();
            if (url) {
                coverPreview.src = url;
                coverPreview.style.display = 'block';
                coverPreview.addEventListener('error', () => {
                    showAlert('warning', 'Invalid Image', 'The provided URL does not point to a valid image.');
                    coverPreview.style.display = 'none';
                });
            }
        });
        
        editPreviewCoverBtn.addEventListener('click', () => {
            const url = editBookCoverUrl.value.trim();
            if (url) {
                editCoverPreview.src = url;
                editCoverPreview.style.display = 'block';
                editCoverPreview.addEventListener('error', () => {
                    showAlert('warning', 'Invalid Image', 'The provided URL does not point to a valid image.');
                    editCoverPreview.style.display = 'none';
                });
            }
        });
        
        previewAuthorImageBtn.addEventListener('click', () => {
            const url = authorImageUrl.value.trim();
            if (url) {
                authorImagePreview.src = url;
                authorImagePreview.addEventListener('error', () => {
                    showAlert('warning', 'Invalid Image', 'The provided URL does not point to a valid image.');
                    authorImagePreview.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzFhNzNlOCIvPjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iODAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIGZpbGw9IiNmZmZmZmYiPkE8L3RleHQ+PC9zdmc+';
                });
            }
        });
        
        previewProfileImageBtn.addEventListener('click', () => {
            const url = profileImageUrl.value.trim();
            if (url) {
                profileImagePreview.src = url;
                profileImagePreview.addEventListener('error', () => {
                    showAlert('warning', 'Invalid Image', 'The provided URL does not point to a valid image.');
                    profileImagePreview.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzFhNzNlOCIvPjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iODAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIGZpbGw9IiNmZmZmZmYiPkE8L3RleHQ+PC9zdmc+';
                });
            }
        });
        
        // Search functionality
        document.getElementById('hero-search').addEventListener('input', (e) => {
            const searchTerm = e.target.value.trim().toLowerCase();
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                if (searchTerm.length > 2) {
                    searchBooks(searchTerm);
                } else if (searchTerm.length === 0) {
                    renderBooks();
                }
            }, 300);
        });
        
        // Book voting
        bookUpvoteBtn.addEventListener('click', () => {
            handleBookVote(currentBookId, 'upvote');
        });
        
        bookDownvoteBtn.addEventListener('click', () => {
            handleBookVote(currentBookId, 'downvote');
        });
        
        // Author voting
        authorUpvoteBtn.addEventListener('click', () => {
            handleAuthorVote(currentAuthorId, 'upvote');
        });
        
        authorDownvoteBtn.addEventListener('click', () => {
            handleAuthorVote(currentAuthorId, 'downvote');
        });
        
        // Edit author button
        editAuthorBtn.addEventListener('click', () => {
            setupEditAuthorForm(currentAuthorId);
            showModal(editAuthorModal);
        });
        
        // Analytics tabs
        analyticsTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-tab');
                
                // Update active tab
                analyticsTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show correct content
                analyticsTabContents.forEach(content => {
                    content.style.display = 'none';
                });
                document.getElementById(`${tabName}-content`).style.display = 'block';
                
                // Load data for the tab
                updateAnalyticsData(tabName);
            });
        });
        
        // Time filter for analytics
        timeFilter.addEventListener('change', () => {
            const activeTab = document.querySelector('.analytics-tab.active').getAttribute('data-tab');
            updateAnalyticsData(activeTab);
        });
        
        // Form submissions
        loginForm.addEventListener('submit', handleLogin);
        signupForm.addEventListener('submit', handleSignup);
        addBookForm.addEventListener('submit', handleAddBook);
        editBookForm.addEventListener('submit', handleEditBook);
        editAuthorForm.addEventListener('submit', handleEditAuthor);
        editProfileForm.addEventListener('submit', handleEditProfile);
        addCommentForm.addEventListener('submit', handleAddComment);
        addChapterCommentForm.addEventListener('submit', handleAddChapterComment);
        editTocForm.addEventListener('submit', handleEditToc);
        addBanForm.addEventListener('submit', handleAddBan);
        
        // Filter and sort
        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                filterButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                filterBooks(button.dataset.filter);
            });
        });
        
        sortSelect.addEventListener('change', () => sortBooks());
        
        // Delete book
        deleteBookBtn.addEventListener('click', handleDeleteBook);
        
        // Add chapter
        addChapterBtn.addEventListener('click', addChapter);
        
        // Scroll event for header
        window.addEventListener('scroll', () => {
            const header = document.getElementById('header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });

        // Functions
        function initializeApp() {
            showLoading();
            
            // Check if user is banned
            checkUserBan();
            
            // Load data from localStorage
            loadUserData();
            loadBooks();
            loadSeries();
            loadComments();
            loadChapterComments();
            loadUserRatings();
            loadUserVotes();
            loadUserProfiles();
            loadDeletedComments();
            loadBookViews();
            loadBannedUsers();
            loadAuthorMonthlyAwards();
            loadNewsletterData();
            
            // Check author votes reset date
            checkAuthorVotesReset();
            
            // Generate authors from books
            generateAuthors();
            
            // Update UI
            updateAuthUI();
            renderBooks();
            renderGenres();
            renderAuthors();
            updateStats();
            
            // Start with home page
            const hash = window.location.hash.substring(1);
            if (hash) {
                navigateToPage(hash);
            } else {
                navigateToPage('home');
            }
            
            // Animate stats
            animateStats();
            
            hideLoading();
        }

        function showModal(modal) {
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function hideModal(modal) {
            modal.classList.remove('active');
            // Only restore scroll if no other modals are open
                        if (!document.querySelector('.modal.active')) {
                document.body.style.overflow = '';
            }
        }
        
        function showLoading() {
            loadingContainer.classList.add('active');
        }
        
        function hideLoading() {
            loadingContainer.classList.remove('active');
        }
        
        function navigateToPage(page) {
            currentPage = page;
            
            // Update active state in navigation
            navLinks.forEach(link => {
                if (link.getAttribute('data-page') === page) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
            
            // Hide all sections
            document.getElementById('hero').style.display = page === 'home' ? 'block' : 'none';
            document.getElementById('books').style.display = page === 'home' || page === 'books' ? 'block' : 'none';
            genresSection.style.display = page === 'genres' ? 'block' : 'none';
            authorsSection.style.display = page === 'authors' ? 'block' : 'none';
            aboutSection.style.display = page === 'about' ? 'block' : 'none';
            bookDetailSection.style.display = page === 'book-detail' ? 'block' : 'none';
            authorDetailSection.style.display = page === 'author-detail' ? 'block' : 'none';
            userProfileSection.style.display = page === 'user-profile' ? 'block' : 'none';
            
            // Show analytics section only for Dusk
            if (currentUser && currentUser.name === 'Dusk') {
                analyticsSection.style.display = page === 'analytics' ? 'block' : 'none';
                
                // Show newsletter section in user profile page for Dusk
                if (page === 'user-profile' && currentUser.id === userProfileSection.dataset.userId) {
                    newsletterSection.style.display = 'block';
                    renderNewsletterSection();
                } else {
                    newsletterSection.style.display = 'none';
                }
                
                // Update analytics data when navigating to the page
                if (page === 'analytics') {
                    updateAnalyticsData('overview');
                }
            } else {
                analyticsSection.style.display = 'none';
                newsletterSection.style.display = 'none';
            }
            
            // Update page title
            switch(page) {
                case 'home':
                    document.title = 'Book City - Your Online Book Community';
                    break;
                case 'books':
                    document.title = 'Books - Book City';
                    break;
                case 'genres':
                    document.title = 'Genres - Book City';
                    break;
                case 'authors':
                    document.title = 'Authors - Book City';
                    break;
                case 'about':
                    document.title = 'About - Book City';
                    break;
                case 'book-detail':
                    const book = books.find(b => b.id === currentBookId);
                    if (book) {
                        document.title = `${book.title} - Book City`;
                        // Increment book views
                        incrementBookViews(currentBookId);
                    }
                    break;
                case 'author-detail':
                    const author = authors.find(a => a.id === currentAuthorId);
                    if (author) {
                        document.title = `${author.name} - Book City`;
                    }
                    break;
                case 'user-profile':
                    if (currentUser) {
                        document.title = `${currentUser.name}'s Profile - Book City`;
                    }
                    break;
                case 'analytics':
                    document.title = 'Analytics Dashboard - Book City';
                    break;
            }
            
            // Update URL without page refresh
            if (page !== 'home') {
                history.pushState(null, '', `#${page}`);
            } else {
                history.pushState(null, '', baseUrl);
            }
            
            // Scroll to top when changing pages
            window.scrollTo(0, 0);
        }

        function loadUserData() {
            const userData = localStorage.getItem('bookCityUser');
            if (userData) {
                currentUser = JSON.parse(userData);
            }
        }

        function loadBooks() {
            const booksData = localStorage.getItem('bookCityBooks');
            if (booksData) {
                books = JSON.parse(booksData);
            }
        }

        function loadSeries() {
            const seriesData = localStorage.getItem('bookCitySeries');
            if (seriesData) {
                series = JSON.parse(seriesData);
            }
        }

        function loadComments() {
            const commentsData = localStorage.getItem('bookCityComments');
            if (commentsData) {
                bookComments = JSON.parse(commentsData);
            }
        }

        function loadChapterComments() {
            const chapterCommentsData = localStorage.getItem('bookCityChapterComments');
            if (chapterCommentsData) {
                chapterComments = JSON.parse(chapterCommentsData);
            }
        }

        function loadUserRatings() {
            const ratingsData = localStorage.getItem('bookCityUserRatings');
            if (ratingsData) {
                userRatings = JSON.parse(ratingsData);
            }
        }

        function loadUserVotes() {
            const bookVotesData = localStorage.getItem('bookCityUserBookVotes');
            if (bookVotesData) {
                userBookVotes = JSON.parse(bookVotesData);
            }
            
            const authorVotesData = localStorage.getItem('bookCityUserAuthorVotes');
            if (authorVotesData) {
                userAuthorVotes = JSON.parse(authorVotesData);
            }
        }
        
        function loadUserProfiles() {
            const profilesData = localStorage.getItem('bookCityUserProfiles');
            if (profilesData) {
                userProfiles = JSON.parse(profilesData);
            }
        }
        
        function loadDeletedComments() {
            const deletedCommentsData = localStorage.getItem('bookCityDeletedComments');
            if (deletedCommentsData) {
                deletedComments = JSON.parse(deletedCommentsData);
            }
            
            const deletedChapterCommentsData = localStorage.getItem('bookCityDeletedChapterComments');
            if (deletedChapterCommentsData) {
                deletedChapterComments = JSON.parse(deletedChapterCommentsData);
            }
        }
        
        function loadBookViews() {
            const viewsData = localStorage.getItem('bookCityBookViews');
            if (viewsData) {
                bookViews = JSON.parse(viewsData);
            }
        }
        
        function loadBannedUsers() {
            const bannedData = localStorage.getItem('bookCityBannedUsers');
            if (bannedData) {
                bannedUsers = JSON.parse(bannedData);
            }
        }
        
        function loadAuthorMonthlyAwards() {
            const awardsData = localStorage.getItem('bookCityAuthorAwards');
            if (awardsData) {
                authorMonthlyAwards = JSON.parse(awardsData);
            }
            
            const enabledData = localStorage.getItem('bookCityAchievementsEnabled');
            if (enabledData !== null) {
                authorAchievementsEnabled = JSON.parse(enabledData);
            }
        }
        
        function loadNewsletterData() {
            const subscribersData = localStorage.getItem('bookCityNewsletterSubscribers');
            if (subscribersData) {
                newsletterSubscribers = JSON.parse(subscribersData);
            }
            
            const sentNewslettersData = localStorage.getItem('bookCitySentNewsletters');
            if (sentNewslettersData) {
                sentNewsletters = JSON.parse(sentNewslettersData);
            }
        }

        function saveUserData() {
            localStorage.setItem('bookCityUser', JSON.stringify(currentUser));
        }

        function saveBooks() {
            localStorage.setItem('bookCityBooks', JSON.stringify(books));
        }

        function saveSeries() {
            localStorage.setItem('bookCitySeries', JSON.stringify(series));
        }

        function saveComments() {
            localStorage.setItem('bookCityComments', JSON.stringify(bookComments));
        }

        function saveChapterComments() {
            localStorage.setItem('bookCityChapterComments', JSON.stringify(chapterComments));
        }

        function saveUserRatings() {
            localStorage.setItem('bookCityUserRatings', JSON.stringify(userRatings));
        }

        function saveUserVotes() {
            localStorage.setItem('bookCityUserBookVotes', JSON.stringify(userBookVotes));
            localStorage.setItem('bookCityUserAuthorVotes', JSON.stringify(userAuthorVotes));
        }
        
        function saveUserProfiles() {
            localStorage.setItem('bookCityUserProfiles', JSON.stringify(userProfiles));
        }
        
        function saveDeletedComments() {
            localStorage.setItem('bookCityDeletedComments', JSON.stringify(deletedComments));
            localStorage.setItem('bookCityDeletedChapterComments', JSON.stringify(deletedChapterComments));
        }
        
        function saveBookViews() {
            localStorage.setItem('bookCityBookViews', JSON.stringify(bookViews));
        }
        
        function saveBannedUsers() {
            localStorage.setItem('bookCityBannedUsers', JSON.stringify(bannedUsers));
        }
        
        function saveAuthorMonthlyAwards() {
            localStorage.setItem('bookCityAuthorAwards', JSON.stringify(authorMonthlyAwards));
            localStorage.setItem('bookCityAchievementsEnabled', JSON.stringify(authorAchievementsEnabled));
        }
        
        function saveNewsletterData() {
            localStorage.setItem('bookCityNewsletterSubscribers', JSON.stringify(newsletterSubscribers));
            localStorage.setItem('bookCitySentNewsletters', JSON.stringify(sentNewsletters));
        }
        
        function checkAuthorVotesReset() {
            // Author votes are reset monthly
            const resetDateStr = localStorage.getItem('authorVotesResetDate');
            
            if (resetDateStr) {
                authorVotesResetDate = new Date(resetDateStr);
                
                // Check if it's a new month
                const now = new Date();
                if (now.getMonth() !== authorVotesResetDate.getMonth() || 
                    now.getFullYear() !== authorVotesResetDate.getFullYear()) {
                    // Reset votes and update reset date
                    resetAuthorVotes();
                    
                    // Award monthly achievement to top author
                    if (authorAchievementsEnabled) {
                        awardMonthlyAchievement();
                    }
                }
            } else {
                // Set initial reset date
                authorVotesResetDate = new Date();
                localStorage.setItem('authorVotesResetDate', authorVotesResetDate.toISOString());
                
                // Initialize author votes daily count
                if (currentUser) {
                    if (!userAuthorVotes[currentUser.id]) {
                        userAuthorVotes[currentUser.id] = {};
                    }
                    userAuthorVotes[currentUser.id].dailyVotesLeft = authorVotesPerDay;
                    userAuthorVotes[currentUser.id].lastVoteDate = new Date().toISOString();
                    saveUserVotes();
                }
            }
        }
        
        function resetAuthorVotes() {
            // Save the current month's awards before resetting
            if (authorAchievementsEnabled) {
                awardMonthlyAchievement();
            }
            
            // Reset all users' daily vote counts
            for (const userId in userAuthorVotes) {
                userAuthorVotes[userId].dailyVotesLeft = authorVotesPerDay;
            }
            
            // Update reset date
            authorVotesResetDate = new Date();
            localStorage.setItem('authorVotesResetDate', authorVotesResetDate.toISOString());
            
            // Save changes
            saveUserVotes();
        }
        
        function awardMonthlyAchievement() {
            // Calculate top author based on upvotes
            let topAuthor = null;
            let topVotes = 0;
            let tiedAuthors = [];
            
            authors.forEach(author => {
                const upvotes = author.upvotes || 0;
                
                // Skip if no votes
                if (upvotes === 0) return;
                
                if (upvotes > topVotes) {
                    topVotes = upvotes;
                    topAuthor = author;
                    tiedAuthors = [author];
                } else if (upvotes === topVotes) {
                    tiedAuthors.push(author);
                }
            });
            
            // Skip if no authors have votes
            if (topVotes === 0) return;
            
            // Get previous month name
            const now = new Date();
            now.setDate(1);
            now.setHours(-1); // Go to last month
            const monthName = new Intl.DateTimeFormat('en-US', { month: 'long' }).format(now);
            const year = now.getFullYear();
            
            // Create award for each tied author
            tiedAuthors.forEach(author => {
                // Create award
                const award = {
                    id: `award_${Date.now()}_${Math.floor(Math.random() * 1000)}`,
                    month: monthName,
                    year: year,
                    votes: topVotes,
                    date: new Date().toISOString()
                };
                
                // Add award to author
                if (!authorMonthlyAwards[author.id]) {
                    authorMonthlyAwards[author.id] = [];
                }
                authorMonthlyAwards[author.id].push(award);
            });
            
            // Save awards
            saveAuthorMonthlyAwards();
        }
        
        function checkUserBan() {
            // Check if user is banned
            const userData = localStorage.getItem('bookCityUser');
            if (!userData) return;
            
            const user = JSON.parse(userData);
            const now = new Date();
            
            if (bannedUsers[user.email]) {
                const ban = bannedUsers[user.email];
                const banEndDate = new Date(ban.endDate);
                
                if (now < banEndDate) {
                    // User is still banned
                    showBanMessage(ban);
                } else {
                    // Ban has expired, remove it
                    delete bannedUsers[user.email];
                    saveBannedUsers();
                }
            }
        }
        
        function showBanMessage(ban) {
            // Format ban duration for display
            let durationText;
            if (ban.duration === 'permanent') {
                durationText = 'permanently';
            } else {
                durationText = `for ${ban.duration} ${ban.duration === 1 ? 'day' : 'days'}`;
            }
            
            // Update ban message
            banDurationDisplay.textContent = durationText;
            
            // Show ban overlay
            banOverlay.style.display = 'flex';
            
            // Disable all interactions
            document.body.style.overflow = 'hidden';
        }
        
        function incrementBookViews(bookId) {
            // Initialize book views if not exists
            if (!bookViews[bookId]) {
                bookViews[bookId] = {
                    total: 0,
                    uniqueUsers: {},
                    viewDates: []
                };
            }
            
            // Add view
            bookViews[bookId].total++;
            
            // Add unique user if logged in
            if (currentUser) {
                bookViews[bookId].uniqueUsers[currentUser.id] = true;
            }
            
            // Add timestamp
            bookViews[bookId].viewDates.push(new Date().toISOString());
            
            // Update book detail page if visible
            if (currentPage === 'book-detail' && currentBookId === bookId) {
                bookDetailViews.textContent = `${bookViews[bookId].total} views`;
            }
            
            // Save book views
            saveBookViews();
        }
        
        function handleNewsletterSignup(e) {
            e.preventDefault();
            
            const emailInput = e.target.querySelector('input[type="email"]');
            const email = emailInput.value.trim();
            
            if (!email || !isValidEmail(email)) {
                showAlert('warning', 'Invalid Email', 'Please enter a valid email address.');
                return;
            }
            
            // Check if email is already subscribed
            if (newsletterSubscribers[email]) {
                showAlert('warning', 'Already Subscribed', 'This email is already subscribed to our newsletter.');
                return;
            }
            
            // Add to subscribers
            newsletterSubscribers[email] = {
                email: email,
                subscribeDate: new Date().toISOString(),
                active: true
            };
            
            // Save data
            saveNewsletterData();
            
            // Clear form and show success message
            emailInput.value = '';
            showAlert('success', 'Subscription Successful', 'Thank you for subscribing to our newsletter!');
            
            // Update newsletter section if visible
            if (newsletterSection.style.display === 'block') {
                renderNewsletterSection();
            }
        }
        
        function handleSendNewsletter(e) {
            e.preventDefault();
            
            if (!currentUser || currentUser.name !== 'Dusk') {
                showAlert('danger', 'Permission Denied', 'Only Dusk can send newsletters.');
                return;
            }
            
            const subject = document.getElementById('newsletter-subject').value.trim();
            const content = document.getElementById('newsletter-content').value.trim();
            
            if (!subject) {
                showAlert('warning', 'Missing Subject', 'Please enter a subject for your newsletter.');
                return;
            }
            
            if (!content) {
                showAlert('warning', 'Missing Content', 'Please enter content for your newsletter.');
                return;
            }
            
            // Get active subscribers
            const activeSubscribers = Object.values(newsletterSubscribers).filter(sub => sub.active);
            
            if (activeSubscribers.length === 0) {
                showAlert('warning', 'No Subscribers', 'There are no active subscribers to send the newsletter to.');
                return;
            }
            
            // Show loading
            showLoading();
            
            // Simulate sending (would actually send via server-side email service)
            setTimeout(() => {
                // Create newsletter record
                const newsletter = {
                    id: `newsletter_${Date.now()}`,
                    subject: subject,
                    content: content,
                    sentDate: new Date().toISOString(),
                    sentBy: currentUser.name,
                    recipientCount: activeSubscribers.length,
                    recipients: activeSubscribers.map(sub => sub.email)
                };
                
                // Add to history
                sentNewsletters.unshift(newsletter);
                
                // Save data
                saveNewsletterData();
                
                // Clear form
                document.getElementById('newsletter-subject').value = '';
                document.getElementById('newsletter-content').value = '';
                
                // Update newsletter section
                renderNewsletterSection();
                
                // Show success message
                showAlert('success', 'Newsletter Sent', `Your newsletter has been sent to ${activeSubscribers.length} subscribers.`);
                
                // Hide loading
                hideLoading();
            }, 1500);
        }
        
        function removeNewsletterSubscriber(email) {
            if (!currentUser || currentUser.name !== 'Dusk') {
                showAlert('danger', 'Permission Denied', 'Only Dusk can manage subscribers.');
                return;
            }
            
            if (confirm(`Are you sure you want to remove ${email} from the newsletter subscribers?`)) {
                delete newsletterSubscribers[email];
                saveNewsletterData();
                renderNewsletterSection();
                showAlert('success', 'Subscriber Removed', `${email} has been removed from the newsletter subscribers.`);
            }
        }
        
        function renderNewsletterSection() {
            // Render subscribers list
            const subscribers = Object.values(newsletterSubscribers);
            
            if (subscribers.length === 0) {
                emptySubscribers.style.display = 'block';
                subscribersContainer.innerHTML = '';
            } else {
                emptySubscribers.style.display = 'none';
                subscribersContainer.innerHTML = '';
                
                // Sort by date (newest first)
                subscribers.sort((a, b) => new Date(b.subscribeDate) - new Date(a.subscribeDate));
                
                subscribers.forEach(subscriber => {
                    const subscriberItem = document.createElement('div');
                    subscriberItem.className = 'subscriber-item';
                    subscriberItem.innerHTML = `
                        <div class="subscriber-info">
                            <div class="subscriber-email">${subscriber.email}</div>
                            <div class="subscriber-date">Subscribed ${formatTimeAgo(subscriber.subscribeDate)}</div>
                        </div>
                        <div class="subscriber-actions">
                            <button type="button" class="remove-subscriber-btn" data-email="${subscriber.email}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    // Add event listener to remove button
                    subscriberItem.querySelector('.remove-subscriber-btn').addEventListener('click', () => {
                        removeNewsletterSubscriber(subscriber.email);
                    });
                    
                    subscribersContainer.appendChild(subscriberItem);
                });
            }
            
            // Render newsletter history
            if (sentNewsletters.length === 0) {
                emptyNewsletterHistory.style.display = 'block';
                newsletterHistoryContainer.innerHTML = '';
            } else {
                emptyNewsletterHistory.style.display = 'none';
                newsletterHistoryContainer.innerHTML = '';
                
                sentNewsletters.forEach(newsletter => {
                    const newsletterItem = document.createElement('div');
                    newsletterItem.className = 'newsletter-item';
                    newsletterItem.innerHTML = `
                        <div class="newsletter-item-header">
                            <div class="newsletter-item-title">${newsletter.subject}</div>
                            <div class="newsletter-item-date">${formatDate(newsletter.sentDate)}</div>
                        </div>
                        <div class="newsletter-item-content">
                            <p>${newsletter.content.substring(0, 100)}${newsletter.content.length > 100 ? '...' : ''}</p>
                        </div>
                        <div class="newsletter-item-stats">
                            <div><i class="fas fa-users"></i> ${newsletter.recipientCount} recipients</div>
                            <div><i class="fas fa-user"></i> Sent by ${newsletter.sentBy}</div>
                        </div>
                    `;
                    
                    newsletterHistoryContainer.appendChild(newsletterItem);
                });
            }
        }
        
        function generateAuthors() {
            const authorsMap = {};
            
            books.forEach(book => {
                if (!authorsMap[book.author]) {
                    // Create new author entry
                    authorsMap[book.author] = {
                        id: `author_${Date.now()}_${Math.floor(Math.random() * 1000)}`,
                        name: book.author,
                        books: [book.id],
                        totalRatings: book.ratings ? book.ratings.length : 0,
                        avgRating: calculateAverageRating(book.ratings || []),
                        bio: `${book.author} is a talented author known for their compelling storytelling and captivating characters.`,
                        image: book.cover,
                        upvotes: 0,
                        downvotes: 0
                    };
                } else {
                    // Update existing author
                    authorsMap[book.author].books.push(book.id);
                    authorsMap[book.author].totalRatings += book.ratings ? book.ratings.length : 0;
                    
                    // Recalculate average rating
                    const authorBooks = books.filter(b => b.author === book.author);
                    let totalRating = 0;
                    let ratingCount = 0;
                    
                    authorBooks.forEach(b => {
                        if (b.ratings && b.ratings.length > 0) {
                            totalRating += calculateAverageRating(b.ratings) * b.ratings.length;
                            ratingCount += b.ratings.length;
                        }
                    });
                    
                    authorsMap[book.author].avgRating = ratingCount > 0 ? totalRating / ratingCount : 0;
                }
            });
            
            // Convert to array
            authors = Object.values(authorsMap);
            
            // Sort by book count
            authors.sort((a, b) => b.books.length - a.books.length);
        }

        function updateAuthUI() {
            const authButtons = document.querySelector('.auth-buttons');
            
            if (currentUser) {
                // User is logged in
                authButtons.innerHTML = `
                    <button class="btn btn-secondary" id="dashboard-btn">My Books</button>
                    <button class="btn" id="add-book-btn">Add Book</button>
                    <div class="user-dropdown">
                        <button class="btn" id="user-btn">
                            <i class="fas fa-user"></i> ${currentUser.name}
                        </button>
                        <div class="dropdown-menu">
                            <a href="#" id="profile-link">Profile</a>
                            ${currentUser.name === 'Dusk' ? '<a href="#" id="analytics-link">Analytics</a>' : ''}
                            <a href="#" id="logout-btn">Logout</a>
                        </div>
                    </div>
                `;
                
                mobileAuthButtons.innerHTML = `
                    <button class="btn btn-secondary" id="mobile-dashboard-btn">My Books</button>
                    <button class="btn" id="mobile-add-book-btn">Add Book</button>
                    <button class="btn" id="mobile-profile-btn">Profile</button>
                    ${currentUser.name === 'Dusk' ? '<button class="btn" id="mobile-analytics-btn">Analytics</button>' : ''}
                    <button class="btn btn-secondary" id="mobile-logout-btn">Logout</button>
                `;
                
                // Add event listeners for new buttons
                document.getElementById('add-book-btn').addEventListener('click', () => showModal(addBookModal));
                document.getElementById('profile-link').addEventListener('click', (e) => {
                    e.preventDefault();
                    showUserProfile(currentUser.id);
                });
                
                if (currentUser.name === 'Dusk') {
                    document.getElementById('analytics-link').addEventListener('click', (e) => {
                        e.preventDefault();
                        navigateToPage('analytics');
                    });
                    
                    if (document.getElementById('mobile-analytics-btn')) {
                        document.getElementById('mobile-analytics-btn').addEventListener('click', () => {
                            hideModal(mobileMenu);
                            hideModal(menuBackdrop);
                            navigateToPage('analytics');
                        });
                    }
                }
                
                document.getElementById('mobile-add-book-btn').addEventListener('click', () => {
                    hideModal(mobileMenu);
                    hideModal(menuBackdrop);
                    showModal(addBookModal);
                });
                
                document.getElementById('mobile-profile-btn').addEventListener('click', () => {
                    hideModal(mobileMenu);
                    hideModal(menuBackdrop);
                    showUserProfile(currentUser.id);
                });
                
                document.getElementById('logout-btn').addEventListener('click', handleLogout);
                document.getElementById('mobile-logout-btn').addEventListener('click', handleLogout);
                
                // Check if the user is Dusk and show edit buttons if so
                if (currentUser.name === 'Dusk') {
                    editAuthorBtn.style.display = 'block';
                    
                    // Add Analytics to nav menu for Dusk
                    const navLinks = document.querySelector('.nav-links');
                    if (!document.getElementById('analytics-nav-link')) {
                        const analyticsLi = document.createElement('li');
                        const analyticsLink = document.createElement('a');
                        analyticsLink.href = '#analytics';
                        analyticsLink.textContent = 'Analytics';
                        analyticsLink.id = 'analytics-nav-link';
                        analyticsLink.setAttribute('data-page', 'analytics');
                        analyticsLink.addEventListener('click', (e) => {
                            e.preventDefault();
                            navigateToPage('analytics');
                        });
                        analyticsLi.appendChild(analyticsLink);
                        navLinks.appendChild(analyticsLi);
                    }
                } else {
                    editAuthorBtn.style.display = 'none';
                }
                
                // Update user's remaining author votes
                updateRemainingAuthorVotes();
            } else {
                // User is not logged in
                authButtons.innerHTML = `
                    <button class="btn btn-secondary" id="login-btn">Login</button>
                    <button class="btn" id="signup-btn">Sign Up</button>
                `;
                
                mobileAuthButtons.innerHTML = `
                    <button class="btn btn-secondary" id="mobile-login-btn">Login</button>
                    <button class="btn" id="mobile-signup-btn">Sign Up</button>
                `;
                
                // Add event listeners for auth buttons
                document.getElementById('login-btn').addEventListener('click', () => showModal(loginModal));
                document.getElementById('signup-btn').addEventListener('click', () => showModal(signupModal));
                document.getElementById('mobile-login-btn').addEventListener('click', () => {
                    hideModal(mobileMenu);
                    hideModal(menuBackdrop);
                    showModal(loginModal);
                });
                document.getElementById('mobile-signup-btn').addEventListener('click', () => {
                    hideModal(mobileMenu);
                    hideModal(menuBackdrop);
                    showModal(signupModal);
                });
                
                // Hide edit buttons
                editAuthorBtn.style.display = 'none';
                
                // Remove Analytics from nav menu if not Dusk
                const analyticsNavLink = document.getElementById('analytics-nav-link');
                if (analyticsNavLink) {
                    analyticsNavLink.parentNode.remove();
                }
            }
        }
        
        function updateRemainingAuthorVotes() {
            if (!currentUser) return;
            
            // Initialize if not exist
            if (!userAuthorVotes[currentUser.id]) {
                userAuthorVotes[currentUser.id] = {};
            }
            
            if (userAuthorVotes[currentUser.id].dailyVotesLeft === undefined) {
                userAuthorVotes[currentUser.id].dailyVotesLeft = authorVotesPerDay;
                userAuthorVotes[currentUser.id].lastVoteDate = new Date().toISOString();
                saveUserVotes();
            }
            
                        // Update votes left display
            if (authorVotesLeft) {
                authorVotesLeft.textContent = userAuthorVotes[currentUser.id].dailyVotesLeft;
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            // Validate inputs
            let isValid = true;
            
            if (!email) {
                showError('login-email-error', 'Please enter your email');
                isValid = false;
            } else if (!isValidEmail(email)) {
                showError('login-email-error', 'Please enter a valid email address');
                isValid = false;
            } else {
                hideError('login-email-error');
            }
            
            if (!password) {
                showError('login-password-error', 'Please enter your password');
                isValid = false;
            } else {
                hideError('login-password-error');
            }
            
            if (!isValid) return;
            
            // Check if email is banned
            if (bannedUsers[email]) {
                const ban = bannedUsers[email];
                const now = new Date();
                const banEndDate = new Date(ban.endDate);
                
                if (now < banEndDate) {
                    showAlert('danger', 'Account Banned', `This account has been suspended ${ban.duration === 'permanent' ? 'permanently' : 'temporarily'}.`);
                    return;
                } else {
                    // Ban has expired, remove it
                    delete bannedUsers[email];
                    saveBannedUsers();
                }
            }
            
            // Show loading
            showLoading();
            
            // Simulate API call
            setTimeout(() => {
                // Check if user exists with this email
                const existingUsers = Object.values(userProfiles).filter(u => u.email === email);
                if (existingUsers.length > 0) {
                    // User found, set as current user
                    currentUser = {
                        id: existingUsers[0].id,
                        name: existingUsers[0].name,
                        email: email
                    };
                } else {
                    // Create new user
                    currentUser = {
                        id: 'user_' + Date.now(),
                        name: 'Dusk', // Default name is Dusk
                        email: email
                    };
                    
                    // Save user profile
                    userProfiles[currentUser.id] = {
                        id: currentUser.id,
                        name: currentUser.name,
                        email: email,
                        joinedDate: new Date().toISOString(),
                        bio: '',
                        profileImage: ''
                    };
                    saveUserProfiles();
                }
                
                saveUserData();
                updateAuthUI();
                hideModal(loginModal);
                showAlert('success', 'Welcome back!', 'You have successfully logged in.');
                
                // Initialize author votes if needed
                if (!userAuthorVotes[currentUser.id]) {
                    userAuthorVotes[currentUser.id] = {
                        dailyVotesLeft: authorVotesPerDay,
                        lastVoteDate: new Date().toISOString()
                    };
                    saveUserVotes();
                }
                
                // Check author votes reset
                checkAuthorVotesReset();
                
                // Check if user is banned
                checkUserBan();
                
                // Hide loading
                hideLoading();
            }, 800);
        }

        function handleSignup(e) {
            e.preventDefault();
            
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const confirm = document.getElementById('signup-confirm').value;
            const terms = document.getElementById('terms').checked;
            
            // Validate inputs
            let isValid = true;
            
            if (!name) {
                showError('signup-name-error', 'Please enter a username');
                isValid = false;
            } else {
                // Check if username is already taken
                const existingUsernames = Object.values(userProfiles).filter(u => u.name.toLowerCase() === name.toLowerCase());
                if (existingUsernames.length > 0) {
                    showError('signup-name-error', 'This username is already taken');
                    isValid = false;
                } else {
                    hideError('signup-name-error');
                }
            }
            
            if (!email) {
                showError('signup-email-error', 'Please enter your email');
                isValid = false;
            } else if (!isValidEmail(email)) {
                showError('signup-email-error', 'Please enter a valid email address');
                isValid = false;
            } else {
                // Check if email is already registered
                const existingEmails = Object.values(userProfiles).filter(u => u.email.toLowerCase() === email.toLowerCase());
                if (existingEmails.length > 0) {
                    showError('signup-email-error', 'This email is already registered');
                    isValid = false;
                } else {
                    hideError('signup-email-error');
                }
            }
            
            if (!password) {
                showError('signup-password-error', 'Please enter a password');
                isValid = false;
            } else if (password.length < 6) {
                showError('signup-password-error', 'Password must be at least 6 characters');
                isValid = false;
            } else {
                hideError('signup-password-error');
            }
            
            if (password !== confirm) {
                showError('signup-confirm-error', 'Passwords do not match');
                isValid = false;
            } else {
                hideError('signup-confirm-error');
            }
            
            if (!terms) {
                isValid = false;
                alert('Please agree to the Terms of Service and Privacy Policy');
            }
            
            if (!isValid) return;
            
            // Check if email is banned
            if (bannedUsers[email]) {
                const ban = bannedUsers[email];
                const now = new Date();
                const banEndDate = new Date(ban.endDate);
                
                if (now < banEndDate) {
                    showAlert('danger', 'Account Banned', `This email has been banned ${ban.duration === 'permanent' ? 'permanently' : 'temporarily'}.`);
                    return;
                } else {
                    // Ban has expired, remove it
                    delete bannedUsers[email];
                    saveBannedUsers();
                }
            }
            
            // Show loading
            showLoading();
            
            // Simulate API call
            setTimeout(() => {
                // Create new user
                currentUser = {
                    id: 'user_' + Date.now(),
                    name: name,
                    email: email
                };
                
                // Save user profile
                userProfiles[currentUser.id] = {
                    id: currentUser.id,
                    name: name,
                    email: email,
                    joinedDate: new Date().toISOString(),
                    bio: '',
                    profileImage: ''
                };
                saveUserProfiles();
                
                // Initialize author votes
                userAuthorVotes[currentUser.id] = {
                    dailyVotesLeft: authorVotesPerDay,
                    lastVoteDate: new Date().toISOString()
                };
                saveUserVotes();
                
                saveUserData();
                updateAuthUI();
                hideModal(signupModal);
                updateStats(); // Update member count
                showAlert('success', 'Account Created!', `Welcome to Book City, ${name}!`);
                
                // Subscribe to newsletter if checked
                newsletterSubscribers[email] = {
                    email: email,
                    subscribeDate: new Date().toISOString(),
                    active: true
                };
                saveNewsletterData();
                
                // Hide loading
                hideLoading();
            }, 800);
        }

        function handleLogout() {
            // Show loading
            showLoading();
            
            // Check if user is banned and prevent logout if so
            if (currentUser && bannedUsers[currentUser.email]) {
                const ban = bannedUsers[currentUser.email];
                const now = new Date();
                const banEndDate = new Date(ban.endDate);
                
                if (now < banEndDate) {
                    hideLoading();
                    showAlert('danger', 'Logout Restricted', 'You cannot log out while your account is suspended.');
                    return;
                }
            }
            
            // Simulate API call
            setTimeout(() => {
                currentUser = null;
                saveUserData();
                updateAuthUI();
                showAlert('success', 'Logged Out', 'You have been successfully logged out.');
                
                // Hide loading
                hideLoading();
                
                // If on a page that requires login, navigate to home
                if (['dashboard', 'user-profile', 'analytics'].includes(currentPage)) {
                    navigateToPage('home');
                }
            }, 500);
        }

        function handleAddBook(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showModal(loginModal);
                return;
            }
            
            const title = document.getElementById('book-title').value;
            const author = document.getElementById('book-author').value;
            const genre = document.getElementById('book-genre').value;
            const description = document.getElementById('book-description').value;
            const coverUrl = document.getElementById('book-cover-url').value;
            const seriesName = document.getElementById('book-series').value;
            const seriesNumber = document.getElementById('book-series-number').value;
            
            // Validate inputs
            let isValid = true;
            
            if (!title) {
                showError('book-title-error', 'Please enter a title');
                isValid = false;
            } else {
                hideError('book-title-error');
            }
            
            if (!author) {
                showError('book-author-error', 'Please enter an author');
                isValid = false;
            } else {
                hideError('book-author-error');
            }
            
            if (!genre) {
                showError('book-genre-error', 'Please select a genre');
                isValid = false;
            } else {
                hideError('book-genre-error');
            }
            
            if (!description) {
                showError('book-description-error', 'Please enter a description');
                isValid = false;
            } else {
                hideError('book-description-error');
            }
            
            if (!coverUrl) {
                showError('book-cover-error', 'Please enter a cover image URL');
                isValid = false;
            } else {
                hideError('book-cover-error');
            }
            
            if (!isValid) return;
            
            // Validate series info if provided
            if (seriesName && !seriesNumber) {
                alert('Please provide a series number for this book');
                return;
            }
            
            // Show loading
            showLoading();
            
            // Simulate API call
            setTimeout(() => {
                // Create new book object
                const newBookId = 'book_' + Date.now();
                const newBook = {
                    id: newBookId,
                    title: title,
                    author: author,
                    genre: genre,
                    description: description,
                    cover: coverUrl,
                    createdBy: currentUser ? currentUser.name : 'Anonymous',
                    createdAt: new Date().toISOString(),
                    ratings: [],
                    toc: [],
                    upvotes: 0,
                    downvotes: 0
                };
                
                // Add series info if provided
                if (seriesName) {
                    // Check if series exists
                    if (!series[seriesName]) {
                        series[seriesName] = [];
                    }
                    
                    // Add to series
                    series[seriesName].push({
                        bookId: newBookId,
                        order: parseInt(seriesNumber)
                    });
                    
                    // Sort series by order
                    series[seriesName].sort((a, b) => a.order - b.order);
                    
                    // Save series
                    saveSeries();
                }
                
                // Initialize book views
                bookViews[newBookId] = {
                    total: 0,
                    uniqueUsers: {},
                    viewDates: []
                };
                saveBookViews();
                
                // Add book to collection
                books.unshift(newBook); // Add to beginning to show newest first
                saveBooks();
                
                // Create empty comments array for this book
                bookComments[newBookId] = [];
                saveComments();
                
                // Reset form and close modal
                addBookForm.reset();
                coverPreview.style.display = 'none';
                seriesContent.classList.remove('active');
                toggleSeriesBtn.innerHTML = '<i class="fas fa-plus"></i> Add to a series';
                hideModal(addBookModal);
                
                // Update books display
                renderBooks();
                
                // Update authors
                generateAuthors();
                renderAuthors();
                
                // Update genres
                renderGenres();
                
                // Update stats
                updateStats();
                
                showAlert('success', 'Book Added', 'Your book has been added successfully!');
                
                // Hide loading
                hideLoading();
            }, 1000);
        }

        function handleEditBook(e) {
            e.preventDefault();
            
            if (!currentUser || currentUser.name !== 'Dusk') {
                showAlert('danger', 'Permission Denied', 'Only Dusk can edit books.');
                return;
            }
            
            const bookId = document.getElementById('edit-book-id').value;
            const title = document.getElementById('edit-book-title').value;
            const author = document.getElementById('edit-book-author').value;
            const genre = document.getElementById('edit-book-genre').value;
            const description = document.getElementById('edit-book-description').value;
            const coverUrl = document.getElementById('edit-book-cover-url').value;
            const seriesName = document.getElementById('edit-book-series').value;
            const seriesNumber = document.getElementById('edit-book-series-number').value;
            
            // Validate inputs
            let isValid = true;
            
            if (!title) {
                showError('edit-book-title-error', 'Please enter a title');
                isValid = false;
            } else {
                hideError('edit-book-title-error');
            }
            
            if (!author) {
                showError('edit-book-author-error', 'Please enter an author');
                isValid = false;
            } else {
                hideError('edit-book-author-error');
            }
            
            if (!genre) {
                showError('edit-book-genre-error', 'Please select a genre');
                isValid = false;
            } else {
                hideError('edit-book-genre-error');
            }
            
            if (!description) {
                showError('edit-book-description-error', 'Please enter a description');
                isValid = false;
            } else {
                hideError('edit-book-description-error');
            }
            
            if (!coverUrl) {
                showError('edit-book-cover-error', 'Please enter a cover image URL');
                isValid = false;
            } else {
                hideError('edit-book-cover-error');
            }
            
            if (!isValid) return;
            
            // Validate series info if provided
            if (seriesName && !seriesNumber) {
                alert('Please provide a series number for this book');
                return;
            }
            
            // Show loading
            showLoading();
            
            // Simulate API call
            setTimeout(() => {
                // Find book to update
                const bookIndex = books.findIndex(book => book.id === bookId);
                if (bookIndex === -1) {
                    hideLoading();
                    return;
                }
                
                // Get previous author for updating authors list
                const previousAuthor = books[bookIndex].author;
                
                // First, remove book from any series it might be in
                for (const seriesKey in series) {
                    series[seriesKey] = series[seriesKey].filter(entry => entry.bookId !== bookId);
                    
                    // If series is now empty, delete it
                    if (series[seriesKey].length === 0) {
                        delete series[seriesKey];
                    }
                }
                
                // Add to new series if provided
                if (seriesName) {
                    if (!series[seriesName]) {
                        series[seriesName] = [];
                    }
                    
                    series[seriesName].push({
                        bookId: bookId,
                        order: parseInt(seriesNumber)
                    });
                    
                    // Sort series by order
                    series[seriesName].sort((a, b) => a.order - b.order);
                }
                
                // Save series
                saveSeries();
                
                // Update book
                const book = books[bookIndex];
                book.title = title;
                book.author = author;
                book.genre = genre;
                book.description = description;
                book.cover = coverUrl;
                book.updatedAt = new Date().toISOString();
                
                // Save changes
                saveBooks();
                
                // Close modal and update displays
                hideModal(editBookModal);
                
                // Regenerate authors if the author changed
                if (previousAuthor !== author) {
                    generateAuthors();
                    renderAuthors();
                }
                
                // Update displays
                renderBooks();
                renderGenres();
                
                // If the book detail page is open, update it
                if (currentPage === 'book-detail' && currentBookId === bookId) {
                    showBookDetails(bookId);
                }
                
                showAlert('success', 'Book Updated', 'Book details have been updated successfully!');
                
                // Hide loading
                hideLoading();
            }, 800);
        }

        function handleDeleteBook() {
            if (!currentUser || currentUser.name !== 'Dusk') {
                showAlert('danger', 'Permission Denied', 'Only Dusk can delete books.');
                return;
            }
            
            const bookId = document.getElementById('edit-book-id').value;
            
            if (confirm('Are you sure you want to delete this book? This action cannot be undone.')) {
                // Show loading
                showLoading();
                
                // Simulate API call
                setTimeout(() => {
                    // Remove book from any series
                    for (const seriesKey in series) {
                        series[seriesKey] = series[seriesKey].filter(entry => entry.bookId !== bookId);
                        
                        // If series is now empty, delete it
                        if (series[seriesKey].length === 0) {
                            delete series[seriesKey];
                        }
                    }
                    
                    // Save series
                    saveSeries();
                    
                    // Remove book from collection
                    books = books.filter(book => book.id !== bookId);
                    saveBooks();
                    
                    // Remove comments for this book
                    delete bookComments[bookId];
                    saveComments();
                    
                    // Remove chapter comments for this book
                    for (const chapterId in chapterComments) {
                        if (chapterId.startsWith(`${bookId}_`)) {
                            delete chapterComments[chapterId];
                        }
                    }
                    saveChapterComments();
                    
                    // Remove book views
                    delete bookViews[bookId];
                    saveBookViews();
                    
                    // Close modals
                    hideModal(editBookModal);
                    
                    // Update displays
                    renderBooks();
                    generateAuthors();
                    renderAuthors();
                    renderGenres();
                    updateStats();
                    
                    // If the book detail page is open, go back to books page
                    if (currentPage === 'book-detail' && currentBookId === bookId) {
                        navigateToPage('books');
                    }
                    
                    showAlert('success', 'Book Deleted', 'The book has been deleted successfully.');
                    
                    // Hide loading
                    hideLoading();
                }, 800);
            }
        }

        function handleEditAuthor(e) {
            e.preventDefault();
            
            if (!currentUser || currentUser.name !== 'Dusk') {
                showAlert('danger', 'Permission Denied', 'Only Dusk can edit author information.');
                return;
            }
            
            const authorId = document.getElementById('edit-author-id').value;
            const name = document.getElementById('edit-author-name').value;
            const bio = document.getElementById('edit-author-bio').value;
            const imageUrl = document.getElementById('edit-author-image-url').value;
            const achievementsEnabled = document.getElementById('achievements-enabled').checked;
            
            // Validate inputs
            let isValid = true;
            
            if (!name) {
                showError('edit-author-name-error', 'Please enter an author name');
                isValid = false;
            } else {
                hideError('edit-author-name-error');
            }
            
            if (!bio) {
                showError('edit-author-bio-error', 'Please enter an author bio');
                isValid = false;
            } else {
                hideError('edit-author-bio-error');
            }
            
            if (!isValid) return;
            
            // Show loading
            showLoading();
            
            // Simulate API call
            setTimeout(() => {
                // Find author to update
                const authorIndex = authors.findIndex(author => author.id === authorId);
                if (authorIndex === -1) {
                    hideLoading();
                    return;
                }
                
                const author = authors[authorIndex];
                const oldName = author.name;
                
                // Update author details
                author.name = name;
                author.bio = bio;
                if (imageUrl) {
                    author.image = imageUrl;
                }
                
                // Update author achievements setting
                authorAchievementsEnabled = achievementsEnabled;
                saveAuthorMonthlyAwards();
                
                // If author name changed, update book references
                if (oldName !== name) {
                    books.forEach(book => {
                        if (book.author === oldName) {
                            book.author = name;
                        }
                    });
                    saveBooks();
                }
                
                // Close modal and update displays
                hideModal(editAuthorModal);
                
                // Update displays
                if (currentPage === 'author-detail' && currentAuthorId === authorId) {
                    showAuthorDetails(authorId);
                }
                
                renderAuthors();
                renderBooks();
                
                showAlert('success', 'Author Updated', 'Author details have been updated successfully!');
                
                // Hide loading
                hideLoading();
            }, 800);
        }
        
        function handleEditProfile(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showModal(loginModal);
                return;
            }
            
            const displayName = document.getElementById('edit-profile-name').value;
            const bio = document.getElementById('edit-profile-bio').value;
            const imageUrl = document.getElementById('edit-profile-image-url').value;
            
            // Validate inputs
            let isValid = true;
            
            if (!displayName) {
                showError('edit-profile-name-error', 'Please enter a display name');
                isValid = false;
            } else {
                // Check if name is taken by another user
                const existingNames = Object.values(userProfiles).filter(
                    profile => profile.id !== currentUser.id && 
                    profile.name.toLowerCase() === displayName.toLowerCase()
                );
                
                if (existingNames.length > 0) {
                    showError('edit-profile-name-error', 'This display name is already taken');
                    isValid = false;
                } else {
                    hideError('edit-profile-name-error');
                }
            }
            
            if (!isValid) return;
            
            // Show loading
            showLoading();
            
            // Simulate API call
            setTimeout(() => {
                // Update user profile
                if (!userProfiles[currentUser.id]) {
                    userProfiles[currentUser.id] = {
                        id: currentUser.id,
                        name: currentUser.name,
                        email: currentUser.email,
                        joinedDate: new Date().toISOString(),
                        bio: '',
                        profileImage: ''
                    };
                }
                
                // Update profile data
                userProfiles[currentUser.id].name = displayName;
                userProfiles[currentUser.id].bio = bio;
                
                if (imageUrl) {
                    userProfiles[currentUser.id].profileImage = imageUrl;
                }
                
                // Update current user
                currentUser.name = displayName;
                
                // Save changes
                saveUserProfiles();
                saveUserData();
                
                // Close modal and update UI
                hideModal(editProfileModal);
                updateAuthUI();
                
                // If on profile page, update it
                if (currentPage === 'user-profile') {
                    showUserProfile(currentUser.id);
                }
                
                showAlert('success', 'Profile Updated', 'Your profile has been updated successfully!');
                
                // Hide loading
                hideLoading();
            }, 800);
        }

        function handleAddComment(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showModal(loginModal);
                return;
            }
            
            const commentText = document.getElementById('comment-text').value;
            const ratingValue = document.querySelector('input[name="rating"]:checked');
            
            if (!commentText) {
                alert('Please write a comment');
                return;
            }
            
            if (!ratingValue) {
                alert('Please select a rating');
                return;
            }
            
            const rating = parseInt(ratingValue.value);
            
            // Show loading
            showLoading();
            
            // Simulate API call
            setTimeout(() => {
                // Create comment object
                const newComment = {
                    id: 'comment_' + Date.now(),
                    bookId: currentBookId,
                    userId: currentUser.id,
                    username: currentUser.name,
                    rating: rating,
                    text: commentText,
                    createdAt: new Date().toISOString(),
                    isDeleted: false
                };
                
                // Add comment to book's comments
                if (!bookComments[currentBookId]) {
                    bookComments[currentBookId] = [];
                }
                bookComments[currentBookId].unshift(newComment); // Add to beginning to show newest first
                saveComments();
                
                // Update user ratings
                if (!userRatings[currentUser.id]) {
                    userRatings[currentUser.id] = {};
                }
                userRatings[currentUser.id][currentBookId] = rating;
                saveUserRatings();
                
                // Update book ratings
                const book = books.find(book => book.id === currentBookId);
                if (book) {
                    // Check if user already rated this book
                    const existingRatingIndex = book.ratings.findIndex(r => r.userId === currentUser.id);
                    
                    if (existingRatingIndex !== -1) {
                        // Update existing rating
                        book.ratings[existingRatingIndex].rating = rating;
                    } else {
                        // Add new rating
                        book.ratings.push({
                            userId: currentUser.id,
                            rating: rating
                        });
                    }
                    
                    saveBooks();
                }
                
                // Reset form
                addCommentForm.reset();
                document.getElementById('comment-text').value = '';
                
                // Update UI
                renderBookComments(currentBookId);
                updateBookRatingDisplay(book);
                
                // Update stats
                updateStats();
                
                showAlert('success', 'Review Added', 'Your review has been added successfully!');
                
                // Hide loading
                hideLoading();
            }, 800);
        }
        function handleAddChapterComment(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showModal(loginModal);
                return;
            }
            
            const chapterId = commentChapterId.value;
            const bookId = commentBookId.value;
            const commentText = document.getElementById('chapter-comment-text').value;
            
            if (!commentText) {
                alert('Please write a comment');
                return;
            }
            
            // Show loading
            showLoading();
            
            // Simulate API call
            setTimeout(() => {
                // Create comment object
                const newComment = {
                    id: 'chapter_comment_' + Date.now(),
                    chapterId: chapterId,
                    bookId: bookId,
                    userId: currentUser.id,
                    username: currentUser.name,
                    text: commentText,
                    createdAt: new Date().toISOString(),
                    isDeleted: false
                };
                
                // Add comment to chapter's comments
                const fullChapterId = `${bookId}_${chapterId}`;
                if (!chapterComments[fullChapterId]) {
                    chapterComments[fullChapterId] = [];
                }
                chapterComments[fullChapterId].unshift(newComment); // Add to beginning to show newest first
                saveChapterComments();
                
                // Reset form
                addChapterCommentForm.reset();
                document.getElementById('chapter-comment-text').value = '';
                
                // Update UI
                renderChapterComments(chapterId, bookId);
                
                // Update TOC display to show comments count
                renderToc(bookId);
                
                // Update stats
                updateStats();
                
                showAlert('success', 'Comment Added', 'Your comment has been added to this chapter!');
                
                // Hide loading
                hideLoading();
            }, 800);
        }
        
        function handleAddBan(e) {
            e.preventDefault();
            
            if (!currentUser || currentUser.name !== 'Dusk') {
                showAlert('danger', 'Permission Denied', 'Only Dusk can ban users.');
                return;
            }
            
            const email = document.getElementById('ban-email').value;
            const duration = document.getElementById('ban-duration').value;
            const reason = document.getElementById('ban-reason').value;
            
            // Validate inputs
            let isValid = true;
            
            if (!email || !isValidEmail(email)) {
                showError('ban-email-error', 'Please enter a valid email address');
                isValid = false;
            } else {
                hideError('ban-email-error');
            }
            
            if (!isValid) return;
            
            // Show loading
            showLoading();
            
            // Simulate API call
            setTimeout(() => {
                // Calculate ban end date
                const now = new Date();
                let banEndDate;
                
                if (duration === 'permanent') {
                    // Set a very far future date for permanent bans
                    banEndDate = new Date(now.getFullYear() + 100, now.getMonth(), now.getDate());
                } else {
                    // Calculate end date based on duration days
                    banEndDate = new Date(now);
                    banEndDate.setDate(now.getDate() + parseInt(duration));
                }
                
                // Create ban object
                const ban = {
                    email: email,
                    duration: duration === 'permanent' ? 'permanent' : parseInt(duration),
                    reason: reason || 'No reason provided',
                    startDate: now.toISOString(),
                    endDate: banEndDate.toISOString(),
                    bannedBy: currentUser.name
                };
                
                // Add to banned users
                bannedUsers[email] = ban;
                saveBannedUsers();
                
                // Close modal and update UI
                hideModal(addBanModal);
                
                // If on the banned users page, update the list
                if (currentPage === 'analytics' && document.querySelector('.analytics-tab.active').getAttribute('data-tab') === 'banned') {
                    updateAnalyticsData('banned');
                }
                
                // Reset form
                addBanForm.reset();
                
                showAlert('success', 'User Banned', `User with email ${email} has been banned ${duration === 'permanent' ? 'permanently' : `for ${duration} days`}.`);
                
                // If this email matches the current user, show ban message
                if (currentUser && currentUser.email === email) {
                    showBanMessage(ban);
                }
                
                // Hide loading
                hideLoading();
            }, 800);
        }

        function handleEditToc(e) {
            e.preventDefault();
            
            if (!currentUser || currentUser.name !== 'Dusk') {
                showAlert('danger', 'Permission Denied', 'Only Dusk can edit the table of contents.');
                return;
            }
            
            const bookId = document.getElementById('toc-book-id').value;
            
            // Show loading
            showLoading();
            
            // Simulate API call
            setTimeout(() => {
                // Get all chapter data
                const chapters = [];
                const chapterElements = document.querySelectorAll('.toc-chapter');
                
                chapterElements.forEach((element, index) => {
                    const titleInput = element.querySelector('.chapter-title-input');
                    const title = titleInput.value.trim();
                    
                    if (title) {
                        chapters.push({
                            id: `chapter_${index + 1}`,
                            number: index + 1,
                            title: title
                        });
                    }
                });
                
                // Update book TOC
                const bookIndex = books.findIndex(book => book.id === bookId);
                if (bookIndex !== -1) {
                    books[bookIndex].toc = chapters;
                    saveBooks();
                }
                
                // Close modal and update TOC display
                hideModal(editTocModal);
                renderToc(bookId);
                
                showAlert('success', 'Table of Contents Updated', 'The table of contents has been updated successfully!');
                
                // Hide loading
                hideLoading();
            }, 800);
        }
        
        function setupEditProfileForm() {
            if (!currentUser) return;
            
            // Get user profile
            const profile = userProfiles[currentUser.id];
            if (!profile) return;
            
            // Set form values
            document.getElementById('edit-profile-name').value = profile.name || currentUser.name;
            document.getElementById('edit-profile-bio').value = profile.bio || '';
            document.getElementById('edit-profile-image-url').value = profile.profileImage || '';
            
            // Set profile image preview
            const previewImg = document.getElementById('edit-profile-image-preview');
            if (profile.profileImage) {
                previewImg.src = profile.profileImage;
            } else {
                previewImg.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzFhNzNlOCIvPjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iODAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIGZpbGw9IiNmZmZmZmYiPkE8L3RleHQ+PC9zdmc+';
            }
        }

        function renderBooks(booksToRender = books) {
            // Check if there are any books
            if (booksToRender.length === 0) {
                emptyBooks.style.display = 'block';
                booksContainer.innerHTML = '';
                return;
            }
            
            // Hide empty message and clear container
            emptyBooks.style.display = 'none';
            booksContainer.innerHTML = '';
            
            // Get current filter and sort settings
            const activeFilter = document.querySelector('.filter-btn.active').dataset.filter;
            const sortBy = sortSelect.value;
            
            // Filter books
            let filteredBooks = booksToRender;
            if (activeFilter !== 'all') {
                filteredBooks = booksToRender.filter(book => book.genre === activeFilter);
            }
            
            // Sort books
            const sortedBooks = sortBooks(filteredBooks, sortBy);
            
            // Render each book with a slight delay for animation
            sortedBooks.forEach((book, index) => {
                setTimeout(() => {
                    const bookCard = createBookCard(book);
                    bookCard.classList.add('fade-in');
                    booksContainer.appendChild(bookCard);
                }, index * 50); // Stagger the rendering
            });
        }

        function createBookCard(book) {
            const avgRating = calculateAverageRating(book.ratings);
            const ratingStars = createStarRating(avgRating);
            
            const bookCard = document.createElement('div');
            bookCard.className = 'book-card';
            bookCard.dataset.id = book.id;
            bookCard.dataset.genre = book.genre;
            
            // Find if book is part of a series
            let seriesInfo = null;
            for (const seriesName in series) {
                const bookInSeries = series[seriesName].find(entry => entry.bookId === book.id);
                if (bookInSeries) {
                    seriesInfo = {
                        name: seriesName,
                        order: bookInSeries.order
                    };
                    break;
                }
            }
            
            bookCard.innerHTML = `
                <div class="book-cover">
                    <img src="${book.cover}" alt="${book.title} Cover">
                    <div class="book-genre">${formatGenre(book.genre)}</div>
                </div>
                <div class="book-info">
                    <h3 class="book-title">${book.title}</h3>
                    <p class="book-author">by ${book.author}</p>
                    ${seriesInfo ? `<p class="book-series">${seriesInfo.name} #${seriesInfo.order}</p>` : ''}
                    <div class="book-rating">
                        <div class="rating-stars">${ratingStars}</div>
                        <span class="rating-count">(${book.ratings.length})</span>
                    </div>
                    <div class="book-votes">
                        <button class="vote-btn ${getUserBookVote(book.id) === 'upvote' ? 'upvoted' : ''}">
                            <i class="fas fa-thumbs-up"></i> <span>${book.upvotes || 0}</span>
                        </button>
                        <button class="vote-btn ${getUserBookVote(book.id) === 'downvote' ? 'downvoted' : ''}">
                            <i class="fas fa-thumbs-down"></i> <span>${book.downvotes || 0}</span>
                        </button>
                    </div>
                </div>
            `;
            
            // Add event listeners to vote buttons
            const upvoteBtn = bookCard.querySelector('.book-votes button:first-child');
            const downvoteBtn = bookCard.querySelector('.book-votes button:last-child');
            
            upvoteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                handleBookVote(book.id, 'upvote');
            });
            
            downvoteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                handleBookVote(book.id, 'downvote');
            });
            
            // Make the whole card clickable
            bookCard.addEventListener('click', () => {
                showBookDetails(book.id);
            });
            
            return bookCard;
        }

        function showBookDetails(bookId) {
            // Set current book
            currentBookId = bookId;
            
            // Show loading
            showLoading();
            
            // Simulate API call
            setTimeout(() => {
                // Find book
                const book = books.find(book => book.id === bookId);
                if (!book) {
                    hideLoading();
                    return;
                }
                
                // Find if book is part of a series
                let seriesInfo = null;
                for (const seriesName in series) {
                    const bookInSeries = series[seriesName].find(entry => entry.bookId === bookId);
                    if (bookInSeries) {
                        seriesInfo = {
                            name: seriesName,
                            order: bookInSeries.order,
                            books: series[seriesName]
                        };
                        break;
                    }
                }
                
                // Populate book details
                bookDetailCover.src = book.cover;
                bookDetailTitle.textContent = book.title;
                bookDetailAuthor.textContent = `by ${book.author}`;
                bookDetailGenre.textContent = formatGenre(book.genre);
                bookDetailDate.textContent = formatTimeAgo(book.createdAt);
                bookDetailViews.textContent = `${bookViews[bookId] ? bookViews[bookId].total : 0} views`;
                bookDetailDescription.textContent = book.description;
                
                // Display series info if available
                if (seriesInfo) {
                    bookDetailSeries.textContent = `${seriesInfo.name} #${seriesInfo.order}`;
                    bookDetailSeries.style.display = 'inline-block';
                } else {
                    bookDetailSeries.style.display = 'none';
                }
                
                // Calculate and display average rating
                updateBookRatingDisplay(book);
                
                // Update vote counts
                bookDetailUpvotes.textContent = book.upvotes || 0;
                bookDetailDownvotes.textContent = book.downvotes || 0;
                
                // Highlight user's vote if any
                bookUpvoteBtn.classList.toggle('upvoted', getUserBookVote(bookId) === 'upvote');
                bookDownvoteBtn.classList.toggle('downvoted', getUserBookVote(bookId) === 'downvote');
                
                // Set action buttons
                setupBookActions(book);
                
                // Render table of contents
                renderToc(bookId);
                
                // Render comments
                renderBookComments(bookId);
                
                // Pre-select user's rating if they've rated this book before
                preSelectUserRating(bookId);
                
                // Make author name clickable to go to author detail page
                bookDetailAuthor.style.cursor = 'pointer';
                bookDetailAuthor.addEventListener('click', () => {
                    const author = authors.find(a => a.name === book.author);
                    if (author) {
                        showAuthorDetails(author.id);
                    }
                });
                
                // Change to book detail page
                navigateToPage('book-detail');
                
                // Hide loading
                hideLoading();
            }, 800);
        }

        function showAuthorDetails(authorId) {
            // Set current author
            currentAuthorId = authorId;
            
            // Show loading
            showLoading();
            
            // Simulate API call
            setTimeout(() => {
                // Find author
                const author = authors.find(author => author.id === authorId);
                if (!author) {
                    hideLoading();
                    return;
                }
                
                // Populate author details
                authorDetailImage.src = author.image || 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzFhNzNlOCIvPjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iODAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIGZpbGw9IiNmZmZmZmYiPkE8L3RleHQ+PC9zdmc+';
                authorDetailName.textContent = author.name;
                authorDetailBio.textContent = author.bio || `${author.name} is a talented author known for their compelling storytelling and captivating characters.`;
                
                // Display author stats
                authorBooksCount.textContent = author.books.length;
                authorRating.textContent = author.avgRating.toFixed(1);
                authorVotes.textContent = (author.upvotes || 0) - (author.downvotes || 0);
                
                // Update vote counts
                authorUpvotes.textContent = author.upvotes || 0;
                authorDownvotes.textContent = author.downvotes || 0;
                
                // Show remaining votes count for current user
                if (currentUser && userAuthorVotes[currentUser.id]) {
                    authorVotesLeft.textContent = userAuthorVotes[currentUser.id].dailyVotesLeft || 0;
                } else {
                    authorVotesLeft.textContent = '3';
                }
                
                // Highlight user's vote if any
                authorUpvoteBtn.classList.toggle('upvoted', getUserAuthorVote(authorId) === 'upvote');
                authorDownvoteBtn.classList.toggle('downvoted', getUserAuthorVote(authorId) === 'downvote');
                
                // Render author's books
                const authorBooks = books.filter(book => book.author === author.name);
                renderAuthorBooks(authorBooks);
                
                // Show edit button if user is Dusk
                if (currentUser && currentUser.name === 'Dusk') {
                    editAuthorBtn.style.display = 'block';
                } else {
                    editAuthorBtn.style.display = 'none';
                }
                
                // Render author achievements
                renderAuthorAchievements(authorId);
                
                // Change to author detail page
                navigateToPage('author-detail');
                
                // Hide loading
                hideLoading();
            }, 800);
        }
        
        function renderAuthorAchievements(authorId) {
            // Check if achievements are enabled
            if (!authorAchievementsEnabled) {
                authorAchievements.style.display = 'none';
                return;
            }
            
            // Show achievements section
            authorAchievements.style.display = 'block';
            
            // Get author awards
            const awards = authorMonthlyAwards[authorId] || [];
            
            // Check if author has any awards
            if (awards.length === 0) {
                achievementsList.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--gray-600);">
                        <i class="fas fa-award fa-2x mb-2"></i>
                        <p>This author hasn't received any monthly awards yet.</p>
                    </div>
                `;
                return;
            }
            
            // Sort awards by date (newest first)
            awards.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Render awards
            achievementsList.innerHTML = '';
            
            awards.forEach(award => {
                const achievementItem = document.createElement('div');
                achievementItem.className = 'achievement-item';
                achievementItem.innerHTML = `
                    <div class="achievement-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="achievement-info">
                        <h4>Most Popular Author - ${award.month} ${award.year}</h4>
                        <p>Received ${award.votes} community votes</p>
                    </div>
                `;
                achievementsList.appendChild(achievementItem);
            });
        }
        
        function showUserProfile(userId) {
            // Show loading
            showLoading();
            
            // Check if user exists
            const profile = userProfiles[userId];
            if (!profile) {
                showAlert('danger', 'User Not Found', 'The requested user profile could not be found.');
                hideLoading();
                navigateToPage('home');
                return;
            }
            
            // Set user ID in the section for identifying who's profile is being viewed
            userProfileSection.dataset.userId = userId;
            
            // Simulate API call
            setTimeout(() => {
                // Populate user profile details
                userProfileName.textContent = profile.name;
                userProfileJoined.textContent = `Member since ${formatDate(profile.joinedDate)}`;
                userProfileBio.textContent = profile.bio || 'This user has not added a bio yet.';
                
                // Set profile image
                if (profile.profileImage) {
                    userProfileImage.src = profile.profileImage;
                } else {
                    // Default profile image with first letter of username
                    userProfileImage.src = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzFhNzNlOCIvPjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iODAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIGZpbGw9IiNmZmZmZmYiPiR7cHJvZmlsZS5uYW1lLmNoYXJBdCgwKX08L3RleHQ+PC9zdmc+`;
                }
                
                // Calculate user stats
                const likedBooks = Object.keys(userBookVotes[userId] || {}).filter(
                    bookId => userBookVotes[userId][bookId] === 'upvote'
                ).length;
                
                // Count user's reviews
                let reviewCount = 0;
                for (const bookId in bookComments) {
                    reviewCount += bookComments[bookId].filter(comment => 
                        comment.userId === userId && !comment.isDeleted
                    ).length;
                }
                
                // Count user's chapter comments
                for (const chapterId in chapterComments) {
                    reviewCount += chapterComments[chapterId].filter(comment => 
                        comment.userId === userId && !comment.isDeleted
                    ).length;
                }
                
                // Count user's votes (both book and author)
                const bookVotesCount = Object.keys(userBookVotes[userId] || {}).length;
                const authorVotesCount = Object.keys(userAuthorVotes[userId] || {})
                    .filter(key => key !== 'dailyVotesLeft' && key !== 'lastVoteDate').length;
                const totalVotes = bookVotesCount + authorVotesCount;
                
                // Update UI with stats
                userBooksLiked.textContent = likedBooks;
                userReviewsCount.textContent = reviewCount;
                userVotesCount.textContent = totalVotes;
                
                // Render user's rated books
                renderUserRatedBooks(userId);
                
                // Show edit button if this is the current user's profile
                if (currentUser && currentUser.id === userId) {
                    editProfileBtn.style.display = 'block';
                } else {
                    editProfileBtn.style.display = 'none';
                }
                
                // Show newsletter section if this is Dusk's profile and the current user is Dusk
                if (profile.name === 'Dusk' && currentUser && currentUser.name === 'Dusk') {
                    newsletterSection.style.display = 'block';
                    renderNewsletterSection();
                } else {
                    newsletterSection.style.display = 'none';
                }
                
                // Change to user profile page
                navigateToPage('user-profile');
                
                // Hide loading
                hideLoading();
            }, 800);
        }
        
        function renderUserRatedBooks(userId) {
            // Get user's ratings
            const ratings = userRatings[userId] || {};
            const ratedBookIds = Object.keys(ratings);
            
            // Check if user has rated any books
            if (ratedBookIds.length === 0) {
                emptyRatedBooks.style.display = 'block';
                userRatedBooks.innerHTML = '';
                return;
            }
            
            // Hide empty message
            emptyRatedBooks.style.display = 'none';
            userRatedBooks.innerHTML = '';
            
            // Render each rated book
            ratedBookIds.forEach(bookId => {
                const book = books.find(b => b.id === bookId);
                if (!book) return;
                
                const rating = ratings[bookId];
                const ratedBook = document.createElement('div');
                ratedBook.className = 'user-rated-book';
                ratedBook.innerHTML = `
                    <div class="user-rated-book-cover">
                        <img src="${book.cover}" alt="${book.title}">
                    </div>
                    <div class="user-rated-book-info">
                        <div class="user-rated-book-title">${book.title}</div>
                        <div class="user-rated-book-author">by ${book.author}</div>
                        <div class="user-rated-book-rating">Rated: ${createStarRating(rating)}</div>
                    </div>
                `;
                
                // Make the book clickable
                ratedBook.addEventListener('click', () => {
                    showBookDetails(book.id);
                });
                
                userRatedBooks.appendChild(ratedBook);
            });
        }

        function renderAuthorBooks(authorBooks) {
            authorBooksContainer.innerHTML = '';
            
            if (authorBooks.length === 0) {
                authorBooksContainer.innerHTML = `
                    <div class="empty-books text-center">
                        <i class="fas fa-book-open fa-3x mb-3" style="color: var(--gray-400);"></i>
                        <h3 class="mb-2">No Books Found</h3>
                        <p>This author doesn't have any books in our collection yet.</p>
                    </div>
                `;
                return;
            }
            
            // Sort books by newest first
            authorBooks.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            // Render each book
            authorBooks.forEach((book, index) => {
                setTimeout(() => {
                    const bookCard = createBookCard(book);
                    bookCard.classList.add('fade-in');
                    authorBooksContainer.appendChild(bookCard);
                }, index * 50);
            });
        }
        
        function updateAnalyticsData(tab) {
            if (!currentUser || currentUser.name !== 'Dusk') return;
            
            const timespan = timeFilter.value;
            
            // Show loading
            showLoading();
            
            // Simulate API call
            setTimeout(() => {
                switch (tab) {
                    case 'overview':
                        updateOverviewAnalytics(timespan);
                        break;
                    case 'books':
                        updateBooksAnalytics(timespan);
                        break;
                    case 'authors':
                        updateAuthorsAnalytics(timespan);
                        break;
                    case 'users':
                        updateUsersAnalytics(timespan);
                        break;
                    case 'banned':
                        updateBannedUsersAnalytics();
                        break;
                }
                
                // Hide loading
                hideLoading();
            }, 500);
        }
        
        function updateOverviewAnalytics(timespan) {
            // Get start date based on timespan
            const startDate = getStartDateFromTimespan(timespan);
            
            // Count views in time period
            let totalViews = 0;
            for (const bookId in bookViews) {
                const viewDates = bookViews[bookId].viewDates || [];
                
                // Filter views by date
                const filteredViews = viewDates.filter(dateStr => {
                    const date = new Date(dateStr);
                    return date >= startDate;
                });
                
                totalViews += filteredViews.length;
            }
            
            // Count likes in time period
            let totalLikes = 0;
            books.forEach(book => {
                totalLikes += book.upvotes || 0;
            });
            
            // Count comments in time period
            let totalComments = 0;
            
            // Book comments
            for (const bookId in bookComments) {
                const comments = bookComments[bookId];
                const filteredComments = comments.filter(comment => {
                    const date = new Date(comment.createdAt);
                    return date >= startDate;
                });
                
                totalComments += filteredComments.length;
            }
            
            // Chapter comments
            for (const chapterId in chapterComments) {
                const comments = chapterComments[chapterId];
                const filteredComments = comments.filter(comment => {
                    const date = new Date(comment.createdAt);
                    return date >= startDate;
                });
                
                totalComments += filteredComments.length;
            }
            
            // Count active users (users who viewed, commented, or rated in time period)
            const activeUsers = new Set();
            
            // Users who viewed books
            for (const bookId in bookViews) {
                if (bookViews[bookId].uniqueUsers) {
                    const userIds = Object.keys(bookViews[bookId].uniqueUsers);
                    userIds.forEach(id => activeUsers.add(id));
                }
            }
            
            // Users who commented
            for (const bookId in bookComments) {
                const recentComments = bookComments[bookId].filter(comment => {
                    const date = new Date(comment.createdAt);
                    return date >= startDate;
                });
                
                recentComments.forEach(comment => {
                    if (comment.userId) activeUsers.add(comment.userId);
                });
            }
                        // Users who commented on chapters
            for (const chapterId in chapterComments) {
                const recentComments = chapterComments[chapterId].filter(comment => {
                    const date = new Date(comment.createdAt);
                    return date >= startDate;
                });
                
                recentComments.forEach(comment => {
                    if (comment.userId) activeUsers.add(comment.userId);
                });
            }
            
            // Update metrics in UI
            document.getElementById('analytics-total-views').textContent = totalViews;
            document.getElementById('analytics-total-likes').textContent = totalLikes;
            document.getElementById('analytics-total-comments').textContent = totalComments;
            document.getElementById('analytics-active-users').textContent = activeUsers.size;
        }
        
        function updateBooksAnalytics(timespan) {
            // Get start date based on timespan
            const startDate = getStartDateFromTimespan(timespan);
            
            // Get all books and sort by views
            const booksWithMetrics = books.map(book => {
                const views = bookViews[book.id] ? bookViews[book.id].total : 0;
                const likes = book.upvotes || 0;
                
                // Get comments for this book
                let comments = 0;
                if (bookComments[book.id]) {
                    comments += bookComments[book.id].length;
                }
                
                // Add chapter comments
                for (const chapterId in chapterComments) {
                    if (chapterId.startsWith(`${book.id}_`)) {
                        comments += chapterComments[chapterId].length;
                    }
                }
                
                return {
                    id: book.id,
                    title: book.title,
                    author: book.author,
                    views,
                    likes,
                    comments
                };
            });
            
            // Sort by views (most viewed first)
            booksWithMetrics.sort((a, b) => b.views - a.views);
            
            // Populate table
            topBooksTable.innerHTML = '';
            
            if (booksWithMetrics.length === 0) {
                topBooksTable.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px;">
                            No books available
                        </td>
                    </tr>
                `;
                return;
            }
            
            booksWithMetrics.forEach(book => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${book.title}</td>
                    <td>${book.author}</td>
                    <td>${book.views}</td>
                    <td>${book.likes}</td>
                    <td>${book.comments}</td>
                    <td>
                        <button class="btn btn-sm view-book-analytics" data-id="${book.id}">
                            <i class="fas fa-chart-line"></i> Details
                        </button>
                    </td>
                `;
                
                // Add event listener to view details button
                row.querySelector('.view-book-analytics').addEventListener('click', () => {
                    showBookDetails(book.id);
                });
                
                topBooksTable.appendChild(row);
            });
        }
        
        function updateAuthorsAnalytics(timespan) {
            // Get all authors with metrics
            const authorsWithMetrics = authors.map(author => {
                // Calculate total votes
                const votes = (author.upvotes || 0) - (author.downvotes || 0);
                
                return {
                    id: author.id,
                    name: author.name,
                    books: author.books.length,
                    votes: votes,
                    avgRating: author.avgRating.toFixed(1)
                };
            });
            
            // Sort by votes (most votes first)
            authorsWithMetrics.sort((a, b) => b.votes - a.votes);
            
            // Populate table
            topAuthorsTable.innerHTML = '';
            
            if (authorsWithMetrics.length === 0) {
                topAuthorsTable.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 20px;">
                            No authors available
                        </td>
                    </tr>
                `;
                return;
            }
            
            authorsWithMetrics.forEach(author => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${author.name}</td>
                    <td>${author.books}</td>
                    <td>${author.votes}</td>
                    <td>${author.avgRating}</td>
                    <td>
                        <button class="btn btn-sm view-author-analytics" data-id="${author.id}">
                            <i class="fas fa-chart-line"></i> Details
                        </button>
                    </td>
                `;
                
                // Add event listener to view details button
                row.querySelector('.view-author-analytics').addEventListener('click', () => {
                    showAuthorDetails(author.id);
                });
                
                topAuthorsTable.appendChild(row);
            });
        }
        
        function updateUsersAnalytics(timespan) {
            // Get start date based on timespan
            const startDate = getStartDateFromTimespan(timespan);
            
            // Get all users with activity metrics
            const usersWithMetrics = Object.values(userProfiles).map(profile => {
                // Count user's reviews
                let reviewCount = 0;
                
                // Book comments
                for (const bookId in bookComments) {
                    reviewCount += bookComments[bookId].filter(comment => 
                        comment.userId === profile.id && 
                        new Date(comment.createdAt) >= startDate
                    ).length;
                }
                
                // Chapter comments
                for (const chapterId in chapterComments) {
                    reviewCount += chapterComments[chapterId].filter(comment => 
                        comment.userId === profile.id && 
                        new Date(comment.createdAt) >= startDate
                    ).length;
                }
                
                return {
                    id: profile.id,
                    name: profile.name,
                    email: profile.email,
                    joined: formatDate(profile.joinedDate),
                    activity: reviewCount
                };
            });
            
            // Sort by activity (most active first)
            usersWithMetrics.sort((a, b) => b.activity - a.activity);
            
            // Populate table
            activeUsersTable.innerHTML = '';
            
            if (usersWithMetrics.length === 0) {
                activeUsersTable.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 20px;">
                            No users available
                        </td>
                    </tr>
                `;
                return;
            }
            
            usersWithMetrics.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.joined}</td>
                    <td>${user.activity} actions</td>
                    <td>
                        <button class="btn btn-sm view-user-profile" data-id="${user.id}">
                            <i class="fas fa-user"></i> Profile
                        </button>
                        <button class="btn btn-sm btn-danger ban-user" data-email="${user.email}">
                            <i class="fas fa-ban"></i> Ban
                        </button>
                    </td>
                `;
                
                // Add event listener to view profile button
                row.querySelector('.view-user-profile').addEventListener('click', () => {
                    showUserProfile(user.id);
                });
                
                // Add event listener to ban button
                row.querySelector('.ban-user').addEventListener('click', () => {
                    // Prefill email in ban form
                    document.getElementById('ban-email').value = user.email;
                    showModal(addBanModal);
                });
                
                activeUsersTable.appendChild(row);
            });
        }
        
        function updateBannedUsersAnalytics() {
            // Get all banned users
            const bannedUsersList = document.getElementById('banned-users-list');
            bannedUsersList.innerHTML = '';
            
            const bannedEmails = Object.keys(bannedUsers);
            
            if (bannedEmails.length === 0) {
                document.getElementById('empty-bans').style.display = 'block';
                return;
            }
            
            document.getElementById('empty-bans').style.display = 'none';
            
            // Sort by ban start date (newest first)
            bannedEmails.sort((a, b) => {
                return new Date(bannedUsers[b].startDate) - new Date(bannedUsers[a].startDate);
            });
            
            bannedEmails.forEach(email => {
                const ban = bannedUsers[email];
                const now = new Date();
                const banEndDate = new Date(ban.endDate);
                const isActive = now < banEndDate;
                
                // Format remaining time
                let remainingTime;
                if (!isActive) {
                    remainingTime = 'Expired';
                } else if (ban.duration === 'permanent') {
                    remainingTime = 'Permanent';
                } else {
                    const diffTime = Math.abs(banEndDate - now);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    remainingTime = `${diffDays} day${diffDays !== 1 ? 's' : ''} remaining`;
                }
                
                const bannedUser = document.createElement('div');
                bannedUser.className = 'banned-user-item';
                bannedUser.innerHTML = `
                    <div class="banned-user-info">
                        <div class="banned-user-email">${email}</div>
                        <div class="banned-user-date">
                            ${isActive ? 'Banned' : 'Was banned'} ${formatTimeAgo(ban.startDate)} 
                            by ${ban.bannedBy} · ${remainingTime}
                        </div>
                        <div class="banned-user-reason mt-1">
                            <strong>Reason:</strong> ${ban.reason}
                        </div>
                    </div>
                    <div class="banned-user-actions">
                        <button class="btn btn-sm ${isActive ? 'btn-warning' : 'btn-secondary'} edit-ban-btn" 
                                data-email="${email}">
                            <i class="fas fa-edit"></i> ${isActive ? 'Modify' : 'Reban'}
                        </button>
                        <button class="btn btn-sm btn-danger remove-ban-btn" 
                                data-email="${email}" ${!isActive ? 'disabled' : ''}>
                            <i class="fas fa-times"></i> Remove
                        </button>
                    </div>
                `;
                
                // Add event listeners
                bannedUser.querySelector('.edit-ban-btn').addEventListener('click', () => {
                    // Prefill email in ban form
                    document.getElementById('ban-email').value = email;
                    showModal(addBanModal);
                });
                
                bannedUser.querySelector('.remove-ban-btn').addEventListener('click', () => {
                    removeBan(email);
                });
                
                bannedUsersList.appendChild(bannedUser);
            });
        }
        
        function removeBan(email) {
            if (!currentUser || currentUser.name !== 'Dusk') {
                showAlert('danger', 'Permission Denied', 'Only Dusk can remove bans.');
                return;
            }
            
            if (confirm(`Are you sure you want to remove the ban for ${email}?`)) {
                delete bannedUsers[email];
                saveBannedUsers();
                updateBannedUsersAnalytics();
                showAlert('success', 'Ban Removed', `The ban for ${email} has been removed.`);
            }
        }
        
        function getStartDateFromTimespan(timespan) {
            const now = new Date();
            
            switch (timespan) {
                case '1h':
                    return new Date(now.setHours(now.getHours() - 1));
                case '2h':
                    return new Date(now.setHours(now.getHours() - 2));
                case '4h':
                    return new Date(now.setHours(now.getHours() - 4));
                case '8h':
                    return new Date(now.setHours(now.getHours() - 8));
                case '16h':
                    return new Date(now.setHours(now.getHours() - 16));
                case '1d':
                    return new Date(now.setDate(now.getDate() - 1));
                case '7d':
                    return new Date(now.setDate(now.getDate() - 7));
                case '30d':
                    return new Date(now.setDate(now.getDate() - 30));
                case '1y':
                    return new Date(now.setFullYear(now.getFullYear() - 1));
                case 'all':
                    return new Date(0); // Beginning of time
                default:
                    return new Date(now.setDate(now.getDate() - 1)); // Default to 1 day
            }
        }

        function setupBookActions(book) {
            bookDetailActions.innerHTML = '';
            
            // Add edit button if user is Dusk
            if (currentUser && currentUser.name === 'Dusk') {
                const editButton = document.createElement('button');
                editButton.className = 'btn';
                editButton.innerHTML = '<i class="fas fa-edit"></i> Edit Book';
                editButton.addEventListener('click', () => {
                    setupEditBookForm(book);
                    showModal(editBookModal);
                });
                bookDetailActions.appendChild(editButton);
            }
            
            // Add bookmark/reading list button for all users
            const readButton = document.createElement('button');
            readButton.className = 'btn btn-secondary';
            readButton.innerHTML = '<i class="fas fa-bookmark"></i> Add to Reading List';
            readButton.addEventListener('click', () => {
                if (!currentUser) {
                    showModal(loginModal);
                    return;
                }
                showAlert('success', 'Added to Reading List', 'This book has been added to your reading list!');
            });
            bookDetailActions.appendChild(readButton);
            
            // Add share button
            const shareButton = document.createElement('button');
            shareButton.className = 'btn';
            shareButton.style.backgroundColor = '#4267B2';
            shareButton.innerHTML = '<i class="fas fa-share-alt"></i> Share';
            shareButton.addEventListener('click', () => {
                showShareOptions(book);
            });
            bookDetailActions.appendChild(shareButton);
        }

        function showShareOptions(book) {
            // Create a URL for the book
            const bookUrl = `${baseUrl}#book-detail?id=${book.id}`;
            
            // Create a container for the share options
            const shareContainer = document.createElement('div');
            shareContainer.className = 'mt-3';
            shareContainer.innerHTML = `
                <div class="copy-link-container">
                    <input type="text" class="copy-link-input" value="${bookUrl}" readonly>
                    <button class="copy-link-btn">Copy</button>
                </div>
            `;
            
            // Add the container after the actions
            const existingContainer = document.querySelector('.copy-link-container');
            if (existingContainer) {
                existingContainer.remove();
            }
            
            bookDetailActions.parentNode.insertBefore(shareContainer, bookDetailActions.nextSibling);
            
            // Add event listener to copy button
            const copyBtn = shareContainer.querySelector('.copy-link-btn');
            copyBtn.addEventListener('click', () => {
                const input = shareContainer.querySelector('.copy-link-input');
                input.select();
                document.execCommand('copy');
                
                copyBtn.textContent = 'Copied!';
                setTimeout(() => {
                    copyBtn.textContent = 'Copy';
                }, 2000);
                
                showAlert('success', 'Link Copied', 'Book link has been copied to clipboard!');
            });
        }

        function setupEditBookForm(book) {
            document.getElementById('edit-book-id').value = book.id;
            document.getElementById('edit-book-title').value = book.title;
            document.getElementById('edit-book-author').value = book.author;
            document.getElementById('edit-book-genre').value = book.genre;
            document.getElementById('edit-book-description').value = book.description;
            document.getElementById('edit-book-cover-url').value = book.cover;
            
            // Set cover preview
            editCoverPreview.src = book.cover;
            editCoverPreview.style.display = 'block';
            
            // Check if book is part of a series
            let seriesInfo = null;
            for (const seriesName in series) {
                const bookInSeries = series[seriesName].find(entry => entry.bookId === book.id);
                if (bookInSeries) {
                    seriesInfo = {
                        name: seriesName,
                        order: bookInSeries.order
                    };
                    break;
                }
            }
            
            // Set series info if available
            if (seriesInfo) {
                document.getElementById('edit-book-series').value = seriesInfo.name;
                document.getElementById('edit-book-series-number').value = seriesInfo.order;
                editSeriesContent.classList.add('active');
                toggleEditSeriesBtn.innerHTML = '<i class="fas fa-minus"></i> Remove from series';
            } else {
                document.getElementById('edit-book-series').value = '';
                document.getElementById('edit-book-series-number').value = '';
                editSeriesContent.classList.remove('active');
                toggleEditSeriesBtn.innerHTML = '<i class="fas fa-plus"></i> Add to a series';
            }
        }

        function setupEditAuthorForm(authorId) {
            const author = authors.find(a => a.id === authorId);
            if (!author) return;
            
            document.getElementById('edit-author-id').value = authorId;
            document.getElementById('edit-author-name').value = author.name;
            document.getElementById('edit-author-bio').value = author.bio || '';
            document.getElementById('edit-author-image-url').value = author.image || '';
            document.getElementById('edit-author-image-preview').src = author.image || 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzFhNzNlOCIvPjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iODAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIGZpbGw9IiNmZmZmZmYiPkE8L3RleHQ+PC9zdmc+';
            
            // Set achievements toggle
            document.getElementById('achievements-enabled').checked = authorAchievementsEnabled;
        }

        function renderToc(bookId) {
            const book = books.find(book => book.id === bookId);
            if (!book) return;
            
            // Show or hide TOC actions based on user
            tocActions.style.display = currentUser && currentUser.name === 'Dusk' ? 'block' : 'none';
            
            // Check if book has TOC
            if (!book.toc || book.toc.length === 0) {
                emptyToc.style.display = 'block';
                tocList.style.display = 'none';
                return;
            }
            
            // Build TOC
            emptyToc.style.display = 'none';
            tocList.style.display = 'block';
            tocList.innerHTML = '';
            
            book.toc.forEach((chapter, index) => {
                const chapterId = chapter.id || `chapter_${chapter.number}`;
                const fullChapterId = `${bookId}_${chapterId}`;
                
                // Count comments for this chapter
                const commentCount = chapterComments[fullChapterId] ? chapterComments[fullChapterId].length : 0;
                
                const chapterElement = document.createElement('li');
                chapterElement.className = 'toc-item';
                chapterElement.dataset.chapter = chapterId;
                
                chapterElement.innerHTML = `
                    <div class="toc-item-header">
                        <span class="toc-item-title">${chapter.title || `Chapter ${chapter.number}`}</span>
                        <div class="toc-item-info">
                            <span class="toc-item-number">Chapter ${chapter.number}</span>
                            <span class="toc-item-comments"><i class="fas fa-comments"></i> ${commentCount}</span>
                            <i class="fas fa-chevron-down toc-item-toggle"></i>
                        </div>
                    </div>
                    <div class="toc-item-content">
                        <p>${chapter.title ? `This is chapter ${chapter.number}: ${chapter.title}` : `Chapter ${chapter.number}`}</p>
                        
                        <div class="chapter-comments-container">
                            <h4 class="mb-2">Chapter Comments (${commentCount})</h4>
                            <button class="btn btn-sm" data-chapter="${chapterId}">
                                <i class="fas fa-comments"></i> View Comments
                            </button>
                        </div>
                    </div>
                `;
                
                // Toggle chapter content visibility
                chapterElement.querySelector('.toc-item-header').addEventListener('click', () => {
                    const wasActive = chapterElement.classList.contains('active');
                    
                    // Close all other active items
                    document.querySelectorAll('.toc-item.active').forEach(item => {
                        if (item !== chapterElement) {
                            item.classList.remove('active');
                        }
                    });
                    
                    // Toggle this item
                    chapterElement.classList.toggle('active', !wasActive);
                });
                
                // Add view chapter comments button functionality
                chapterElement.querySelector('.btn[data-chapter]').addEventListener('click', () => {
                    showChapterComments(chapterId, bookId, chapter.title || `Chapter ${chapter.number}`);
                });
                
                tocList.appendChild(chapterElement);
                
                // Add slight delay for animation effect
                setTimeout(() => {
                    chapterElement.style.opacity = '1';
                }, index * 100);
            });
        }

        function showChapterComments(chapterId, bookId, chapterTitle) {
            currentChapterId = chapterId;
            
            // Set chapter info in modal
            chapterCommentsTitle.textContent = `Comments for ${chapterTitle}`;
            commentChapterId.value = chapterId;
            commentBookId.value = bookId;
            
            // Render chapter comments
            renderChapterComments(chapterId, bookId);
            
            // Show modal
            showModal(chapterCommentModal);
        }

        function renderChapterComments(chapterId, bookId) {
            const fullChapterId = `${bookId}_${chapterId}`;
            const comments = chapterComments[fullChapterId] || [];
            
            if (comments.length === 0) {
                emptyChapterComments.style.display = 'block';
                chapterCommentsList.innerHTML = '';
                return;
            }
            
            emptyChapterComments.style.display = 'none';
            chapterCommentsList.innerHTML = '';
            
            comments.forEach((comment, index) => {
                const commentElement = document.createElement('div');
                
                if (comment.isDeleted) {
                    // Check if the comment was deleted more than a week ago
                    const deletedDate = deletedChapterComments[comment.id] ? new Date(deletedChapterComments[comment.id]) : null;
                    const oneWeekAgo = new Date();
                    oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                    
                    // If deleted more than a week ago and user is Dusk, don't show
                    if (deletedDate && deletedDate < oneWeekAgo && currentUser && currentUser.name === 'Dusk') {
                        return;
                    }
                    
                    commentElement.className = 'chapter-comment-deleted';
                    commentElement.innerHTML = '<i class="fas fa-trash-alt"></i> This comment has been deleted.';
                } else {
                    // Get commenter profile for avatar
                    const commenterProfile = userProfiles[comment.userId] || {
                        name: comment.username,
                        profileImage: null
                    };
                    
                    commentElement.className = 'chapter-comment';
                    commentElement.dataset.id = comment.id;
                    
                    commentElement.innerHTML = `
                        <div class="chapter-comment-header">
                            <div class="chapter-comment-user">
                                <div class="chapter-comment-avatar">
                                    ${commenterProfile.profileImage ? 
                                      `<img src="${commenterProfile.profileImage}" alt="${commenterProfile.name}">` : 
                                      `<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzFhNzNlOCIvPjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iODAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIGZpbGw9IiNmZmZmZmYiPiR7Y29tbWVudGVyUHJvZmlsZS5uYW1lLmNoYXJBdCgwKX08L3RleHQ+PC9zdmc+">`}
                                </div>
                                <span class="chapter-comment-name">${comment.username}</span>
                            </div>
                            <div class="chapter-comment-date">${formatTimeAgo(comment.createdAt)}</div>
                        </div>
                        <div class="chapter-comment-content">${comment.text}</div>
                    `;
                    
                    // Add delete button if user is Dusk
                    if (currentUser && currentUser.name === 'Dusk') {
                        const deleteBtn = document.createElement('button');
                        deleteBtn.className = 'btn btn-sm btn-danger mt-2';
                        deleteBtn.innerHTML = '<i class="fas fa-trash"></i> Delete';
                        deleteBtn.addEventListener('click', () => {
                            deleteChapterComment(comment.id, fullChapterId);
                        });
                        commentElement.appendChild(deleteBtn);
                    }
                    
                    // Make commenter name clickable to view profile
                    commentElement.querySelector('.chapter-comment-name').addEventListener('click', () => {
                        if (comment.userId) {
                            showUserProfile(comment.userId);
                        }
                    });
                    
                    // Make avatar clickable to view profile
                    commentElement.querySelector('.chapter-comment-avatar').addEventListener('click', () => {
                        if (comment.userId) {
                            showUserProfile(comment.userId);
                        }
                    });
                }
                
                chapterCommentsList.appendChild(commentElement);
            });
        }

        function deleteChapterComment(commentId, fullChapterId) {
            if (!currentUser || currentUser.name !== 'Dusk') {
                showAlert('danger', 'Permission Denied', 'Only Dusk can delete comments.');
                return;
            }
            
            if (confirm('Are you sure you want to delete this comment?')) {
                // Find the comment
                const commentIndex = chapterComments[fullChapterId].findIndex(
                    comment => comment.id === commentId
                );
                
                if (commentIndex !== -1) {
                    // Mark as deleted instead of removing
                    chapterComments[fullChapterId][commentIndex].isDeleted = true;
                    
                    // Store deletion time
                    deletedChapterComments[commentId] = new Date().toISOString();
                    saveDeletedComments();
                    
                    saveChapterComments();
                    
                    // Re-render comments
                    const [bookId, chapterId] = fullChapterId.split('_');
                    renderChapterComments(chapterId, bookId);
                    
                    // Update TOC to reflect new comment count
                    renderToc(bookId);
                    
                    showAlert('success', 'Comment Deleted', 'The comment has been deleted successfully.');
                }
            }
        }

        function populateTocEditor() {
            const book = books.find(book => book.id === currentBookId);
            if (!book) return;
            
            // Clear existing chapters
            tocChapters.innerHTML = '';
            
            // Add existing chapters or at least one empty chapter
            if (book.toc && book.toc.length > 0) {
                book.toc.forEach(chapter => addChapterToEditor(chapter.title || ''));
            } else {
                addChapter();
            }
        }

        function addChapter() {
            addChapterToEditor('');
        }

        function addChapterToEditor(title = '') {
            const chapterCount = document.querySelectorAll('.toc-chapter').length + 1;
            
            const chapterElement = document.createElement('div');
            chapterElement.className = 'toc-chapter';
            chapterElement.style.opacity = '0';
            chapterElement.style.transform = 'translateY(20px)';
            
            chapterElement.innerHTML = `
                <div class="toc-chapter-header">
                    <div class="toc-chapter-title">Chapter ${chapterCount}</div>
                    <div class="toc-chapter-actions">
                        <button type="button" class="remove-chapter-btn">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                                <div class="toc-form-group">
                    <label>Chapter Title (optional)</label>
                    <input type="text" class="chapter-title-input form-control" value="${title}" placeholder="Enter chapter title (leave blank for numbered chapters only)">
                </div>
            `;
            
            // Add remove button functionality
            chapterElement.querySelector('.remove-chapter-btn').addEventListener('click', function() {
                chapterElement.style.opacity = '0';
                chapterElement.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    chapterElement.remove();
                    renumberChapters();
                }, 300);
            });
            
            tocChapters.appendChild(chapterElement);
            
            // Animate in
            setTimeout(() => {
                chapterElement.style.opacity = '1';
                chapterElement.style.transform = 'translateY(0)';
                chapterElement.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            }, 10);
        }

        function renumberChapters() {
            const chapters = document.querySelectorAll('.toc-chapter');
            chapters.forEach((chapter, index) => {
                chapter.querySelector('.toc-chapter-title').textContent = `Chapter ${index + 1}`;
            });
        }

        function renderBookComments(bookId) {
            const comments = bookComments[bookId] || [];
            
            if (comments.length === 0) {
                emptyComments.style.display = 'block';
                bookCommentsList.innerHTML = '';
                return;
            }
            
            emptyComments.style.display = 'none';
            bookCommentsList.innerHTML = '';
            
            comments.forEach((comment, index) => {
                const commentElement = document.createElement('div');
                
                if (comment.isDeleted) {
                    // Check if the comment was deleted more than a week ago
                    const deletedDate = deletedComments[comment.id] ? new Date(deletedComments[comment.id]) : null;
                    const oneWeekAgo = new Date();
                    oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                    
                    // If deleted more than a week ago and user is Dusk, don't show
                    if (deletedDate && deletedDate < oneWeekAgo && currentUser && currentUser.name === 'Dusk') {
                        return;
                    }
                    
                    commentElement.className = 'comment';
                    commentElement.dataset.id = comment.id;
                    commentElement.style.opacity = '0';
                    commentElement.style.transform = 'translateY(20px)';
                    
                    const deletedContent = document.createElement('div');
                    deletedContent.className = 'comment-deleted';
                    deletedContent.innerHTML = '<i class="fas fa-trash-alt"></i> This comment has been deleted.';
                    
                    commentElement.appendChild(deletedContent);
                } else {
                    // Get commenter profile for avatar
                    const commenterProfile = userProfiles[comment.userId] || {
                        name: comment.username,
                        profileImage: null
                    };
                    
                    commentElement.className = 'comment';
                    commentElement.dataset.id = comment.id;
                    commentElement.style.opacity = '0';
                    commentElement.style.transform = 'translateY(20px)';
                    
                    commentElement.innerHTML = `
                        <div class="comment-header">
                            <div class="comment-user">
                                <div class="comment-avatar">
                                    ${commenterProfile.profileImage ? 
                                      `<img src="${commenterProfile.profileImage}" alt="${commenterProfile.name}">` : 
                                      commenterProfile.name.charAt(0)}
                                </div>
                                <div class="comment-info">
                                    <div class="comment-username">${comment.username}</div>
                                    <div class="comment-date">${formatTimeAgo(comment.createdAt)}</div>
                                </div>
                            </div>
                            <div class="comment-rating">
                                <div class="comment-stars">${createStarRating(comment.rating)}</div>
                            </div>
                        </div>
                        <div class="comment-content">${comment.text}</div>
                    `;
                    
                    // Add comment actions if current user is Dusk
                    if (currentUser && currentUser.name === 'Dusk') {
                        const actionsDiv = document.createElement('div');
                        actionsDiv.className = 'comment-actions';
                        actionsDiv.innerHTML = `
                            <button class="delete-comment-btn"><i class="fas fa-trash"></i> Delete</button>
                        `;
                        
                        actionsDiv.querySelector('.delete-comment-btn').addEventListener('click', () => {
                            deleteBookComment(comment.id, bookId);
                        });
                        
                        commentElement.appendChild(actionsDiv);
                    }
                }
                
                bookCommentsList.appendChild(commentElement);
                
                // Make the comment user section clickable to view profile
                const userElement = commentElement.querySelector('.comment-user');
                if (userElement && comment.userId) {
                    userElement.style.cursor = 'pointer';
                    userElement.addEventListener('click', () => {
                        showUserProfile(comment.userId);
                    });
                }
                
                // Animate in with delay based on index
                setTimeout(() => {
                    commentElement.style.opacity = '1';
                    commentElement.style.transform = 'translateY(0)';
                    commentElement.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                }, index * 100);
            });
        }

        function deleteBookComment(commentId, bookId) {
            if (!currentUser || currentUser.name !== 'Dusk') {
                showAlert('danger', 'Permission Denied', 'Only Dusk can delete comments.');
                return;
            }
            
            if (confirm('Are you sure you want to delete this comment?')) {
                // Find comment index
                const commentIndex = bookComments[bookId].findIndex(c => c.id === commentId);
                if (commentIndex === -1) return;
                
                // Mark as deleted instead of removing
                bookComments[bookId][commentIndex].isDeleted = true;
                
                // Store deletion time
                deletedComments[commentId] = new Date().toISOString();
                saveDeletedComments();
                
                // Save changes
                saveComments();
                
                // Re-render comments
                renderBookComments(bookId);
                
                showAlert('success', 'Comment Deleted', 'The comment has been deleted successfully.');
                
                // Update stats
                updateStats();
            }
        }

        function preSelectUserRating(bookId) {
            // Reset all stars
            document.querySelectorAll('input[name="rating"]').forEach(input => {
                input.checked = false;
            });
            
            // Exit if user is not logged in
            if (!currentUser) return;
            
            // Check if user has rated this book
            const userRatingData = userRatings[currentUser.id];
            if (userRatingData && userRatingData[bookId]) {
                const rating = userRatingData[bookId];
                const ratingInput = document.getElementById(`star${rating}`);
                if (ratingInput) {
                    ratingInput.checked = true;
                }
            }
        }

        function updateBookRatingDisplay(book) {
            if (!book) return;
            
            const avgRating = calculateAverageRating(book.ratings);
            bookDetailStars.innerHTML = createStarRating(avgRating);
            bookDetailRating.textContent = avgRating.toFixed(1);
            bookDetailRatingCount.textContent = `(${book.ratings.length} ratings)`;
            
            // Also update in the grid if visible
            const bookCard = document.querySelector(`.book-card[data-id="${book.id}"]`);
            if (bookCard) {
                const ratingStars = bookCard.querySelector('.rating-stars');
                const ratingCount = bookCard.querySelector('.rating-count');
                
                if (ratingStars) ratingStars.innerHTML = createStarRating(avgRating);
                if (ratingCount) ratingCount.textContent = `(${book.ratings.length})`;
            }
        }

        function handleBookVote(bookId, voteType) {
            if (!currentUser) {
                showModal(loginModal);
                return;
            }
            
            const book = books.find(book => book.id === bookId);
            if (!book) return;
            
            // Get current user's vote for this book
            const currentVote = getUserBookVote(bookId);
            
            // Initialize user votes if needed
            if (!userBookVotes[currentUser.id]) {
                userBookVotes[currentUser.id] = {};
            }
            
            // Initialize book vote counts if needed
            if (!book.upvotes) book.upvotes = 0;
            if (!book.downvotes) book.downvotes = 0;
            
            // Handle voting logic
            if (currentVote === voteType) {
                // User is removing their vote
                delete userBookVotes[currentUser.id][bookId];
                
                // Decrease vote count
                if (voteType === 'upvote') {
                    book.upvotes = Math.max(0, book.upvotes - 1);
                } else {
                    book.downvotes = Math.max(0, book.downvotes - 1);
                }
            } else {
                // User is changing vote or voting for the first time
                if (currentVote === 'upvote' && voteType === 'downvote') {
                    // Changing from upvote to downvote
                    book.upvotes = Math.max(0, book.upvotes - 1);
                    book.downvotes++;
                } else if (currentVote === 'downvote' && voteType === 'upvote') {
                    // Changing from downvote to upvote
                    book.downvotes = Math.max(0, book.downvotes - 1);
                    book.upvotes++;
                } else {
                    // New vote
                    if (voteType === 'upvote') {
                        book.upvotes++;
                    } else {
                        book.downvotes++;
                    }
                }
                
                // Set user's vote
                userBookVotes[currentUser.id][bookId] = voteType;
            }
            
            // Update UI
            if (currentPage === 'book-detail' && currentBookId === bookId) {
                bookDetailUpvotes.textContent = book.upvotes;
                bookDetailDownvotes.textContent = book.downvotes;
                
                // Update button styles
                bookUpvoteBtn.classList.toggle('upvoted', getUserBookVote(bookId) === 'upvote');
                bookDownvoteBtn.classList.toggle('downvoted', getUserBookVote(bookId) === 'downvote');
            }
            
            // Also update in the grid if visible
            const bookCard = document.querySelector(`.book-card[data-id="${bookId}"]`);
            if (bookCard) {
                const upvoteBtn = bookCard.querySelector('.book-votes button:first-child');
                const downvoteBtn = bookCard.querySelector('.book-votes button:last-child');
                const upvoteCount = upvoteBtn.querySelector('span');
                const downvoteCount = downvoteBtn.querySelector('span');
                
                upvoteCount.textContent = book.upvotes;
                downvoteCount.textContent = book.downvotes;
                upvoteBtn.classList.toggle('upvoted', getUserBookVote(bookId) === 'upvote');
                downvoteBtn.classList.toggle('downvoted', getUserBookVote(bookId) === 'downvote');
            }
            
            // Save changes
            saveBooks();
            saveUserVotes();
        }

        function handleAuthorVote(authorId, voteType) {
            if (!currentUser) {
                showModal(loginModal);
                return;
            }
            
            const author = authors.find(author => author.id === authorId);
            if (!author) return;
            
            // Check if user has votes left
            if (!userAuthorVotes[currentUser.id]) {
                userAuthorVotes[currentUser.id] = {
                    dailyVotesLeft: authorVotesPerDay,
                    lastVoteDate: new Date().toISOString()
                };
            }
            
            // Get current user's vote for this author
            const currentVote = getUserAuthorVote(authorId);
            
            // Check if the user has votes left (unless they're removing a vote)
            if (!currentVote && userAuthorVotes[currentUser.id].dailyVotesLeft <= 0) {
                showAlert('warning', 'No Votes Left', `You've used all your ${authorVotesPerDay} author votes for today. Votes reset at the start of each month.`);
                return;
            }
            
            // Initialize author vote counts if needed
            if (!author.upvotes) author.upvotes = 0;
            if (!author.downvotes) author.downvotes = 0;
            
            // Handle voting logic
            if (currentVote === voteType) {
                // User is removing their vote
                delete userAuthorVotes[currentUser.id][authorId];
                
                // Increase votes left count
                userAuthorVotes[currentUser.id].dailyVotesLeft = Math.min(
                    authorVotesPerDay, 
                    userAuthorVotes[currentUser.id].dailyVotesLeft + 1
                );
                
                // Decrease vote count
                if (voteType === 'upvote') {
                    author.upvotes = Math.max(0, author.upvotes - 1);
                } else {
                    author.downvotes = Math.max(0, author.downvotes - 1);
                }
            } else {
                // User is changing vote or voting for the first time
                if (currentVote === 'upvote' && voteType === 'downvote') {
                    // Changing from upvote to downvote
                    author.upvotes = Math.max(0, author.upvotes - 1);
                    author.downvotes++;
                } else if (currentVote === 'downvote' && voteType === 'upvote') {
                    // Changing from downvote to upvote
                    author.downvotes = Math.max(0, author.downvotes - 1);
                    author.upvotes++;
                } else {
                    // New vote - reduce votes left
                    userAuthorVotes[currentUser.id].dailyVotesLeft--;
                    
                    if (voteType === 'upvote') {
                        author.upvotes++;
                    } else {
                        author.downvotes++;
                    }
                }
                
                // Set user's vote
                userAuthorVotes[currentUser.id][authorId] = voteType;
            }
            
            // Update UI
            if (currentPage === 'author-detail' && currentAuthorId === authorId) {
                authorUpvotes.textContent = author.upvotes;
                authorDownvotes.textContent = author.downvotes;
                authorVotes.textContent = author.upvotes - author.downvotes;
                authorVotesLeft.textContent = userAuthorVotes[currentUser.id].dailyVotesLeft;
                
                // Update button styles
                authorUpvoteBtn.classList.toggle('upvoted', getUserAuthorVote(authorId) === 'upvote');
                authorDownvoteBtn.classList.toggle('downvoted', getUserAuthorVote(authorId) === 'downvote');
            }
            
            // Save changes
            saveUserVotes();
        }

        function getUserBookVote(bookId) {
            if (!currentUser || !userBookVotes[currentUser.id]) return null;
            return userBookVotes[currentUser.id][bookId];
        }

        function getUserAuthorVote(authorId) {
            if (!currentUser || !userAuthorVotes[currentUser.id]) return null;
            return userAuthorVotes[currentUser.id][authorId];
        }

        function filterBooks(filter) {
            // Get all book cards
            const bookCards = document.querySelectorAll('.book-card');
            
            // If no books, exit
            if (bookCards.length === 0) return;
            
            // Show animation for filtering
            showLoading();
            
            setTimeout(() => {
                if (filter === 'all') {
                    renderBooks();
                } else {
                    const filteredBooks = books.filter(book => book.genre === filter);
                    renderBooks(filteredBooks);
                }
                hideLoading();
            }, 400);
        }

        function sortBooks(booksArray = books, sortBy = sortSelect.value) {
            let sortedBooks = [...booksArray];
            
            switch (sortBy) {
                case 'newest':
                    sortedBooks.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    break;
                case 'rating':
                    sortedBooks.sort((a, b) => {
                        const ratingA = calculateAverageRating(a.ratings);
                        const ratingB = calculateAverageRating(b.ratings);
                        return ratingB - ratingA;
                    });
                    break;
                case 'upvotes':
                    sortedBooks.sort((a, b) => {
                        const votesA = (a.upvotes || 0) - (a.downvotes || 0);
                        const votesB = (b.upvotes || 0) - (b.downvotes || 0);
                        return votesB - votesA;
                    });
                    break;
                case 'title':
                    sortedBooks.sort((a, b) => a.title.localeCompare(b.title));
                    break;
                case 'author':
                    sortedBooks.sort((a, b) => a.author.localeCompare(b.author));
                    break;
            }
            
            return sortedBooks;
        }

        function calculateAverageRating(ratings) {
            if (!ratings || ratings.length === 0) return 0;
            
            const sum = ratings.reduce((total, rating) => total + rating.rating, 0);
            return sum / ratings.length;
        }

        function createStarRating(rating) {
            rating = Math.round(rating * 2) / 2; // Round to nearest 0.5
            
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += '<i class="fas fa-star"></i>';
                } else if (i - 0.5 === rating) {
                    stars += '<i class="fas fa-star-half-alt"></i>';
                } else {
                    stars += '<i class="far fa-star"></i>';
                }
            }
            
            return stars;
        }

        function searchBooks(term) {
            showLoading();
            
            setTimeout(() => {
                const searchResults = books.filter(book => {
                    return (
                        book.title.toLowerCase().includes(term) ||
                        book.author.toLowerCase().includes(term) ||
                        book.genre.toLowerCase().includes(term) ||
                        book.description.toLowerCase().includes(term)
                    );
                });
                
                renderBooks(searchResults);
                
                if (searchResults.length === 0) {
                    booksContainer.innerHTML = `
                        <div class="empty-books text-center">
                            <i class="fas fa-search fa-3x mb-3" style="color: var(--gray-400);"></i>
                            <h3 class="mb-2">No Results Found</h3>
                            <p class="mb-3">We couldn't find any books matching "${term}"</p>
                            <button class="btn" id="clear-search-btn">Clear Search</button>
                        </div>
                    `;
                    
                    document.getElementById('clear-search-btn').addEventListener('click', () => {
                        document.getElementById('hero-search').value = '';
                        renderBooks();
                    });
                }
                
                hideLoading();
            }, 500);
        }

        function showError(errorId, message) {
            const errorElement = document.getElementById(errorId);
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.classList.add('active');
                
                // Also add invalid class to the input
                const inputId = errorId.replace('-error', '');
                const inputElement = document.getElementById(inputId);
                if (inputElement) {
                    inputElement.classList.add('invalid');
                }
            }
        }

        function hideError(errorId) {
            const errorElement = document.getElementById(errorId);
            if (errorElement) {
                errorElement.classList.remove('active');
                
                // Also remove invalid class from the input
                const inputId = errorId.replace('-error', '');
                const inputElement = document.getElementById(inputId);
                if (inputElement) {
                    inputElement.classList.remove('invalid');
                }
            }
        }

        function showAlert(type, title, message) {
            const alert = alertTemplate.cloneNode(true);
            alert.removeAttribute('id');
            
            // Set alert type
            alert.className = `alert alert-${type}`;
            
            // Set icon based on type
            const icon = alert.querySelector('i');
            if (type === 'success') {
                icon.className = 'fas fa-check-circle';
            } else if (type === 'warning') {
                icon.className = 'fas fa-exclamation-circle';
            } else if (type === 'danger') {
                icon.className = 'fas fa-times-circle';
            }
            
            // Set content
            alert.querySelector('.alert-title').textContent = title;
            alert.querySelector('.alert-message').textContent = message;
            
            // Add close button functionality
            alert.querySelector('.alert-close').addEventListener('click', () => {
                alert.classList.remove('active');
                setTimeout(() => {
                    if (document.body.contains(alert)) {
                        document.body.removeChild(alert);
                    }
                }, 300);
            });
            
            // Add to body and show
            document.body.appendChild(alert);
            setTimeout(() => {
                alert.classList.add('active');
            }, 10);
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                if (document.body.contains(alert)) {
                    alert.classList.remove('active');
                    setTimeout(() => {
                        if (document.body.contains(alert)) {
                            document.body.removeChild(alert);
                        }
                    }, 300);
                }
            }, 5000);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            
            // Check if date is valid
            if (isNaN(date.getTime())) {
                return 'Invalid date';
            }
            
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            
            return date.toLocaleDateString('en-US', options);
        }
        
        function formatTimeAgo(dateString) {
            const date = new Date(dateString);
            
            // Check if date is valid
            if (isNaN(date.getTime())) {
                return 'Invalid date';
            }
            
            const now = new Date();
            const diff = now - date;
            
            // Convert to different time units
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            const months = Math.floor(days / 30);
            const years = Math.floor(days / 365);
            
            // Return appropriate time format
            if (seconds < 60) {
                return seconds === 1 ? '1 second ago' : `${seconds} seconds ago`;
            } else if (minutes < 60) {
                return minutes === 1 ? '1 minute ago' : `${minutes} minutes ago`;
            } else if (hours < 24) {
                return hours === 1 ? '1 hour ago' : `${hours} hours ago`;
            } else if (days < 30) {
                return days === 1 ? '1 day ago' : `${days} days ago`;
            } else if (months < 12) {
                return months === 1 ? '1 month ago' : `${months} months ago`;
            } else {
                return years === 1 ? '1 year ago' : `${years} years ago`;
            }
        }

        function formatGenre(genre) {
            if (!genre) return 'Unknown';
            
            // Convert genre from slug to display format
            return genre.split('-').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }

        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        function renderGenres() {
            // Get all unique genres
            const genresMap = {};
            
            books.forEach(book => {
                if (book.genre && !genresMap[book.genre]) {
                    genresMap[book.genre] = {
                        name: book.genre,
                        count: 1,
                        coverImage: book.cover
                    };
                } else if (book.genre) {
                    genresMap[book.genre].count++;
                    
                    // Use cover with higher rating as the genre cover
                    const currentBookRating = calculateAverageRating(book.ratings);
                    const existingBookId = books.find(b => b.cover === genresMap[book.genre].coverImage)?.id;
                    const existingBook = books.find(b => b.id === existingBookId);
                    
                    if (existingBook) {
                        const existingRating = calculateAverageRating(existingBook.ratings);
                        if (currentBookRating > existingRating) {
                            genresMap[book.genre].coverImage = book.cover;
                        }
                    }
                }
            });
            
            // Convert to array and sort by count
            const genresArray = Object.values(genresMap);
            genresArray.sort((a, b) => b.count - a.count);
            
            // Render genres
            genresGrid.innerHTML = '';
            
            genresArray.forEach((genre, index) => {
                const genreCard = document.createElement('div');
                genreCard.className = 'genre-card';
                genreCard.style.opacity = '0';
                genreCard.style.transform = 'translateY(20px)';
                
                genreCard.innerHTML = `
                    <img src="${genre.coverImage}" alt="${formatGenre(genre.name)}">
                    <div class="genre-overlay">
                        <h3 class="genre-title">${formatGenre(genre.name)}</h3>
                        <p class="genre-count">${genre.count} book${genre.count !== 1 ? 's' : ''}</p>
                    </div>
                `;
                
                // Add click event to filter books by this genre
                genreCard.addEventListener('click', () => {
                    navigateToPage('books');
                    
                    // Set filter to this genre
                    const filterButtons = document.querySelectorAll('.filter-btn');
                    filterButtons.forEach(btn => {
                        if (btn.dataset.filter === genre.name) {
                            btn.click();
                        }
                    });
                    
                    // Scroll to books section
                    document.getElementById('books').scrollIntoView({
                        behavior: 'smooth'
                    });
                });
                
                genresGrid.appendChild(genreCard);
                
                // Animate in with delay
                setTimeout(() => {
                    genreCard.style.opacity = '1';
                    genreCard.style.transform = 'translateY(0)';
                    genreCard.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                }, index * 100);
            });
        }
        
        function renderAuthors() {
            authorsGrid.innerHTML = '';
            
            if (authors.length === 0) {
                authorsGrid.innerHTML = `
                    <div class="empty-books text-center" style="grid-column: 1/-1">
                        <i class="fas fa-users fa-3x mb-3" style="color: var(--gray-400);"></i>
                        <h3 class="mb-2">No Authors Yet</h3>
                        <p>Be the first to add an author by adding a book!</p>
                    </div>
                `;
                return;
            }
            
            authors.slice(0, 8).forEach((author, index) => {
                // Find the book with highest rating for this author for the avatar
                const authorBooks = books.filter(book => book.author === author.name);
                let bestBook = authorBooks[0];
                
                if (authorBooks.length > 1) {
                    authorBooks.forEach(book => {
                        const currentRating = calculateAverageRating(book.ratings);
                        const bestRating = calculateAverageRating(bestBook.ratings);
                        
                        if (currentRating > bestRating) {
                            bestBook = book;
                        }
                    });
                }
                
                const authorCard = document.createElement('div');
                authorCard.className = 'author-card';
                authorCard.dataset.id = author.id;
                authorCard.style.opacity = '0';
                authorCard.style.transform = 'translateY(20px)';
                
                // Check if author has achievements
                const hasAchievements = authorMonthlyAwards[author.id] && authorMonthlyAwards[author.id].length > 0;
                
                authorCard.innerHTML = `
                    <div class="author-avatar">
                                                <img src="${author.image || (bestBook ? bestBook.cover : 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzFhNzNlOCIvPjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iODAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIGZpbGw9IiNmZmZmZmYiPkE8L3RleHQ+PC9zdmc+')}" alt="${author.name}">
                    </div>
                    <h3 class="author-name">${author.name}</h3>
                    <div class="author-stats">
                        <div class="author-stat">
                            <div class="author-stat-value">${author.books.length}</div>
                            <div class="author-stat-label">Books</div>
                        </div>
                        <div class="author-stat">
                            <div class="author-stat-value">${author.totalRatings}</div>
                            <div class="author-stat-label">Ratings</div>
                        </div>
                        <div class="author-stat">
                            <div class="author-stat-value">${author.avgRating.toFixed(1)}</div>
                            <div class="author-stat-label">Avg Rating</div>
                        </div>
                    </div>
                    <div class="author-votes mb-2">
                        <button class="vote-btn ${getUserAuthorVote(author.id) === 'upvote' ? 'upvoted' : ''}">
                            <i class="fas fa-thumbs-up"></i> <span>${author.upvotes || 0}</span>
                        </button>
                        <button class="vote-btn ${getUserAuthorVote(author.id) === 'downvote' ? 'downvoted' : ''}">
                            <i class="fas fa-thumbs-down"></i> <span>${author.downvotes || 0}</span>
                        </button>
                    </div>
                    ${hasAchievements ? '<div class="author-achievement"><i class="fas fa-award"></i> Award Winner</div>' : ''}
                `;
                
                // Add event listeners to vote buttons
                const upvoteBtn = authorCard.querySelector('.author-votes button:first-child');
                const downvoteBtn = authorCard.querySelector('.author-votes button:last-child');
                
                upvoteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    handleAuthorVote(author.id, 'upvote');
                });
                
                downvoteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    handleAuthorVote(author.id, 'downvote');
                });
                
                // Make the whole card clickable
                authorCard.addEventListener('click', () => {
                    showAuthorDetails(author.id);
                });
                
                authorsGrid.appendChild(authorCard);
                
                // Animate in with delay
                setTimeout(() => {
                    authorCard.style.opacity = '1';
                    authorCard.style.transform = 'translateY(0)';
                    authorCard.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                }, index * 100);
            });
        }
        
        function updateStats() {
            // Calculate stats
            const totalBooks = books.length;
            
            // Count all comments (book + chapter)
            let totalReviews = 0;
            
            // Count book comments
            Object.values(bookComments).forEach(comments => {
                totalReviews += comments.filter(comment => !comment.isDeleted).length;
            });
            
            // Count chapter comments
            Object.values(chapterComments).forEach(comments => {
                totalReviews += comments.filter(comment => !comment.isDeleted).length;
            });
            
            // Get unique authors
            const uniqueAuthors = [...new Set(books.map(book => book.author))].length;
            
            // Count registered users (based on actual email count)
            const totalMembers = Object.keys(userProfiles).length;
            
            // Update DOM
            booksCount.textContent = totalBooks;
            authorsCount.textContent = uniqueAuthors;
            reviewsCount.textContent = totalReviews;
            membersCount.textContent = totalMembers;
        }
        
        function animateStats() {
            const statsElements = [booksCount, authorsCount, reviewsCount, membersCount];
            const finalValues = statsElements.map(el => parseInt(el.textContent));
            
            // Reset to zero
            statsElements.forEach(el => el.textContent = '0');
            
            // Animate counting up
            statsElements.forEach((el, index) => {
                const finalValue = finalValues[index];
                const duration = 2000; // 2 seconds
                const increment = finalValue / (duration / 16); // 60fps
                let currentValue = 0;
                
                const timer = setInterval(() => {
                    currentValue += increment;
                    if (currentValue >= finalValue) {
                        clearInterval(timer);
                        el.textContent = finalValue;
                    } else {
                        el.textContent = Math.floor(currentValue);
                    }
                }, 16);
            });
        }
		import { initializeApp } from 'firebase/app';
import { getFirestore, doc, setDoc, getDoc, onSnapshot } from 'firebase/firestore';
import { getAuth, onAuthStateChanged } from 'firebase/auth';
import config from './config.js';

class DataService {
    constructor() {
        // Initialize Firebase
        const app = initializeApp(config.firebaseConfig);
        this.db = getFirestore(app);
        this.auth = getAuth(app);
        
        // Track authentication state
        this.currentUser = null;
        onAuthStateChanged(this.auth, (user) => {
            this.currentUser = user;
            if (user) {
                this.initializeUserData();
            }
        });
    }

    // Initialize user's data and set up real-time sync
    async initializeUserData() {
        if (!this.currentUser) return;

        // Set up real-time sync for user preferences
        this.syncUserPreferences();
        
        // Set up real-time sync for book ratings
        this.syncBookRatings();
        
        // Set up real-time sync for reading lists
        this.syncReadingLists();
    }

    // Sync user preferences across devices
    syncUserPreferences() {
        const userPrefsRef = doc(this.db, 'users', this.currentUser.uid, 'preferences');
        
        // Listen for changes
        onSnapshot(userPrefsRef, (doc) => {
            if (doc.exists()) {
                this.updateLocalPreferences(doc.data());
            }
        });
    }

    // Sync book ratings across devices
    syncBookRatings() {
        const ratingsRef = doc(this.db, 'users', this.currentUser.uid, 'ratings');
        
        onSnapshot(ratingsRef, (doc) => {
            if (doc.exists()) {
                this.updateLocalRatings(doc.data());
            }
        });
    }

    // Sync reading lists across devices
    syncReadingLists() {
        const listsRef = doc(this.db, 'users', this.currentUser.uid, 'readingLists');
        
        onSnapshot(listsRef, (doc) => {
            if (doc.exists()) {
                this.updateLocalReadingLists(doc.data());
            }
        });
    }

    // Save data and sync to cloud
    async saveData(collection, data) {
        if (!this.currentUser) return;

        try {
            const docRef = doc(this.db, 'users', this.currentUser.uid, collection);
            await setDoc(docRef, data, { merge: true });
            return true;
        } catch (error) {
            console.error('Error saving data:', error);
            return false;
        }
    }

    // Update local preferences
    updateLocalPreferences(preferences) {
        localStorage.setItem('userPreferences', JSON.stringify(preferences));
        // Trigger UI updates
        window.dispatchEvent(new CustomEvent('preferencesUpdated', { detail: preferences }));
    }

    // Update local ratings
    updateLocalRatings(ratings) {
        localStorage.setItem('bookRatings', JSON.stringify(ratings));
        // Trigger UI updates
        window.dispatchEvent(new CustomEvent('ratingsUpdated', { detail: ratings }));
    }

    // Update local reading lists
    updateLocalReadingLists(lists) {
        localStorage.setItem('readingLists', JSON.stringify(lists));
        // Trigger UI updates
        window.dispatchEvent(new CustomEvent('readingListsUpdated', { detail: lists }));
    }
}

// Create and export a singleton instance
export const dataService = new DataService();
import { dataService } from './dataService.js';

// Initialize the data service when the application starts
document.addEventListener('DOMContentLoaded', () => {
    // Listen for preference updates
    window.addEventListener('preferencesUpdated', (event) => {
        updateUIWithPreferences(event.detail);
    });

    // Listen for ratings updates
    window.addEventListener('ratingsUpdated', (event) => {
        updateUIWithRatings(event.detail);
    });

    // Listen for reading list updates
    window.addEventListener('readingListsUpdated', (event) => {
        updateUIWithReadingLists(event.detail);
    });
});

// UI update functions
function updateUIWithPreferences(preferences) {
    // Update theme
    if (preferences.theme) {
        document.body.setAttribute('data-theme', preferences.theme);
    }
    // Update other UI elements based on preferences
}

function updateUIWithRatings(ratings) {
    // Update book ratings in the UI
    Object.entries(ratings).forEach(([bookId, rating]) => {
        const ratingElements = document.querySelectorAll(`[data-book-id="${bookId}"] .rating-stars`);
        ratingElements.forEach(elem => {
            elem.innerHTML = '★'.repeat(rating) + '☆'.repeat(5 - rating);
        });
    });
}

function updateUIWithReadingLists(lists) {
    // Update reading lists in the UI
    // Implementation depends on your UI structure
}
document.addEventListener('DOMContentLoaded', () => {
    // Listen for data sync events
    window.addEventListener('dataSync', (event) => {
      const { type, data } = event.detail;
      switch(type) {
        case 'bookmarks':
          updateBookmarksUI(data);
          break;
        case 'ratings':
          updateRatingsUI(data);
          break;
        case 'readingList':
          updateReadingListUI(data);
          break;
      }
    });
  });

  function updateBookmarksUI(bookmarks) {
    // Update bookmark icons and states
    document.querySelectorAll('[data-bookmark-id]').forEach(elem => {
      const bookId = elem.dataset.bookmarkId;
      elem.classList.toggle('active', bookmarks[bookId]);
    });
  }

  function updateRatingsUI(ratings) {
    // Update rating displays
    document.querySelectorAll('[data-book-rating]').forEach(elem => {
      const bookId = elem.dataset.bookRating;
      if (ratings[bookId]) {
        elem.innerHTML = '★'.repeat(ratings[bookId]) + '☆'.repeat(5 - ratings[bookId]);
      }
    });
  }

  function updateReadingListUI(readingList) {
    // Update reading list indicators
    document.querySelectorAll('[data-reading-list]').forEach(elem => {
      const bookId = elem.dataset.readingList;
      elem.classList.toggle('in-list', readingList[bookId]);
    });
  }
    </script>
</body>
</html>
